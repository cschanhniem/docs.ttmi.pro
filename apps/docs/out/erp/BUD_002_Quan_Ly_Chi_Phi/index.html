<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/erp-docs/_next/static/media/e4af272ccee01ff0-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/erp-docs/_next/static/css/4b73dfd0f7bdc629.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/erp-docs/_next/static/chunks/webpack-39532e8569213db6.js"/><script src="/erp-docs/_next/static/chunks/7384d974-8b753aa07a0575a2.js" async=""></script><script src="/erp-docs/_next/static/chunks/381-1b6d0728bba7b8e7.js" async=""></script><script src="/erp-docs/_next/static/chunks/main-app-5d87a2fd0f4f2f33.js" async=""></script><script src="/erp-docs/_next/static/chunks/d550ec10-485e3f71f5def856.js" async=""></script><script src="/erp-docs/_next/static/chunks/993-1b6a71072be86da4.js" async=""></script><script src="/erp-docs/_next/static/chunks/410-1ece2fcedd156d2f.js" async=""></script><script src="/erp-docs/_next/static/chunks/app/%5B...slug%5D/page-7978846c0e32abf5.js" async=""></script><script src="/erp-docs/_next/static/chunks/app/layout-b6ef60bec0ff2cf2.js" async=""></script><title>undefined | ERP Documentation</title><meta name="keywords" content="documentation,ERP,technical,mermaid,markdown"/><meta name="next-size-adjust"/><script src="/erp-docs/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="__className_985585"><div class="min-h-screen flex items-center justify-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div><script src="/erp-docs/_next/static/chunks/webpack-39532e8569213db6.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/erp-docs/_next/static/media/e4af272ccee01ff0-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/erp-docs/_next/static/css/4b73dfd0f7bdc629.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"3:I[5214,[],\"\"]\n5:I[3040,[\"135\",\"static/chunks/d550ec10-485e3f71f5def856.js\",\"993\",\"static/chunks/993-1b6a71072be86da4.js\",\"410\",\"static/chunks/410-1ece2fcedd156d2f.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-7978846c0e32abf5.js\"],\"DocLayout\"]\n6:I[1276,[\"135\",\"static/chunks/d550ec10-485e3f71f5def856.js\",\"993\",\"static/chunks/993-1b6a71072be86da4.js\",\"410\",\"static/chunks/410-1ece2fcedd156d2f.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-7978846c0e32abf5.js\"],\"MDXContent\"]\n8:I[6472,[],\"\"]\na:I[9190,[],\"\"]\nb:I[4550,[\"185\",\"static/chunks/app/layout-b6ef60bec0ff2cf2.js\"],\"ThemeProvider\"]\nc:I[8910,[\"185\",\"static/chunks/app/layout-b6ef60bec0ff2cf2.js\"],\"AuthProvider\"]\ne:I[3013,[],\"\"]\n7:T4aaa,"])</script><script>self.__next_f.push([1,"# BUD_002_Budget_Quản Lý Chi Phí\n\n*Phiên bản: 1.0*\n*Người tạo: Gemini AI Assistant*\n*Ngày tạo: 2024-07-30*\n*Cập nhật lần cuối: 2024-07-30*\n*Người cập nhật: Gemini AI Assistant*\n\n## 1. Tổng Quan Nghiệp Vụ\n\n### 1.1. Mô Tả Nghiệp Vụ\nNghiệp vụ Quản Lý Chi Phí (trong mã nguồn là `ChiPhiModel`) cho phép người dùng định nghĩa, theo dõi và quản lý các khoản mục chi phí phát sinh trong một đơn vị (entity). Mỗi khoản mục chi phí bao gồm mã chi phí, tên, loại chi phí, loại phân bổ, trạng thái và có thể liên kết với một chứng từ gốc. Nghiệp vụ này giúp doanh nghiệp ghi nhận, phân loại và kiểm soát các chi phí, phục vụ cho công tác kế toán và quản trị.\n\n### 1.2. Phạm Vi Áp Dụng\n- Áp dụng cho từng Đơn vị (Entity) trong hệ thống.\n- Kế toán viên, kế toán tổng hợp, kế toán trưởng, và các bộ phận liên quan đến việc ghi nhận và quản lý chi phí.\n\n### 1.3. Định Nghĩa Thuật Ngữ\n| Thuật ngữ | Định nghĩa |\n|-----------|------------|\n| Chi Phí (CP) | Một khoản chi tiêu phát sinh được ghi nhận trong hệ thống. Trong mã nguồn được gọi là `ChiPhiModel`. |\n| Đơn vị (Entity) | Tổ chức hoặc công ty mà chi phí được ghi nhận. |\n| `ma_cp` | Mã định danh duy nhất cho một khoản mục chi phí trong một đơn vị. |\n| `ten_cp` | Tên mô tả của khoản mục chi phí. |\n| `loai_cp` | Phân loại chi phí (ví dụ: chi phí sản xuất, chi phí bán hàng, chi phí quản lý doanh nghiệp). |\n| `loai_pb` | Phương thức phân bổ chi phí (ví dụ: trực tiếp, gián tiếp theo tiêu thức). |\n| `truoc_hq_yn` | (Boolean) Chỉ định chi phí này có được tính trước khi hạch toán quỹ hay không. |\n| `ma_ct` | (ForeignKey) Liên kết đến `ChungTuModel`, là chứng từ gốc của chi phí (nếu có). |\n| `status` | Trạng thái của khoản mục chi phí (ví dụ: '1' = hoạt động, '0' = không hoạt động). |\n\n### 1.4. Tài Liệu Liên Quan\n| STT | Mã tài liệu | Tên tài liệu | Mô tả |\n|-----|-------------|--------------|-------|\n| 1   | `django_ledger/models/chi_phi.py` | Model Định Nghĩa Chi Phí | Định nghĩa cấu trúc dữ liệu cho `ChiPhiModel`. |\n| 2   | `django_ledger/api/views/chi_phi.py` | API Endpoints Chi Phí | Các điểm cuối API để tương tác với nghiệp vụ Quản Lý Chi Phí. |\n| 3   | `django_ledger/api/serializers/chi_phi.py` | Serializers Chi Phí | Định dạng dữ liệu JSON cho API và thực hiện validation cơ bản. |\n\n## 2. Quy Trình Nghiệp Vụ\n\n### 2.1. Tổng Quan Quy Trình\nNgười dùng (kế toán viên) sẽ tương tác với hệ thống thông qua giao diện người dùng hoặc API để thực hiện các thao tác CRUD (Create, Read, Update, Delete) trên các Khoản Mục Chi Phí. Hệ thống, thông qua `ChiPhiViewSet` và `ChiPhiModelSerializer`, sẽ validate dữ liệu đầu vào, tương tác với `ChiPhiModel` để lưu trữ hoặc truy xuất dữ liệu từ cơ sở dữ liệu.\n\n### 2.2. Sơ Đồ Quy Trình (Business Flow)\n\n```mermaid\nflowchart TD\n    A[Người dùng yêu cầu thao tác Chi Phí] --\u003e B{API Gateway nhận yêu cầu};\n    B --\u003e C[Xác thực \u0026 Ủy quyền];\n    C --\u003e D[ChiPhiViewSet];\n    D --\u003e E[ChiPhiModelSerializer (Validate)];\n    E -- Dữ liệu hợp lệ --\u003e F[ChiPhiModel (ORM)];\n    F --\u003e G[(Cơ sở dữ liệu)];\n    G --\u003e F;\n    F --\u003e D;\n    E -- Dữ liệu không hợp lệ --\u003e D[Báo lỗi cho ViewSet];\n    D --\u003e B;\n    B --\u003e A[Trả kết quả cho người dùng];\n\n    subgraph \\\"Thao tác Chi Phí\\\"\n        direction LR\n        AA[Tạo mới Chi Phí] --\u003e AB{Validate dữ liệu (Serializer)};\n        AB -- hợp lệ --\u003e AC[Lưu Chi Phí (Model)];\n        AB -- không hợp lệ --\u003e AD[Báo lỗi];\n        AE[Xem danh sách/chi tiết Chi Phí] --\u003e AF[Truy vấn Chi Phí (Model QuerySet)];\n        AG[Cập nhật Chi Phí] --\u003e AH{Validate dữ liệu (Serializer)};\n        AH -- hợp lệ --\u003e AI[Cập nhật Chi Phí (Model)];\n        AH -- không hợp lệ --\u003e AD;\n        AJ[Xóa Chi Phí] --\u003e AK[Xóa Chi Phí (Model)];\n    end\n    D --\u003e AA \u0026 AE \u0026 AG \u0026 AJ\n```\n\n### 2.3. Chi Tiết Các Bước Quy Trình\n\n#### 2.3.1. Tạo Mới Khoản Mục Chi Phí\n- **Mô tả**: Người dùng nhập thông tin để tạo một khoản mục chi phí mới.\n- **Đầu vào**: Dữ liệu chi phí (`ma_cp`, `ten_cp`, `loai_cp`, `loai_pb`, `truoc_hq_yn`, `ma_ct` (optional), `status`). `entity_model` được xác định từ URL.\n- **Đầu ra**: Khoản mục chi phí mới được tạo hoặc thông báo lỗi.\n- **Người thực hiện**: Kế toán viên.\n- **Điều kiện tiên quyết**: Đăng nhập, có quyền tạo chi phí cho đơn vị. `ma_cp` phải là duy nhất trong đơn vị. Các trường bắt buộc (`ma_cp`, `ten_cp`, `loai_cp`, `loai_pb`) phải được cung cấp.\n- **Xử lý ngoại lệ**: Dữ liệu không hợp lệ (thiếu trường, sai định dạng), `ma_cp` đã tồn tại, đơn vị không tồn tại.\n\n#### 2.3.2. Xem/Tìm Kiếm Khoản Mục Chi Phí\n- **Mô tả**: Người dùng xem danh sách hoặc chi tiết một khoản mục chi phí. `ChiPhiViewSet` hỗ trợ các filter mặc định của DRF (nếu được cấu hình, ví dụ: `filterset_fields`, `search_fields`).\n- **Đầu vào**: UUID của chi phí (để xem chi tiết), hoặc các tham số query để lọc/tìm kiếm, thông tin phân trang.\n- **Đầu ra**: Danh sách hoặc chi tiết khoản mục chi phí.\n- **Người thực hiện**: Người dùng có quyền xem.\n- **Điều kiện tiên quyết**: Đăng nhập vào hệ thống.\n- **Xử lý ngoại lệ**: Chi phí không tồn tại.\n\n#### 2.3.3. Cập Nhật Khoản Mục Chi Phí\n- **Mô tả**: Người dùng thay đổi thông tin của một khoản mục chi phí đã có.\n- **Đầu vào**: UUID của chi phí và dữ liệu cần cập nhật.\n- **Đầu ra**: Khoản mục chi phí được cập nhật hoặc thông báo lỗi.\n- **Người thực hiện**: Kế toán viên.\n- **Điều kiện tiên quyết**: Đăng nhập, có quyền sửa. Chi phí phải tồn tại. Nếu `ma_cp` thay đổi, mã mới không được trùng.\n- **Xử lý ngoại lệ**: Dữ liệu không hợp lệ, chi phí không tồn tại, `ma_cp` mới bị trùng.\n\n#### 2.3.4. Xóa Khoản Mục Chi Phí\n- **Mô tả**: Người dùng xóa một khoản mục chi phí.\n- **Đầu vào**: UUID của chi phí.\n- **Đầu ra**: Thông báo xóa thành công (HTTP 204) hoặc lỗi.\n- **Người thực hiện**: Kế toán viên.\n- **Điều kiện tiên quyết**: Đăng nhập, có quyền xóa. Chi phí phải tồn tại.\n- **Xử lý ngoại lệ**: Chi phí không tồn tại.\n\n### 2.4. Sơ Đồ Tuần Tự (Sequence Diagram) - Tạo mới Khoản Mục Chi Phí\n\n```mermaid\nsequenceDiagram\n    participant User\n    participant APIView as ChiPhiViewSet\n    participant Serializer as ChiPhiModelSerializer\n    participant Model as ChiPhiModel\n    participant DB as Database\n\n    User-\u003e\u003eAPIView: POST /api/{entity_slug}/expenses/ (data)\n    APIView-\u003e\u003eSerializer: serializer_class(data=request.data)\n    Serializer-\u003e\u003eSerializer: is_valid(raise_exception=True)\n    alt Dữ liệu không hợp lệ\n        Serializer--\u003e\u003eAPIView: Raise ValidationError\n        APIView--\u003e\u003eUser: HTTP 400 (Error details)\n    else Dữ liệu hợp lệ\n        APIView-\u003e\u003eAPIView: perform_create(serializer)\n        APIView-\u003e\u003eSerializer: save(entity_model=entity)\n        Serializer-\u003e\u003eModel: objects.create(validated_data_with_entity)\n        Model-\u003e\u003eDB: INSERT INTO chi_phi\n        DB--\u003e\u003eModel: created_instance\n        Model--\u003e\u003eSerializer: created_instance\n        Serializer--\u003e\u003eAPIView: created_instance\n        APIView--\u003e\u003eUser: HTTP 201 (serialized_instance_data)\n    end\n```\n*(Lưu ý: `perform_create` trong `EntityRelatedViewSet` sẽ tự động gán `entity_model`)*\n\n### 2.5. Luồng Nghiệp Vụ Thay Thế\n- **Cập nhật `ma_cp`**: Khi cập nhật `ma_cp`, `ModelViewSet` (thông qua `ChiPhiModel`) sẽ kiểm tra tính duy nhất của `ma_cp` mới trong phạm vi `entity_model` do có `unique_together = [('entity_model', 'ma_cp')]`.\n- **Phân trang**: `ChiPhiViewSet` sử dụng `ERPPagination` để phân trang danh sách.\n\n## 3. Yêu Cầu Chức Năng\n\n### 3.1. Danh Sách Chức Năng\n(Dựa trên các actions tiêu chuẩn của `ModelViewSet` trong DRF)\n\n| STT | Mã chức năng | Tên chức năng | Mô tả | Độ ưu tiên |\n|-----|--------------|---------------|-------|------------|\n| 1   | BUD002-CP-LIST | Xem danh sách Chi Phí | Lấy danh sách các khoản mục chi phí cho một đơn vị, hỗ trợ phân trang. | Cao |\n| 2   | BUD002-CP-CREATE | Tạo mới Chi Phí | Tạo một khoản mục chi phí mới. | Cao |\n| 3   | BUD002-CP-RETRIEVE | Xem chi tiết Chi Phí | Lấy thông tin chi tiết của một khoản mục chi phí bằng UUID. | Cao |\n| 4   | BUD002-CP-UPDATE | Cập nhật Chi Phí | Cập nhật toàn bộ thông tin của một khoản mục chi phí đã có. | Cao |\n| 5   | BUD002-CP-PARTIAL-UPDATE | Cập nhật một phần Chi Phí | Cập nhật một phần thông tin của một khoản mục chi phí đã có. | Cao |\n| 6   | BUD002-CP-DELETE | Xóa Chi Phí | Xóa một khoản mục chi phí. | Cao |\n\n### 3.2. Chi Tiết Chức Năng\n\n#### 3.2.1. BUD002-CP-CREATE: Tạo mới Chi Phí\n- **Mô tả**: Cho phép tạo một khoản mục chi phí mới.\n- **Đầu vào**: Dữ liệu JSON chứa: `ma_cp`, `ten_cp`, `loai_cp`, `loai_pb`, `truoc_hq_yn` (optional, default False), `ma_ct` (optional UUID), `status` (optional, default '1').\n- **Đầu ra**: Dữ liệu JSON của chi phí vừa tạo và trường `ma_ct_data` (nếu `ma_ct` có).\n- **Điều kiện tiên quyết**: `ma_cp`, `ten_cp`, `loai_cp`, `loai_pb` không được để trống. `ma_cp` phải duy nhất trong đơn vị.\n- **Luồng xử lý chính** (qua `ModelViewSet.create` và `ChiPhiModelSerializer`):\n  1. `ChiPhiViewSet` nhận request POST.\n  2. `ChiPhiModelSerializer` được khởi tạo với dữ liệu.\n  3. `serializer.is_valid()` được gọi:\n     a. Các hàm `validate_\u003cfield\u003e()` trong serializer được thực thi (ví dụ `validate_ma_cp`).\n     b. Kiểm tra tính duy nhất của `(entity_model, ma_cp)` ở tầng model/DB khi lưu.\n  4. `viewset.perform_create(serializer)` được gọi, trong đó `serializer.save()` sẽ gán `entity_model` (từ `EntityRelatedViewSet`).\n  5. Trả về dữ liệu đã serialize của instance mới tạo với HTTP status 201.\n- **Luồng xử lý thay thế/ngoại lệ**:\n  - Dữ liệu không hợp lệ (theo validation của serializer hoặc model): Trả về HTTP 400.\n  - `entity_slug` không hợp lệ: Trả về HTTP 404 (xử lý bởi `EntityRelatedViewSet`).\n- **Giao diện liên quan**: Form tạo mới Chi Phí.\n\n*(Các chức năng LIST, RETRIEVE, UPDATE, DELETE được cung cấp bởi `ModelViewSet` và sử dụng `ChiPhiModelSerializer` tương tự.)*\n\n## 4. Thiết Kế Kỹ Thuật\n\n### 4.1. Kiến Trúc Hệ Thống\nNghiệp vụ này chủ yếu dựa vào các thành phần tiêu chuẩn của Django và Django REST framework:\n- **View Layer**: `ChiPhiViewSet` (kế thừa từ `EntityRelatedViewSet`, có thể là `ModelViewSet`) xử lý HTTP requests, ủy quyền, và sử dụng serializer.\n- **Serializer Layer**: `ChiPhiModelSerializer` đảm nhận việc validate dữ liệu, chuyển đổi giữa Python objects và JSON.\n- **Model Layer**: `ChiPhiModel` định nghĩa cấu trúc dữ liệu, các ràng buộc (`unique_together`), và cung cấp các method quản lý (`objects`, `ChiPhiModelManager`).\n- **Database Layer**: Django ORM tương tác với cơ sở dữ liệu.\n\n```mermaid\ngraph TD\n    Client --\u003e Nginx --\u003e Gunicorn\n    Gunicorn --\u003e DjangoApp[Django Application]\n\n    subgraph DjangoApp\n        APILayer[API Layer: ChiPhiViewSet]\n        SerializerLayer[Serializer Layer: ChiPhiModelSerializer]\n        ModelLayer[Model Layer: ChiPhiModel, ChiPhiModelManager]\n        Database[(PostgreSQL Database)]\n\n        APILayer --\u003e|uses| SerializerLayer\n        SerializerLayer --\u003e|interacts with| ModelLayer\n        APILayer --\u003e|queries via ORM| ModelLayer\n        ModelLayer --\u003e|maps to| Database\n    end\n```\n*(Do không có Service/Repository layer riêng biệt, ViewSet và Serializer tương tác trực tiếp hơn với Model)*\n\n### 4.2. API Endpoints\n\n#### 4.2.1. Quản Lý Chi Phí (`ChiPhiModel`)\n- **Mô tả**: CRUD các khoản mục chi phí.\n- **Base URL**: `/api/{entity_slug}/expenses/` (Giả định `expenses` là slug đã đăng ký trong `urls.py` cho `ChiPhiViewSet`)\n- **Endpoints** (cung cấp bởi `ModelViewSet`):\n  - `GET /`: Lấy danh sách chi phí (hỗ trợ phân trang `ERPPagination`).\n    - `ChiPhiViewSet` có `get_queryset` để lọc theo `entity_slug`.\n  - `POST /`: Tạo chi phí mới.\n  - `GET /{uuid}/`: Lấy chi tiết chi phí.\n  - `PUT /{uuid}/`: Cập nhật toàn bộ chi phí.\n  - `PATCH /{uuid}/`: Cập nhật một phần chi phí.\n  - `DELETE /{uuid}/`: Xóa chi phí.\n\n### 4.3. Service Logic\nKhông có lớp Service riêng biệt cho `ChiPhiModel`. Logic nghiệp vụ được xử lý chủ yếu trong:\n- `ChiPhiViewSet`: Xử lý request, gọi serializer, lọc queryset theo `entity_slug`.\n- `ChiPhiModelSerializer`: Validate dữ liệu, cung cấp `ma_ct_data`.\n- `ChiPhiModel` và `ChiPhiModelManager`: Các phương thức truy vấn (`active`, `for_entity`, `by_code`), ràng buộc dữ liệu (`unique_together`).\n\n### 4.4. Mô Hình Dữ Liệu\n\n#### 4.4.1. Entity Relationship Diagram (ERD)\n\n```mermaid\nerDiagram\n    EntityModel ||--o{ ChiPhiModel : \\\"has_expenses\\\"\n    ChungTu ||--o{ ChiPhiModel : \\\"related_to_expense\\\" (optional)\n\n    EntityModel {\n        UUID uuid PK\n        string slug\n        # ... other fields\n    }\n\n    ChungTu {\n        UUID uuid PK\n        string so_ct \\\"Số chứng từ\\\"\n        # ... other fields\n    }\n\n    ChiPhiModel {\n        UUID uuid PK\n        UUID entity_model_id FK\n        string ma_cp \\\"Mã chi phí (unique per entity)\\\"\n        string ten_cp \\\"Tên chi phí\\\"\n        string ten_cp2 \\\"Tên chi phí 2 (alt)\\\"\n        boolean truoc_hq_yn \\\"Trước hạch quỹ?\\\"\n        string loai_cp \\\"Loại chi phí\\\"\n        string loai_pb \\\"Loại phân bổ\\\"\n        UUID ma_ct_id FK \\\"Chứng từ gốc (optional)\\\"\n        string status \\\"Trạng thái (0/1)\\\"\n        datetime created\n        datetime updated\n    }\n```\n\n#### 4.4.2. Chi Tiết Bảng Dữ Liệu\n\n##### Bảng: `chi_phi` (mapped from `ChiPhiModel`)\n- **Mô tả**: Lưu trữ thông tin các khoản mục chi phí.\n- **Các cột chính**:\n  - `uuid` (PK, UUID): Định danh duy nhất.\n  - `entity_model_id` (FK, UUID): Liên kết đến bảng `entity`.\n  - `ma_cp` (CharField(50)): Mã chi phí.\n  - `truoc_hq_yn` (BooleanField, nullable, default False): Trước hạch quỹ.\n  - `ten_cp` (CharField(255)): Tên chi phí.\n  - `ten_cp2` (CharField(255), nullable): Tên thay thế.\n  - `loai_cp` (CharField(50)): Loại chi phí.\n  - `loai_pb` (CharField(10)): Loại phân bổ.\n  - `ma_ct_id` (FK, UUID, nullable): Liên kết đến bảng `chung_tu`.\n  - `status` (CharField(10), default '1'): Trạng thái.\n  - `created` (DateTimeField): Thời điểm tạo.\n  - `updated` (DateTimeField): Thời điểm cập nhật cuối.\n- **Indexes**: (`entity_model`, `ma_cp`), (`entity_model`, `ten_cp`), (`loai_cp`), (`status`).\n- **Unique Together**: (`entity_model`, `ma_cp`).\n\n## 5. Kế Hoạch Kiểm Thử\n\n### 5.1. Phạm Vi Kiểm Thử\n- Kiểm thử các chức năng CRUD cho Chi Phí (`ChiPhiModel`) thông qua API.\n- Kiểm thử validation dữ liệu đầu vào (trường bắt buộc, định dạng, tính duy nhất của `ma_cp` trong entity).\n- Kiểm thử API endpoints (status codes, response format, pagination).\n- Kiểm thử việc hiển thị `ma_ct_data` (dữ liệu chứng từ liên quan).\n- Kiểm thử lọc theo `entity_slug`.\n\n### 5.2. Kịch Bản Kiểm Thử\n| STT | Mã kịch bản | Tên kịch bản | Mô tả | Điều kiện tiên quyết | Các bước | Kết quả mong đợi |\n|-----|------------|--------------|-------|---------------------|----------|-----------------|\n| 1   | TC_BUD002_CP_001 | Tạo Chi Phí thành công | Kiểm tra tạo mới Chi Phí với dữ liệu hợp lệ. | User đăng nhập, có quyền. `entity_slug` hợp lệ. | 1. Gửi POST request tới `/api/{entity_slug}/expenses/` với data (`ma_cp`, `ten_cp`, `loai_cp`, `loai_pb`) hợp lệ. | 1. Response status 201. 2. Response body chứa thông tin Chi Phí đã tạo. 3. Dữ liệu được lưu đúng trong DB. |\n| 2   | TC_BUD002_CP_002 | Tạo Chi Phí thất bại - `ma_cp` trùng | Kiểm tra không cho tạo Chi Phí nếu `ma_cp` đã tồn tại trong entity. | User đăng nhập. `ma_cp` đã tồn tại cho entity. | 1. Gửi POST request với `ma_cp` đã có. | 1. Response status 400. 2. Thông báo lỗi về `ma_cp` bị trùng. |\n| 3   | TC_BUD002_CP_003 | Tạo Chi Phí thất bại - thiếu trường | Kiểm tra lỗi khi thiếu trường bắt buộc (vd: `ten_cp`). | User đăng nhập. | 1. Gửi POST request thiếu `ten_cp`. | 1. Response status 400. 2. Thông báo lỗi về trường `ten_cp` bị thiếu. |\n| 4   | TC_BUD002_CP_004 | Lấy danh sách Chi Phí | Kiểm tra lấy danh sách Chi Phí, có phân trang. | Có sẵn vài Chi Phí cho entity. | 1. Gửi GET request tới `/api/{entity_slug}/expenses/?page=1\u0026page_size=2`. | 1. Response status 200. 2. Response body chứa danh sách Chi Phí (tối đa 2), thông tin phân trang. |\n| 5   | TC_BUD002_CP_005 | Lấy Chi Phí với `ma_ct_data` | Kiểm tra Chi Phí có liên kết chứng từ hiển thị `ma_ct_data`. | Chi Phí có `ma_ct` hợp lệ. | 1. Gửi GET request tới `/api/{entity_slug}/expenses/{uuid_chi_phi}/`. | 1. Response status 200. 2. `ma_ct_data` chứa thông tin của chứng từ liên quan. |\n| ... | ...          | ...            | ...   | ...                 | ...      | ...               |\n\n## 6. Phụ Lục\n\n### 6.1. Danh Sách Tài Liệu Tham Khảo\n- Mã nguồn dự án ERP-BE (các file đã liệt kê ở mục 1.4).\n- Tài liệu Django REST framework.\n\n### 6.2. Danh Mục Thuật Ngữ\n(Xem mục 1.3)\n\n### 6.3. Lịch Sử Thay Đổi Tài Liệu\n| Phiên bản | Ngày       | Người thực hiện      | Mô tả thay đổi                         |\n|-----------|------------|----------------------|----------------------------------------|\n| 1.0       | 2024-07-30 | Gemini AI Assistant  | Tạo tài liệu ban đầu dựa trên source code. |\n\n\n\u003c/rewritten_file\u003e "])</script><script>self.__next_f.push([1,"9:[\"slug\",\"erp/BUD_002_Quan_Ly_Chi_Phi\",\"c\"]\nf:[]\n"])</script><script>self.__next_f.push([1,"0:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/erp-docs/_next/static/css/4b73dfd0f7bdc629.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"$L3\",null,{\"buildId\":\"X5KF-BjlTdL2YCafX7ACW\",\"assetPrefix\":\"/erp-docs\",\"initialCanonicalUrl\":\"/erp/BUD_002_Quan_Ly_Chi_Phi/\",\"initialTree\":[\"\",{\"children\":[[\"slug\",\"erp/BUD_002_Quan_Ly_Chi_Phi\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"erp\\\",\\\"BUD_002_Quan_Ly_Chi_Phi\\\"]}\",{}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[[\"slug\",\"erp/BUD_002_Quan_Ly_Chi_Phi\",\"c\"],{\"children\":[\"__PAGE__\",{},[[\"$L4\",[\"$\",\"$L5\",null,{\"children\":[\"$\",\"article\",null,{\"className\":\"prose prose-slate dark:prose-invert max-w-none\",\"children\":[[\"$\",\"header\",null,{\"className\":\"mb-8\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"mb-2\",\"children\":\"$undefined\"}],\"$undefined\",\"$undefined\"]}],[\"$\",\"$L6\",null,{\"content\":\"$7\"}]]}]}]],null],null]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$9\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}],null]},[[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[\"$\",\"body\",null,{\"className\":\"__className_985585\",\"children\":[\"$\",\"$Lb\",null,{\"attribute\":\"class\",\"defaultTheme\":\"system\",\"enableSystem\":true,\"disableTransitionOnChange\":true,\"children\":[\"$\",\"$Lc\",null,{\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"styles\":null}]}]}]}]}],null],null],\"couldBeIntercepted\":false,\"initialHead\":[false,\"$Ld\"],\"globalErrorComponent\":\"$e\",\"missingSlots\":\"$Wf\"}]]\n"])</script><script>self.__next_f.push([1,"d:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"undefined | ERP Documentation\"}],[\"$\",\"meta\",\"3\",{\"name\":\"keywords\",\"content\":\"documentation,ERP,technical,mermaid,markdown\"}],[\"$\",\"meta\",\"4\",{\"name\":\"next-size-adjust\"}]]\n4:null\n"])</script></body></html>