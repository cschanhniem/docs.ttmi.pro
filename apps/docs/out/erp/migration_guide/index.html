<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/erp-docs/_next/static/media/e4af272ccee01ff0-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/erp-docs/_next/static/css/4b73dfd0f7bdc629.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/erp-docs/_next/static/chunks/webpack-39532e8569213db6.js"/><script src="/erp-docs/_next/static/chunks/7384d974-8b753aa07a0575a2.js" async=""></script><script src="/erp-docs/_next/static/chunks/381-1b6d0728bba7b8e7.js" async=""></script><script src="/erp-docs/_next/static/chunks/main-app-5d87a2fd0f4f2f33.js" async=""></script><script src="/erp-docs/_next/static/chunks/d550ec10-485e3f71f5def856.js" async=""></script><script src="/erp-docs/_next/static/chunks/993-1b6a71072be86da4.js" async=""></script><script src="/erp-docs/_next/static/chunks/410-1ece2fcedd156d2f.js" async=""></script><script src="/erp-docs/_next/static/chunks/app/%5B...slug%5D/page-7978846c0e32abf5.js" async=""></script><script src="/erp-docs/_next/static/chunks/app/layout-b6ef60bec0ff2cf2.js" async=""></script><title>undefined | ERP Documentation</title><meta name="keywords" content="documentation,ERP,technical,mermaid,markdown"/><meta name="next-size-adjust"/><script src="/erp-docs/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="__className_985585"><div class="min-h-screen flex items-center justify-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div><script src="/erp-docs/_next/static/chunks/webpack-39532e8569213db6.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/erp-docs/_next/static/media/e4af272ccee01ff0-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/erp-docs/_next/static/css/4b73dfd0f7bdc629.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"3:I[5214,[],\"\"]\n5:I[3040,[\"135\",\"static/chunks/d550ec10-485e3f71f5def856.js\",\"993\",\"static/chunks/993-1b6a71072be86da4.js\",\"410\",\"static/chunks/410-1ece2fcedd156d2f.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-7978846c0e32abf5.js\"],\"DocLayout\"]\n6:I[1276,[\"135\",\"static/chunks/d550ec10-485e3f71f5def856.js\",\"993\",\"static/chunks/993-1b6a71072be86da4.js\",\"410\",\"static/chunks/410-1ece2fcedd156d2f.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-7978846c0e32abf5.js\"],\"MDXContent\"]\n8:I[6472,[],\"\"]\na:I[9190,[],\"\"]\nb:I[4550,[\"185\",\"static/chunks/app/layout-b6ef60bec0ff2cf2.js\"],\"ThemeProvider\"]\nc:I[8910,[\"185\",\"static/chunks/app/layout-b6ef60bec0ff2cf2.js\"],\"AuthProvider\"]\ne:I[3013,[],\"\"]\n7:T155d,"])</script><script>self.__next_f.push([1,"# Hướng Dẫn Chuyển Đổi Từ Các Hệ Thống Kế Toán Khác\n\n## 1. Chuẩn Bị Dữ Liệu\n\n### 1.1. Dữ Liệu Cần Chuẩn Bị\n- Danh mục tài khoản hiện tại\n- Số dư đầu kỳ các tài khoản\n- Lịch sử giao dịch (nếu cần)\n- Danh sách đối tác (khách hàng, nhà cung cấp)\n\n### 1.2. Định Dạng File Import\n```csv\ncode,name,parent,role,balance_type,opening_balance\n111,Tiền mặt,,ASSET_CA_CASH,debit,1000000\n1111,Tiền mặt VND,111,ASSET_CA_CASH,debit,800000\n1112,Tiền USD,111,ASSET_CA_CASH,debit,200000\n```\n\n## 2. Các Bước Chuyển Đổi\n\n### 2.1. Import Hệ Thống Tài Khoản\n```python\nfrom django_ledger.models import ChartOfAccountModel\nfrom django_ledger.io.roles import ASSET_CA_CASH\n\ndef import_accounts(entity, file_path):\n    coa = ChartOfAccountModel.objects.create(\n        name='Hệ thống tài khoản import',\n        entity=entity\n    )\n    \n    # Đọc file CSV và import\n    import pandas as pd\n    df = pd.read_csv(file_path)\n    \n    for _, row in df.iterrows():\n        coa.create_account(\n            code=row['code'],\n            name=row['name'],\n            role=row['role'],\n            balance_type=row['balance_type'],\n            parent=row['parent'] if pd.notna(row['parent']) else None\n        )\n```\n\n### 2.2. Import Số Dư Ban Đầu\n```python\nfrom django_ledger.models import JournalEntryModel, TransactionModel\nfrom decimal import Decimal\n\ndef import_opening_balances(entity, ledger, data):\n    je = JournalEntryModel.objects.create(\n        ledger=ledger,\n        description='Số dư đầu kỳ'\n    )\n    \n    for account_data in data:\n        TransactionModel.objects.create(\n            journal_entry=je,\n            account_id=account_data['account_id'],\n            tx_type=account_data['tx_type'],\n            amount=Decimal(account_data['amount'])\n        )\n```\n\n## 3. Xử Lý Các Trường Hợp Đặc Biệt\n\n### 3.1. Tài Khoản Không Khớp\n```python\ndef map_account_codes(old_system_code):\n    mapping = {\n        '1111': '1111',  # Tiền mặt VND\n        '1121': '1121',  # Tiền gửi VND\n        '131': '131',    # Phải thu\n        # Thêm các mapping khác\n    }\n    return mapping.get(old_system_code)\n```\n\n### 3.2. Xử Lý Sai Lệch\n```python\ndef validate_trial_balance(ledger):\n    \"\"\"Kiểm tra cân đối\"\"\"\n    debit_sum = TransactionModel.objects.filter(\n        journal_entry__ledger=ledger,\n        tx_type='debit'\n    ).aggregate(Sum('amount'))\n    \n    credit_sum = TransactionModel.objects.filter(\n        journal_entry__ledger=ledger,\n        tx_type='credit'\n    ).aggregate(Sum('amount'))\n    \n    return debit_sum == credit_sum\n```\n\n## 4. Kiểm Tra Và Xác Nhận\n\n### 4.1. Báo Cáo Kiểm Tra\n```python\ndef generate_migration_report(entity):\n    return {\n        'total_accounts': AccountModel.objects.filter(\n            coa_model__entity=entity\n        ).count(),\n        'total_transactions': TransactionModel.objects.filter(\n            journal_entry__ledger__entity=entity\n        ).count(),\n        'balance_sheet': get_balance_sheet(entity),\n        'trial_balance': get_trial_balance(entity)\n    }\n```\n\n### 4.2. Các Chỉ Tiêu Cần Kiểm Tra\n- Tổng tài sản = Tổng nguồn vốn\n- Số dư các tài khoản tiền\n- Công nợ khách hàng và nhà cung cấp\n- Thuế và các khoản phải nộp nhà nước\n\n## 5. Quy Trình Chuyển Đổi\n\n### 5.1. Trước Chuyển Đổi\n1. Backup dữ liệu hệ thống cũ\n2. Kiểm tra cân đối số liệu\n3. Chuẩn bị file mapping\n\n### 5.2. Trong Chuyển Đổi\n1. Import hệ thống tài khoản\n2. Import số dư ban đầu\n3. Kiểm tra từng bước\n\n### 5.3. Sau Chuyển Đổi\n1. Đối chiếu số liệu\n2. Chạy song song 1 tháng\n3. Đánh giá và điều chỉnh\n\n## 6. Xử Lý Sự Cố\n\n### 6.1. Lỗi Import\n```python\ndef handle_import_error(error, data):\n    \"\"\"\n    Ghi log và xử lý lỗi import\n    \"\"\"\n    logging.error(f\"Import error: {error}\")\n    logging.error(f\"Problem data: {data}\")\n    \n    if isinstance(error, DuplicateAccountError):\n        # Xử lý trùng mã tài khoản\n        return handle_duplicate_account(data)\n    elif isinstance(error, InvalidBalanceError):\n        # Xử lý sai số dư\n        return handle_invalid_balance(data)\n    return None\n```\n\n### 6.2. Khôi Phục Dữ Liệu\n```python\ndef rollback_migration(entity, timestamp):\n    \"\"\"\n    Khôi phục dữ liệu về thời điểm trước khi import\n    \"\"\"\n    AccountModel.objects.filter(\n        coa_model__entity=entity,\n        created_at__gt=timestamp\n    ).delete()\n    \n    JournalEntryModel.objects.filter(\n        ledger__entity=entity,\n        created_at__gt=timestamp\n    ).delete()\n```\n\n## 7. Tài Liệu Tham Khảo\n\n1. [Thông tư 200/2014/TT-BTC](https://thuvienphapluat.vn/van-ban/Ke-toan-Kiem-toan/Thong-tu-200-2014-TT-BTC-huong-dan-Che-do-ke-toan-Doanh-nghiep-263599.aspx)\n2. [Django Ledger Documentation](https://django-ledger.readthedocs.io/)\n3. [Python Pandas Documentation](https://pandas.pydata.org/docs/)\n\n## 8. Phụ Lục\n\n### 8.1. Mẫu File Import\n- [Tải mẫu file Excel](templates/import_template.xlsx)\n- [Tải mẫu file CSV](templates/import_template.csv)\n\n### 8.2. Script Hỗ Trợ\n- [Script chuyển đổi từ Misa](scripts/misa_converter.py)\n- [Script chuyển đổi từ Fast](scripts/fast_converter.py)\n- [Script kiểm tra số liệu](scripts/data_validator.py)\n"])</script><script>self.__next_f.push([1,"9:[\"slug\",\"erp/migration_guide\",\"c\"]\nf:[]\n"])</script><script>self.__next_f.push([1,"0:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/erp-docs/_next/static/css/4b73dfd0f7bdc629.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"$L3\",null,{\"buildId\":\"X5KF-BjlTdL2YCafX7ACW\",\"assetPrefix\":\"/erp-docs\",\"initialCanonicalUrl\":\"/erp/migration_guide/\",\"initialTree\":[\"\",{\"children\":[[\"slug\",\"erp/migration_guide\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"erp\\\",\\\"migration_guide\\\"]}\",{}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[[\"slug\",\"erp/migration_guide\",\"c\"],{\"children\":[\"__PAGE__\",{},[[\"$L4\",[\"$\",\"$L5\",null,{\"children\":[\"$\",\"article\",null,{\"className\":\"prose prose-slate dark:prose-invert max-w-none\",\"children\":[[\"$\",\"header\",null,{\"className\":\"mb-8\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"mb-2\",\"children\":\"$undefined\"}],\"$undefined\",\"$undefined\"]}],[\"$\",\"$L6\",null,{\"content\":\"$7\"}]]}]}]],null],null]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$9\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}],null]},[[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[\"$\",\"body\",null,{\"className\":\"__className_985585\",\"children\":[\"$\",\"$Lb\",null,{\"attribute\":\"class\",\"defaultTheme\":\"system\",\"enableSystem\":true,\"disableTransitionOnChange\":true,\"children\":[\"$\",\"$Lc\",null,{\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"styles\":null}]}]}]}]}],null],null],\"couldBeIntercepted\":false,\"initialHead\":[false,\"$Ld\"],\"globalErrorComponent\":\"$e\",\"missingSlots\":\"$Wf\"}]]\n"])</script><script>self.__next_f.push([1,"d:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"undefined | ERP Documentation\"}],[\"$\",\"meta\",\"3\",{\"name\":\"keywords\",\"content\":\"documentation,ERP,technical,mermaid,markdown\"}],[\"$\",\"meta\",\"4\",{\"name\":\"next-size-adjust\"}]]\n4:null\n"])</script></body></html>