<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/erp-docs/_next/static/media/e4af272ccee01ff0-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/erp-docs/_next/static/css/4b73dfd0f7bdc629.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/erp-docs/_next/static/chunks/webpack-39532e8569213db6.js"/><script src="/erp-docs/_next/static/chunks/7384d974-8b753aa07a0575a2.js" async=""></script><script src="/erp-docs/_next/static/chunks/381-1b6d0728bba7b8e7.js" async=""></script><script src="/erp-docs/_next/static/chunks/main-app-5d87a2fd0f4f2f33.js" async=""></script><script src="/erp-docs/_next/static/chunks/d550ec10-485e3f71f5def856.js" async=""></script><script src="/erp-docs/_next/static/chunks/993-1b6a71072be86da4.js" async=""></script><script src="/erp-docs/_next/static/chunks/410-1ece2fcedd156d2f.js" async=""></script><script src="/erp-docs/_next/static/chunks/app/%5B...slug%5D/page-7978846c0e32abf5.js" async=""></script><script src="/erp-docs/_next/static/chunks/app/layout-b6ef60bec0ff2cf2.js" async=""></script><title>undefined | ERP Documentation</title><meta name="keywords" content="documentation,ERP,technical,mermaid,markdown"/><meta name="next-size-adjust"/><script src="/erp-docs/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="__className_985585"><div class="min-h-screen flex items-center justify-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div><script src="/erp-docs/_next/static/chunks/webpack-39532e8569213db6.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/erp-docs/_next/static/media/e4af272ccee01ff0-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/erp-docs/_next/static/css/4b73dfd0f7bdc629.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"3:I[5214,[],\"\"]\n5:I[3040,[\"135\",\"static/chunks/d550ec10-485e3f71f5def856.js\",\"993\",\"static/chunks/993-1b6a71072be86da4.js\",\"410\",\"static/chunks/410-1ece2fcedd156d2f.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-7978846c0e32abf5.js\"],\"DocLayout\"]\n6:I[1276,[\"135\",\"static/chunks/d550ec10-485e3f71f5def856.js\",\"993\",\"static/chunks/993-1b6a71072be86da4.js\",\"410\",\"static/chunks/410-1ece2fcedd156d2f.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-7978846c0e32abf5.js\"],\"MDXContent\"]\n8:I[6472,[],\"\"]\na:I[9190,[],\"\"]\nb:I[4550,[\"185\",\"static/chunks/app/layout-b6ef60bec0ff2cf2.js\"],\"ThemeProvider\"]\nc:I[8910,[\"185\",\"static/chunks/app/layout-b6ef60bec0ff2cf2.js\"],\"AuthProvider\"]\ne:I[3013,[],\"\"]\n7:T75b9,"])</script><script>self.__next_f.push([1,"# ACC_003_Bút Toán Kế Toán\n\n*Phiên bản: 1.0*  \n*Người tạo: AI Assistant*  \n*Ngày tạo: 25/07/2024*  \n*Cập nhật lần cuối: 25/07/2024*  \n*Người cập nhật: AI Assistant*\n\n## 1. Tổng Quan Nghiệp Vụ\n\n### 1.1. Mô Tả Nghiệp Vụ\nBút toán kế toán (Journal Entry) là nền tảng của hệ thống kế toán kép và dữ liệu tài chính của bất kỳ đơn vị nào. Bút toán kế toán là một bản ghi chứa một tập hợp các giao dịch tài chính, bao gồm ít nhất hai giao dịch. Mỗi giao dịch phải thực hiện một GHI NỢ hoặc một GHI CÓ vào một tài khoản. Mô hình Bút toán kế toán thực hiện việc xác thực bổ sung để đảm bảo rằng tổng GHI NỢ và tổng GHI CÓ bằng nhau để giữ cho sổ sách cân bằng.\n\nTrong Django Ledger, Bút toán kế toán được thể hiện thông qua model JournalEntryModel, là thành phần cốt lõi trong hệ thống kế toán. Mặc định, bút toán sẽ ở trạng thái chưa đăng tải (unposted), nghĩa là đơn giản tạo một bút toán sẽ không có tác động đến sổ sách của đơn vị. Chỉ những bút toán nằm trong một Sổ Cái đã được đăng tải (posted LedgerModel) mới có tác động đến tài chính của đơn vị.\n\n### 1.2. Phạm Vi Áp Dụng\nQuy trình quản lý Bút toán kế toán áp dụng cho:\n- Nhân viên kế toán: Những người có trách nhiệm tạo, xác minh và quản lý các bút toán kế toán hàng ngày.\n- Quản lý tài chính: Những người cần xem xét và phê duyệt các bút toán kế toán quan trọng hoặc phức tạp.\n- Kiểm toán viên: Những người cần kiểm tra tính chính xác và tính tuân thủ của các bút toán kế toán.\n- Bất kỳ người dùng nào được ủy quyền truy cập vào hệ thống kế toán để tạo hoặc xem các bút toán kế toán.\n\n### 1.3. Định Nghĩa Thuật Ngữ\n| Thuật ngữ | Định nghĩa |\n|-----------|------------|\n| Journal Entry (Bút toán kế toán) | Bản ghi kế toán chứa các giao dịch ghi nợ và ghi có liên quan đến một sự kiện tài chính. |\n| Transaction (Giao dịch) | Một phần riêng lẻ của bút toán kế toán, đại diện cho một ghi nợ hoặc ghi có vào một tài khoản cụ thể. |\n| Debit (Ghi nợ) | Một loại giao dịch làm tăng tài sản và chi phí, và làm giảm nợ phải trả, vốn chủ sở hữu và doanh thu. |\n| Credit (Ghi có) | Một loại giao dịch làm tăng nợ phải trả, vốn chủ sở hữu và doanh thu, và làm giảm tài sản và chi phí. |\n| Posting (Đăng tải) | Quá trình xác nhận một bút toán kế toán để nó có hiệu lực đối với số dư tài khoản. |\n| Locking (Khóa) | Trạng thái của một bút toán kế toán khi nó không thể được sửa đổi. |\n| Verified (Xác minh) | Trạng thái của một bút toán kế toán khi nó đã được kiểm tra để đảm bảo tính cân đối. |\n| Activity (Hoạt động) | Phân loại bút toán kế toán theo loại hoạt động (vận hành, đầu tư, tài chính). |\n\n### 1.4. Tài Liệu Liên Quan\n| STT | Mã tài liệu | Tên tài liệu | Mô tả |\n|-----|-------------|--------------|-------|\n| 1   | ACC_001 | Sơ Đồ Tài Khoản | Quy trình thiết lập và quản lý hệ thống tài khoản kế toán |\n| 2   | ACC_002 | Sổ Cái | Quy trình quản lý sổ cái và các bút toán kế toán |\n| 3   | ACC_004 | Đóng Sổ Kế Toán | Quy trình đóng sổ kế toán cuối kỳ |\n| 4   | ACC_005 | Báo Cáo Tài Chính | Quy trình tạo và xuất báo cáo tài chính |\n\n## 2. Quy Trình Nghiệp Vụ\n\n### 2.1. Tổng Quan Quy Trình\nQuy trình quản lý Bút toán kế toán bao gồm việc tạo, xác minh, đăng tải và quản lý các bút toán kế toán. Mỗi bút toán kế toán phải có ít nhất hai giao dịch (một ghi nợ và một ghi có) và tổng ghi nợ phải bằng tổng ghi có để giữ cho sổ sách cân bằng. Bút toán có thể được tạo ở trạng thái chưa đăng tải, cho phép chỉnh sửa và xác minh trước khi được đăng tải để ảnh hưởng đến số dư tài khoản.\n\n### 2.2. Sơ Đồ Quy Trình (Business Flow)\n\n```mermaid\nflowchart TD\n    A[Bắt đầu] --\u003e B[Tạo Bút toán mới]\n    B --\u003e C[Thêm Giao dịch vào Bút toán]\n    C --\u003e D{Đủ giao dịch?}\n    D --\u003e|Không| C\n    D --\u003e|Có| E[Xác minh tính cân đối]\n    E --\u003e F{Cân đối?}\n    F --\u003e|Không| G[Điều chỉnh giao dịch]\n    G --\u003e E\n    F --\u003e|Có| H[Phân loại hoạt động]\n    H --\u003e I[Khóa Bút toán]\n    I --\u003e J[Đăng tải Bút toán]\n    J --\u003e K[Cập nhật số dư tài khoản]\n    K --\u003e L[Kết thúc]\n```\n\n### 2.3. Chi Tiết Các Bước Quy Trình\n\n#### 2.3.1. Tạo Bút toán mới\n- **Mô tả**: Tạo một bút toán kế toán mới để ghi lại một sự kiện tài chính.\n- **Đầu vào**: Ngày giao dịch, mô tả, Sổ Cái liên quan, đơn vị liên quan (nếu có).\n- **Đầu ra**: Một bút toán kế toán mới được tạo trong hệ thống.\n- **Người thực hiện**: Nhân viên kế toán.\n- **Điều kiện tiên quyết**: Sổ Cái đã tồn tại và chưa bị khóa.\n- **Xử lý ngoại lệ**: Nếu Sổ Cái bị khóa, hiển thị thông báo lỗi và không cho phép tạo bút toán.\n\n#### 2.3.2. Thêm Giao dịch vào Bút toán\n- **Mô tả**: Thêm các giao dịch (ghi nợ và ghi có) vào bút toán.\n- **Đầu vào**: Tài khoản, loại giao dịch (ghi nợ/ghi có), số tiền, mô tả.\n- **Đầu ra**: Giao dịch được thêm vào bút toán.\n- **Người thực hiện**: Nhân viên kế toán.\n- **Điều kiện tiên quyết**: Bút toán đã tồn tại và chưa bị khóa.\n- **Xử lý ngoại lệ**: Nếu tài khoản không hợp lệ hoặc bút toán đã bị khóa, hiển thị thông báo lỗi.\n\n#### 2.3.3. Xác minh tính cân đối\n- **Mô tả**: Kiểm tra xem tổng ghi nợ có bằng tổng ghi có không.\n- **Đầu vào**: Bút toán với các giao dịch đã được thêm.\n- **Đầu ra**: Kết quả xác minh (cân đối/không cân đối).\n- **Người thực hiện**: Hệ thống hoặc Nhân viên kế toán.\n- **Điều kiện tiên quyết**: Bút toán có ít nhất hai giao dịch.\n- **Xử lý ngoại lệ**: Nếu bút toán không cân đối, yêu cầu điều chỉnh.\n\n#### 2.3.4. Phân loại hoạt động\n- **Mô tả**: Xác định loại hoạt động của bút toán (vận hành, đầu tư, tài chính).\n- **Đầu vào**: Bút toán đã xác minh với các giao dịch.\n- **Đầu ra**: Bút toán được phân loại với một loại hoạt động cụ thể.\n- **Người thực hiện**: Hệ thống hoặc Nhân viên kế toán.\n- **Điều kiện tiên quyết**: Bút toán đã được xác minh là cân đối.\n- **Xử lý ngoại lệ**: Nếu không thể xác định hoạt động duy nhất, hiển thị thông báo lỗi.\n\n#### 2.3.5. Khóa Bút toán\n- **Mô tả**: Khóa bút toán để ngăn chặn các thay đổi không mong muốn.\n- **Đầu vào**: Bút toán đã xác minh và phân loại.\n- **Đầu ra**: Bút toán ở trạng thái khóa.\n- **Người thực hiện**: Nhân viên kế toán hoặc Quản lý tài chính.\n- **Điều kiện tiên quyết**: Bút toán đã được xác minh và phân loại.\n- **Xử lý ngoại lệ**: Nếu bút toán đã bị khóa hoặc đã được đăng tải, hiển thị thông báo lỗi.\n\n#### 2.3.6. Đăng tải Bút toán\n- **Mô tả**: Đăng tải bút toán để nó có hiệu lực đối với số dư tài khoản.\n- **Đầu vào**: Bút toán đã khóa.\n- **Đầu ra**: Bút toán ở trạng thái đã đăng tải.\n- **Người thực hiện**: Quản lý tài chính hoặc người được ủy quyền.\n- **Điều kiện tiên quyết**: Bút toán đã bị khóa và đã được xác minh.\n- **Xử lý ngoại lệ**: Nếu bút toán không thể đăng tải, hiển thị thông báo lỗi.\n\n#### 2.3.7. Cập nhật số dư tài khoản\n- **Mô tả**: Cập nhật số dư của các tài khoản liên quan dựa trên các giao dịch trong bút toán.\n- **Đầu vào**: Bút toán đã đăng tải.\n- **Đầu ra**: Số dư tài khoản được cập nhật.\n- **Người thực hiện**: Hệ thống.\n- **Điều kiện tiên quyết**: Bút toán đã được đăng tải.\n- **Xử lý ngoại lệ**: Nếu có lỗi trong quá trình cập nhật, ghi lại lỗi và thông báo cho người dùng.\n\n### 2.4. Sơ Đồ Tuần Tự (Sequence Diagram)\n\n```mermaid\nsequenceDiagram\n    participant User as Người dùng\n    participant System as Hệ thống\n    participant JE as Bút toán\n    participant TX as Giao dịch\n    participant Account as Tài khoản\n    \n    User-\u003e\u003eSystem: Yêu cầu tạo Bút toán mới\n    System-\u003e\u003eJE: Tạo Bút toán mới\n    JE--\u003e\u003eSystem: Xác nhận tạo thành công\n    System--\u003e\u003eUser: Hiển thị Bút toán mới\n    \n    User-\u003e\u003eSystem: Thêm Giao dịch vào Bút toán\n    System-\u003e\u003eTX: Tạo Giao dịch mới\n    TX-\u003e\u003eAccount: Kiểm tra Tài khoản\n    Account--\u003e\u003eTX: Xác nhận Tài khoản hợp lệ\n    TX--\u003e\u003eSystem: Xác nhận tạo thành công\n    System--\u003e\u003eUser: Hiển thị Giao dịch mới\n    \n    User-\u003e\u003eSystem: Yêu cầu xác minh Bút toán\n    System-\u003e\u003eJE: Kiểm tra tính cân đối\n    JE--\u003e\u003eSystem: Kết quả kiểm tra\n    System--\u003e\u003eUser: Hiển thị kết quả kiểm tra\n    \n    alt Không cân đối\n        User-\u003e\u003eSystem: Điều chỉnh Giao dịch\n        System-\u003e\u003eTX: Cập nhật Giao dịch\n        TX--\u003e\u003eSystem: Xác nhận cập nhật\n        System--\u003e\u003eUser: Hiển thị Giao dịch đã cập nhật\n        User-\u003e\u003eSystem: Yêu cầu xác minh lại\n        System-\u003e\u003eJE: Kiểm tra lại tính cân đối\n        JE--\u003e\u003eSystem: Kết quả kiểm tra\n        System--\u003e\u003eUser: Hiển thị kết quả kiểm tra\n    end\n    \n    User-\u003e\u003eSystem: Yêu cầu phân loại hoạt động\n    System-\u003e\u003eJE: Xác định loại hoạt động\n    JE--\u003e\u003eSystem: Loại hoạt động\n    System--\u003e\u003eUser: Hiển thị loại hoạt động\n    \n    User-\u003e\u003eSystem: Yêu cầu khóa Bút toán\n    System-\u003e\u003eJE: Khóa Bút toán\n    JE--\u003e\u003eSystem: Xác nhận khóa thành công\n    System--\u003e\u003eUser: Hiển thị trạng thái đã khóa\n    \n    User-\u003e\u003eSystem: Yêu cầu đăng tải Bút toán\n    System-\u003e\u003eJE: Đăng tải Bút toán\n    JE-\u003e\u003eAccount: Cập nhật số dư Tài khoản\n    Account--\u003e\u003eJE: Xác nhận cập nhật\n    JE--\u003e\u003eSystem: Xác nhận đăng tải thành công\n    System--\u003e\u003eUser: Hiển thị trạng thái đã đăng tải\n```\n\n### 2.5. Luồng Nghiệp Vụ Thay Thế\n1. **Hủy đăng tải Bút toán**:\n   - Khi phát hiện lỗi trong bút toán đã đăng tải, người dùng có thể hủy đăng tải nếu bút toán chưa bị khóa và không thuộc kỳ kế toán đã đóng.\n   - Hệ thống sẽ hoàn tác các thay đổi về số dư tài khoản.\n   - Người dùng có thể sửa đổi bút toán và đăng tải lại.\n\n2. **Mở khóa Bút toán**:\n   - Nếu cần sửa đổi bút toán đã khóa, người dùng có thể yêu cầu mở khóa.\n   - Chỉ có thể mở khóa nếu bút toán chưa được đăng tải và không thuộc kỳ kế toán đã đóng.\n   - Sau khi mở khóa, người dùng có thể chỉnh sửa bút toán và khóa lại.\n\n3. **Xóa Bút toán**:\n   - Người dùng có thể xóa bút toán nếu nó chưa bị khóa và chưa được đăng tải.\n   - Hệ thống sẽ xóa tất cả các giao dịch liên quan đến bút toán.\n   - Không thể khôi phục bút toán đã xóa, nên cần thận trọng khi thực hiện.\n\n## 3. Yêu Cầu Chức Năng\n\n### 3.1. Danh Sách Chức Năng\n\n| STT | Mã chức năng | Tên chức năng | Mô tả | Độ ưu tiên |\n|-----|--------------|---------------|-------|------------|\n| 1   | JE_001 | Tạo Bút toán | Tạo bút toán kế toán mới | Cao |\n| 2   | JE_002 | Thêm/Sửa Giao dịch | Thêm hoặc sửa giao dịch trong bút toán | Cao |\n| 3   | JE_003 | Xác minh Bút toán | Kiểm tra tính cân đối của bút toán | Cao |\n| 4   | JE_004 | Phân loại Hoạt động | Xác định loại hoạt động của bút toán | Trung bình |\n| 5   | JE_005 | Khóa/Mở khóa Bút toán | Khóa hoặc mở khóa bút toán | Cao |\n| 6   | JE_006 | Đăng tải/Hủy đăng tải Bút toán | Đăng tải hoặc hủy đăng tải bút toán | Cao |\n| 7   | JE_007 | Xóa Bút toán | Xóa bút toán khỏi hệ thống | Thấp |\n| 8   | JE_008 | Xem chi tiết Bút toán | Xem thông tin chi tiết về bút toán | Trung bình |\n| 9   | JE_009 | Tìm kiếm/Lọc Bút toán | Tìm kiếm và lọc bút toán theo nhiều tiêu chí | Trung bình |\n\n### 3.2. Chi Tiết Chức Năng\n\n#### 3.2.1. JE_001: Tạo Bút toán\n- **Mô tả**: Cho phép người dùng tạo một bút toán kế toán mới.\n- **Đầu vào**: \n  - Sổ Cái liên quan\n  - Ngày giao dịch (timestamp)\n  - Mô tả (tùy chọn)\n  - Đơn vị liên quan (tùy chọn)\n- **Đầu ra**: Bút toán mới được tạo trong hệ thống.\n- **Điều kiện tiên quyết**: Sổ Cái tồn tại và chưa bị khóa.\n- **Luồng xử lý chính**:\n  1. Người dùng truy cập chức năng tạo bút toán.\n  2. Người dùng chọn Sổ Cái.\n  3. Người dùng nhập các thông tin cần thiết.\n  4. Hệ thống xác thực thông tin.\n  5. Hệ thống tạo bút toán mới.\n- **Luồng xử lý thay thế/ngoại lệ**:\n  1. Nếu Sổ Cái bị khóa, hiển thị thông báo lỗi.\n  2. Nếu thông tin không hợp lệ, hiển thị thông báo lỗi và yêu cầu nhập lại.\n- **Giao diện liên quan**: Màn hình tạo bút toán.\n\n#### 3.2.2. JE_002: Thêm/Sửa Giao dịch\n- **Mô tả**: Cho phép người dùng thêm hoặc sửa giao dịch trong bút toán.\n- **Đầu vào**: \n  - Bút toán liên quan\n  - Tài khoản\n  - Loại giao dịch (ghi nợ/ghi có)\n  - Số tiền\n  - Mô tả (tùy chọn)\n- **Đầu ra**: Giao dịch được thêm hoặc cập nhật trong bút toán.\n- **Điều kiện tiên quyết**: Bút toán tồn tại và chưa bị khóa.\n- **Luồng xử lý chính**:\n  1. Người dùng truy cập chi tiết bút toán.\n  2. Người dùng thêm mới hoặc chọn giao dịch để sửa.\n  3. Người dùng nhập/cập nhật thông tin giao dịch.\n  4. Hệ thống xác thực thông tin.\n  5. Hệ thống lưu giao dịch.\n- **Luồng xử lý thay thế/ngoại lệ**:\n  1. Nếu bút toán bị khóa, hiển thị thông báo lỗi.\n  2. Nếu thông tin không hợp lệ, hiển thị thông báo lỗi và yêu cầu nhập lại.\n- **Giao diện liên quan**: Màn hình chi tiết bút toán, form thêm/sửa giao dịch.\n\n#### 3.2.3. JE_003: Xác minh Bút toán\n- **Mô tả**: Kiểm tra tính cân đối và hợp lệ của bút toán.\n- **Đầu vào**: Bút toán cần xác minh.\n- **Đầu ra**: Kết quả xác minh (hợp lệ/không hợp lệ).\n- **Điều kiện tiên quyết**: Bút toán có ít nhất hai giao dịch.\n- **Luồng xử lý chính**:\n  1. Người dùng yêu cầu xác minh bút toán.\n  2. Hệ thống kiểm tra tính cân đối (tổng ghi nợ = tổng ghi có).\n  3. Hệ thống kiểm tra tính hợp lệ của các tài khoản.\n  4. Hệ thống hiển thị kết quả xác minh.\n- **Luồng xử lý thay thế/ngoại lệ**:\n  1. Nếu bút toán không cân đối, hiển thị thông báo lỗi với chi tiết về sự chênh lệch.\n  2. Nếu các tài khoản không hợp lệ, hiển thị thông báo lỗi.\n- **Giao diện liên quan**: Màn hình chi tiết bút toán, thông báo kết quả xác minh.\n\n#### 3.2.4. JE_004: Phân loại Hoạt động\n- **Mô tả**: Xác định loại hoạt động của bút toán (vận hành, đầu tư, tài chính).\n- **Đầu vào**: Bút toán cần phân loại.\n- **Đầu ra**: Bút toán được phân loại với một loại hoạt động cụ thể.\n- **Điều kiện tiên quyết**: Bút toán đã được xác minh là cân đối.\n- **Luồng xử lý chính**:\n  1. Hệ thống phân tích các tài khoản và giao dịch trong bút toán.\n  2. Hệ thống xác định loại hoạt động dựa trên vai trò của các tài khoản.\n  3. Hệ thống cập nhật trường hoạt động của bút toán.\n- **Luồng xử lý thay thế/ngoại lệ**:\n  1. Nếu không thể xác định hoạt động duy nhất, hiển thị thông báo lỗi.\n  2. Người dùng có thể chọn hoạt động thủ công nếu hệ thống không thể xác định.\n- **Giao diện liên quan**: Màn hình chi tiết bút toán, dropdown chọn hoạt động.\n\n#### 3.2.5. JE_005: Khóa/Mở khóa Bút toán\n- **Mô tả**: Cho phép khóa hoặc mở khóa bút toán.\n- **Đầu vào**: Bút toán cần khóa/mở khóa.\n- **Đầu ra**: Bút toán với trạng thái khóa được cập nhật.\n- **Điều kiện tiên quyết**: \n  - Khóa: Bút toán chưa bị khóa và Sổ Cái chưa bị khóa.\n  - Mở khóa: Bút toán đã bị khóa, chưa được đăng tải, không thuộc kỳ kế toán đã đóng, và Sổ Cái chưa bị khóa.\n- **Luồng xử lý chính**:\n  1. Người dùng yêu cầu khóa/mở khóa bút toán.\n  2. Hệ thống kiểm tra các điều kiện tiên quyết.\n  3. Hệ thống cập nhật trạng thái khóa của bút toán.\n  4. Hệ thống hiển thị kết quả.\n- **Luồng xử lý thay thế/ngoại lệ**:\n  1. Nếu không thỏa mãn điều kiện tiên quyết, hiển thị thông báo lỗi.\n- **Giao diện liên quan**: Màn hình chi tiết bút toán, nút khóa/mở khóa.\n\n#### 3.2.6. JE_006: Đăng tải/Hủy đăng tải Bút toán\n- **Mô tả**: Cho phép đăng tải hoặc hủy đăng tải bút toán.\n- **Đầu vào**: Bút toán cần đăng tải/hủy đăng tải.\n- **Đầu ra**: Bút toán với trạng thái đăng tải được cập nhật.\n- **Điều kiện tiên quyết**: \n  - Đăng tải: Bút toán đã bị khóa, đã được xác minh, và Sổ Cái chưa bị khóa.\n  - Hủy đăng tải: Bút toán đã được đăng tải, không thuộc kỳ kế toán đã đóng, và Sổ Cái chưa bị khóa.\n- **Luồng xử lý chính**:\n  1. Người dùng yêu cầu đăng tải/hủy đăng tải bút toán.\n  2. Hệ thống kiểm tra các điều kiện tiên quyết.\n  3. Hệ thống cập nhật trạng thái đăng tải của bút toán.\n  4. Hệ thống cập nhật số dư tài khoản liên quan.\n  5. Hệ thống hiển thị kết quả.\n- **Luồng xử lý thay thế/ngoại lệ**:\n  1. Nếu không thỏa mãn điều kiện tiên quyết, hiển thị thông báo lỗi.\n  2. Nếu có lỗi khi cập nhật số dư tài khoản, ghi lại lỗi và thông báo cho người dùng.\n- **Giao diện liên quan**: Màn hình chi tiết bút toán, nút đăng tải/hủy đăng tải.\n\n## 4. Thiết Kế Kỹ Thuật\n\n### 4.1. Kiến Trúc Hệ Thống\n\n```mermaid\nflowchart TD\n    A[Client] --\u003e B[API Gateway]\n    B --\u003e C[Journal Entry Service]\n    B --\u003e D[Transaction Service]\n    B --\u003e E[Account Service]\n    C --\u003e F[(Database)]\n    D --\u003e F\n    E --\u003e F\n```\n\n### 4.2. API Endpoints\n\n#### 4.2.1. Quản lý Bút toán kế toán\n- **Mô tả**: API để quản lý Bút toán kế toán\n- **URL**: `GET /api/v1/entity/{entity_slug}/ledgers/{ledger_pk}/journal-entries/` - Lấy danh sách Bút toán\n- **URL**: `POST /api/v1/entity/{entity_slug}/ledgers/{ledger_pk}/journal-entries/` - Tạo Bút toán mới\n- **URL**: `GET /api/v1/entity/{entity_slug}/ledgers/{ledger_pk}/journal-entries/{je_pk}/` - Lấy thông tin Bút toán\n- **URL**: `PUT /api/v1/entity/{entity_slug}/ledgers/{ledger_pk}/journal-entries/{je_pk}/` - Cập nhật Bút toán\n- **URL**: `DELETE /api/v1/entity/{entity_slug}/ledgers/{ledger_pk}/journal-entries/{je_pk}/` - Xóa Bút toán\n\n#### 4.2.2. Quản lý Giao dịch\n- **Mô tả**: API để quản lý Giao dịch trong Bút toán\n- **URL**: `GET /api/v1/entity/{entity_slug}/ledgers/{ledger_pk}/journal-entries/{je_pk}/txs/` - Lấy danh sách Giao dịch\n- **URL**: `POST /api/v1/entity/{entity_slug}/ledgers/{ledger_pk}/journal-entries/{je_pk}/txs/` - Thêm Giao dịch mới\n\n#### 4.2.3. Thao tác với Bút toán\n- **Mô tả**: API để thực hiện các thao tác với Bút toán\n- **URL**: `PATCH /api/v1/entity/{entity_slug}/ledgers/{ledger_pk}/journal-entries/{je_pk}/lock/` - Khóa Bút toán\n- **URL**: `PATCH /api/v1/entity/{entity_slug}/ledgers/{ledger_pk}/journal-entries/{je_pk}/unlock/` - Mở khóa Bút toán\n- **URL**: `PATCH /api/v1/entity/{entity_slug}/ledgers/{ledger_pk}/journal-entries/{je_pk}/post/` - Đăng tải Bút toán\n- **URL**: `PATCH /api/v1/entity/{entity_slug}/ledgers/{ledger_pk}/journal-entries/{je_pk}/unpost/` - Hủy đăng tải Bút toán\n\n### 4.3. Service Logic\n\n#### 4.3.1. Journal Entry Service\n- **Mô tả**: Service xử lý logic liên quan đến Bút toán kế toán\n- **Chức năng chính**:\n  1. Tạo và quản lý Bút toán\n  2. Xác minh tính cân đối của Bút toán\n  3. Phân loại hoạt động của Bút toán\n  4. Đăng tải và khóa Bút toán\n- **Các dependencies**:\n  1. Transaction Service\n  2. Account Service\n  3. Ledger Service\n- **Sơ đồ luồng xử lý**:\n\n```mermaid\nflowchart TD\n    A[Nhận request] --\u003e B[Validate dữ liệu]\n    B --\u003e C{Dữ liệu hợp lệ?}\n    C --\u003e|Có| D[Xử lý business logic]\n    C --\u003e|Không| E[Trả về lỗi]\n    D --\u003e F{Bút toán cân đối?}\n    F --\u003e|Có| G[Xử lý tiếp]\n    F --\u003e|Không| H[Trả về lỗi cân đối]\n    G --\u003e I[Phân loại hoạt động]\n    I --\u003e J[Ghi log]\n    J --\u003e K[Trả về kết quả]\n    E --\u003e J\n    H --\u003e J\n```\n\n#### 4.3.2. Transaction Service\n- **Mô tả**: Service xử lý logic liên quan đến Giao dịch trong Bút toán\n- **Chức năng chính**:\n  1. Tạo và quản lý Giao dịch\n  2. Xác minh tính hợp lệ của Giao dịch\n  3. Cập nhật số dư Tài khoản khi Bút toán được đăng tải\n- **Các dependencies**:\n  1. Journal Entry Service\n  2. Account Service\n- **Sơ đồ luồng xử lý**:\n\n```mermaid\nflowchart TD\n    A[Nhận request] --\u003e B[Validate dữ liệu]\n    B --\u003e C{Dữ liệu hợp lệ?}\n    C --\u003e|Có| D[Xử lý business logic]\n    C --\u003e|Không| E[Trả về lỗi]\n    D --\u003e F{Tài khoản hợp lệ?}\n    F --\u003e|Có| G[Xử lý tiếp]\n    F --\u003e|Không| H[Trả về lỗi tài khoản]\n    G --\u003e I[Ghi log]\n    I --\u003e J[Trả về kết quả]\n    E --\u003e I\n    H --\u003e I\n```\n\n### 4.4. Mô Hình Dữ Liệu\n\n#### 4.4.1. Entity Relationship Diagram (ERD)\n\n```mermaid\nerDiagram\n    LEDGER ||--o{ JOURNAL_ENTRY : contains\n    JOURNAL_ENTRY ||--o{ TRANSACTION : contains\n    TRANSACTION }o--|| ACCOUNT : references\n    ACCOUNT }o--|| CHART_OF_ACCOUNTS : belongs_to\n    ENTITY_UNIT }o--o{ JOURNAL_ENTRY : is_associated_with\n    \n    LEDGER {\n        uuid uuid PK\n        name string\n        entity uuid FK\n        posted boolean\n        locked boolean\n        hidden boolean\n    }\n    \n    JOURNAL_ENTRY {\n        uuid uuid PK\n        je_number string\n        timestamp datetime\n        description string\n        entity_unit uuid FK\n        activity string\n        origin string\n        posted boolean\n        locked boolean\n        is_closing_entry boolean\n        ledger uuid FK\n    }\n    \n    TRANSACTION {\n        uuid uuid PK\n        account uuid FK\n        tx_type string\n        amount decimal\n        description string\n        journal_entry uuid FK\n    }\n    \n    ACCOUNT {\n        uuid uuid PK\n        code string\n        name string\n        role string\n        balance_type string\n        coa_model uuid FK\n    }\n    \n    CHART_OF_ACCOUNTS {\n        uuid uuid PK\n        name string\n        slug string\n        entity uuid FK\n    }\n    \n    ENTITY_UNIT {\n        uuid uuid PK\n        name string\n        slug string\n        entity uuid FK\n    }\n```\n\n#### 4.4.2. Chi Tiết Bảng Dữ Liệu\n\n##### Bảng: JournalEntryModel\n- **Mô tả**: Lưu trữ thông tin về Bút toán kế toán\n- **Các trường chính**:\n  - `uuid`: UUID - Khóa chính\n  - `je_number`: SlugField - Mã bút toán\n  - `timestamp`: DateTimeField - Thời gian giao dịch\n  - `description`: CharField - Mô tả\n  - `entity_unit`: ForeignKey - Liên kết với EntityUnit\n  - `activity`: CharField - Loại hoạt động\n  - `origin`: CharField - Nguồn gốc\n  - `posted`: BooleanField - Trạng thái đăng tải\n  - `locked`: BooleanField - Trạng thái khóa\n  - `is_closing_entry`: BooleanField - Là bút toán đóng sổ\n  - `ledger`: ForeignKey - Liên kết với Ledger\n\n##### Bảng: TransactionModel\n- **Mô tả**: Lưu trữ thông tin về Giao dịch trong Bút toán\n- **Các trường chính**:\n  - `uuid`: UUID - Khóa chính\n  - `account`: ForeignKey - Liên kết với Account\n  - `tx_type`: CharField - Loại giao dịch (ghi nợ/ghi có)\n  - `amount`: DecimalField - Số tiền\n  - `description`: CharField - Mô tả\n  - `journal_entry`: ForeignKey - Liên kết với JournalEntry\n\n## 5. Kế Hoạch Kiểm Thử\n\n### 5.1. Phạm Vi Kiểm Thử\nKiểm thử sẽ tập trung vào các chức năng chính của Bút toán kế toán, bao gồm:\n- Tạo và quản lý Bút toán\n- Thêm và quản lý Giao dịch\n- Xác minh tính cân đối của Bút toán\n- Phân loại hoạt động của Bút toán\n- Khóa và đăng tải Bút toán\n- Cập nhật số dư Tài khoản khi Bút toán được đăng tải\n\n### 5.2. Kịch Bản Kiểm Thử\n\n| STT | Mã kịch bản | Tên kịch bản | Mô tả | Điều kiện tiên quyết | Các bước | Kết quả mong đợi |\n|-----|------------|--------------|-------|---------------------|----------|-----------------|\n| 1   | JE_TEST_001 | Tạo Bút toán | Kiểm tra việc tạo Bút toán mới | Sổ Cái đã tồn tại và chưa bị khóa | 1. Truy cập chức năng tạo Bút toán\u003cbr\u003e2. Nhập thông tin Bút toán\u003cbr\u003e3. Lưu Bút toán | Bút toán mới được tạo thành công |\n| 2   | JE_TEST_002 | Thêm Giao dịch | Kiểm tra việc thêm Giao dịch vào Bút toán | Bút toán đã tồn tại và chưa bị khóa | 1. Truy cập chi tiết Bút toán\u003cbr\u003e2. Thêm Giao dịch mới\u003cbr\u003e3. Lưu Giao dịch | Giao dịch mới được thêm thành công |\n| 3   | JE_TEST_003 | Xác minh tính cân đối | Kiểm tra việc xác minh tính cân đối của Bút toán | Bút toán có các Giao dịch | 1. Thêm các Giao dịch cân đối\u003cbr\u003e2. Yêu cầu xác minh Bút toán | Bút toán được xác minh là cân đối |\n| 4   | JE_TEST_004 | Phân loại hoạt động | Kiểm tra việc phân loại hoạt động của Bút toán | Bút toán đã được xác minh là cân đối | 1. Truy cập chi tiết Bút toán\u003cbr\u003e2. Yêu cầu phân loại hoạt động | Bút toán được phân loại với hoạt động phù hợp |\n| 5   | JE_TEST_005 | Khóa Bút toán | Kiểm tra việc khóa Bút toán | Bút toán chưa bị khóa | 1. Truy cập chi tiết Bút toán\u003cbr\u003e2. Yêu cầu khóa Bút toán | Bút toán được khóa thành công |\n| 6   | JE_TEST_006 | Đăng tải Bút toán | Kiểm tra việc đăng tải Bút toán | Bút toán đã bị khóa và đã được xác minh | 1. Truy cập chi tiết Bút toán\u003cbr\u003e2. Yêu cầu đăng tải Bút toán | Bút toán được đăng tải thành công và số dư Tài khoản được cập nhật |\n| 7   | JE_TEST_007 | Xóa Bút toán | Kiểm tra việc xóa Bút toán | Bút toán chưa bị khóa và chưa được đăng tải | 1. Truy cập chi tiết Bút toán\u003cbr\u003e2. Yêu cầu xóa Bút toán | Bút toán được xóa thành công |\n| 8   | JE_TEST_008 | Tìm kiếm Bút toán | Kiểm tra việc tìm kiếm Bút toán | Có nhiều Bút toán trong hệ thống | 1. Truy cập chức năng tìm kiếm\u003cbr\u003e2. Nhập tiêu chí tìm kiếm\u003cbr\u003e3. Thực hiện tìm kiếm | Kết quả tìm kiếm chính xác |\n\n## 6. Phụ Lục\n\n### 6.1. Danh Sách Tài Liệu Tham Khảo\n- Django Ledger Documentation\n- Accounting Principles - Weygandt, Kieso, Kimmel\n- Django Framework Documentation\n- Python Documentation\n\n### 6.2. Danh Mục Thuật Ngữ\n- **Journal Entry (Bút toán kế toán)**: Bản ghi kế toán chứa các giao dịch ghi nợ và ghi có liên quan đến một sự kiện tài chính.\n- **Transaction (Giao dịch)**: Một phần riêng lẻ của bút toán kế toán, đại diện cho một ghi nợ hoặc ghi có vào một tài khoản cụ thể.\n- **Debit (Ghi nợ)**: Một loại giao dịch làm tăng tài sản và chi phí, và làm giảm nợ phải trả, vốn chủ sở hữu và doanh thu.\n- **Credit (Ghi có)**: Một loại giao dịch làm tăng nợ phải trả, vốn chủ sở hữu và doanh thu, và làm giảm tài sản và chi phí.\n- **Posting (Đăng tải)**: Quá trình xác nhận một bút toán kế toán để nó có hiệu lực đối với số dư tài khoản.\n- **Locking (Khóa)**: Trạng thái của một bút toán kế toán khi nó không thể được sửa đổi.\n- **Activity (Hoạt động)**: Phân loại bút toán kế toán theo loại hoạt động (vận hành, đầu tư, tài chính).\n\n### 6.3. Lịch Sử Thay Đổi Tài Liệu\n\n| Phiên bản | Ngày | Người thực hiện | Mô tả thay đổi |\n|-----------|------|-----------------|---------------|\n| 1.0 | 25/07/2024 | AI Assistant | Tạo tài liệu ban đầu |"])</script><script>self.__next_f.push([1,"9:[\"slug\",\"erp/ACC_003_But_Toan_Ke_Toan\",\"c\"]\nf:[]\n"])</script><script>self.__next_f.push([1,"0:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/erp-docs/_next/static/css/4b73dfd0f7bdc629.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"$L3\",null,{\"buildId\":\"X5KF-BjlTdL2YCafX7ACW\",\"assetPrefix\":\"/erp-docs\",\"initialCanonicalUrl\":\"/erp/ACC_003_But_Toan_Ke_Toan/\",\"initialTree\":[\"\",{\"children\":[[\"slug\",\"erp/ACC_003_But_Toan_Ke_Toan\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"erp\\\",\\\"ACC_003_But_Toan_Ke_Toan\\\"]}\",{}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[[\"slug\",\"erp/ACC_003_But_Toan_Ke_Toan\",\"c\"],{\"children\":[\"__PAGE__\",{},[[\"$L4\",[\"$\",\"$L5\",null,{\"children\":[\"$\",\"article\",null,{\"className\":\"prose prose-slate dark:prose-invert max-w-none\",\"children\":[[\"$\",\"header\",null,{\"className\":\"mb-8\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"mb-2\",\"children\":\"$undefined\"}],\"$undefined\",\"$undefined\"]}],[\"$\",\"$L6\",null,{\"content\":\"$7\"}]]}]}]],null],null]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$9\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}],null]},[[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[\"$\",\"body\",null,{\"className\":\"__className_985585\",\"children\":[\"$\",\"$Lb\",null,{\"attribute\":\"class\",\"defaultTheme\":\"system\",\"enableSystem\":true,\"disableTransitionOnChange\":true,\"children\":[\"$\",\"$Lc\",null,{\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"styles\":null}]}]}]}]}],null],null],\"couldBeIntercepted\":false,\"initialHead\":[false,\"$Ld\"],\"globalErrorComponent\":\"$e\",\"missingSlots\":\"$Wf\"}]]\n"])</script><script>self.__next_f.push([1,"d:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"undefined | ERP Documentation\"}],[\"$\",\"meta\",\"3\",{\"name\":\"keywords\",\"content\":\"documentation,ERP,technical,mermaid,markdown\"}],[\"$\",\"meta\",\"4\",{\"name\":\"next-size-adjust\"}]]\n4:null\n"])</script></body></html>