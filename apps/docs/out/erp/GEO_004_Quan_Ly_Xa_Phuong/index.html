<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/erp-docs/_next/static/media/e4af272ccee01ff0-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/erp-docs/_next/static/css/4b73dfd0f7bdc629.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/erp-docs/_next/static/chunks/webpack-39532e8569213db6.js"/><script src="/erp-docs/_next/static/chunks/7384d974-8b753aa07a0575a2.js" async=""></script><script src="/erp-docs/_next/static/chunks/381-1b6d0728bba7b8e7.js" async=""></script><script src="/erp-docs/_next/static/chunks/main-app-5d87a2fd0f4f2f33.js" async=""></script><script src="/erp-docs/_next/static/chunks/d550ec10-485e3f71f5def856.js" async=""></script><script src="/erp-docs/_next/static/chunks/993-1b6a71072be86da4.js" async=""></script><script src="/erp-docs/_next/static/chunks/410-1ece2fcedd156d2f.js" async=""></script><script src="/erp-docs/_next/static/chunks/app/%5B...slug%5D/page-7978846c0e32abf5.js" async=""></script><script src="/erp-docs/_next/static/chunks/app/layout-b6ef60bec0ff2cf2.js" async=""></script><title>undefined | ERP Documentation</title><meta name="keywords" content="documentation,ERP,technical,mermaid,markdown"/><meta name="next-size-adjust"/><script src="/erp-docs/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="__className_985585"><div class="min-h-screen flex items-center justify-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div><script src="/erp-docs/_next/static/chunks/webpack-39532e8569213db6.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/erp-docs/_next/static/media/e4af272ccee01ff0-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/erp-docs/_next/static/css/4b73dfd0f7bdc629.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"3:I[5214,[],\"\"]\n5:I[3040,[\"135\",\"static/chunks/d550ec10-485e3f71f5def856.js\",\"993\",\"static/chunks/993-1b6a71072be86da4.js\",\"410\",\"static/chunks/410-1ece2fcedd156d2f.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-7978846c0e32abf5.js\"],\"DocLayout\"]\n6:I[1276,[\"135\",\"static/chunks/d550ec10-485e3f71f5def856.js\",\"993\",\"static/chunks/993-1b6a71072be86da4.js\",\"410\",\"static/chunks/410-1ece2fcedd156d2f.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-7978846c0e32abf5.js\"],\"MDXContent\"]\n8:I[6472,[],\"\"]\na:I[9190,[],\"\"]\nb:I[4550,[\"185\",\"static/chunks/app/layout-b6ef60bec0ff2cf2.js\"],\"ThemeProvider\"]\nc:I[8910,[\"185\",\"static/chunks/app/layout-b6ef60bec0ff2cf2.js\"],\"AuthProvider\"]\ne:I[3013,[],\"\"]\n7:T5246,"])</script><script>self.__next_f.push([1,"# GEO_004_Geography_Quản Lý Xã Phường\n\n*Phiên bản: 1.0*\n*Người tạo: Cline*\n*Ngày tạo: 13/05/2025*\n*Cập nhật lần cuối: 13/05/2025*\n*Người cập nhật: Cline*\n\n## 1. Tổng Quan Nghiệp Vụ\n\n### 1.1. Mô Tả Nghiệp Vụ\nNghiệp vụ này cho phép quản lý thông tin các xã/phường/thị trấn trong hệ thống ERP. Bao gồm việc tạo mới, xem, cập nhật và xóa thông tin xã phường. Thông tin xã phường là cấp địa lý chi tiết nhất, cần thiết cho việc định vị chính xác địa chỉ giao hàng, thu thập dữ liệu dân cư, và các ứng dụng địa lý chuyên sâu.\n\n### 1.2. Phạm Vi Áp Dụng\nÁp dụng cho các bộ phận cần sử dụng thông tin địa lý ở mức độ chi tiết cao nhất, như bộ phận giao vận, chăm sóc khách hàng, nghiên cứu thị trường. Người dùng có quyền quản trị hệ thống hoặc được phân quyền cụ thể mới có thể thực hiện các thao tác quản lý xã phường.\n\n### 1.3. Định Nghĩa Thuật Ngữ\n| Thuật ngữ | Định nghĩa |\n|-----------|------------|\n| Mã Xã Phường (ma_xa) | Mã định danh duy nhất cho mỗi xã phường trong một quận huyện. |\n| Tên Xã Phường (ten_xa) | Tên chính thức của xã phường. |\n| Tên Xã Phường Khác (ten_xa2) | Tên thay thế hoặc tên tiếng Anh của xã phường. |\n| Quận Huyện (quan_huyen) | Quận huyện mà xã phường này trực thuộc. |\n| Trạng Thái (status) | Trạng thái của xã phường (ví dụ: 1 - Hoạt động, 0 - Không hoạt động). |\n| Entity (Đơn vị) | Đơn vị/Công ty sử dụng hệ thống ERP. Mỗi xã phường được quản lý trong phạm vi một Entity cụ thể. |\n\n### 1.4. Tài Liệu Liên Quan\n| STT | Mã tài liệu | Tên tài liệu | Mô tả |\n|-----|-------------|--------------|-------|\n| 1   | GEO_003 | Quản Lý Quận Huyện | Tài liệu mô tả quy trình quản lý thông tin quận huyện, là cấp cha của xã phường. |\n| 2   | GEO_006 | Quản Lý Địa Chỉ | Tài liệu mô tả quy trình quản lý thông tin địa chỉ, sử dụng thông tin xã phường. |\n\n## 2. Quy Trình Nghiệp Vụ\n\n### 2.1. Tổng Quan Quy Trình\nQuy trình quản lý xã phường bao gồm các bước: người dùng yêu cầu thực hiện thao tác (thêm, sửa, xóa, xem danh sách, xem chi tiết), hệ thống kiểm tra dữ liệu và quyền hạn, sau đó thực thi yêu cầu và phản hồi kết quả cho người dùng.\n\n### 2.2. Sơ Đồ Quy Trình (Business Flow)\n\n```mermaid\nflowchart TD\n    A[Người dùng yêu cầu thao tác quản lý xã phường] --\u003e B{Chọn thao tác};\n    B --\u003e|Thêm mới| C[Nhập thông tin xã phường (bao gồm chọn Quận Huyện)];\n    B --\u003e|Cập nhật| D[Chọn xã phường \u0026 Nhập thông tin mới];\n    B --\u003e|Xóa| E[Chọn xã phường \u0026 Xác nhận xóa];\n    B --\u003e|Xem danh sách| F[Hệ thống hiển thị danh sách xã phường (có thể lọc theo Quận Huyện)];\n    B --\u003e|Xem chi tiết| G[Chọn xã phường \u0026 Hệ thống hiển thị chi tiết];\n    C --\u003e H[Hệ thống kiểm tra dữ liệu];\n    D --\u003e H;\n    H --\u003e|Hợp lệ| I[Lưu thông tin vào CSDL];\n    H --\u003e|Không hợp lệ| J[Thông báo lỗi];\n    I --\u003e K[Thông báo thành công];\n    E --\u003e L[Hệ thống kiểm tra ràng buộc (ví dụ: Địa Chỉ)];\n    L --\u003e|Không có ràng buộc| M[Xóa xã phường khỏi CSDL];\n    L --\u003e|Có ràng buộc| N[Thông báo lỗi không thể xóa];\n    M --\u003e K;\n    F --\u003e Z[Kết thúc];\n    G --\u003e Z;\n    J --\u003e A;\n    K --\u003e A;\n    N --\u003e A;\n```\n\n### 2.3. Chi Tiết Các Bước Quy Trình\n\n#### 2.3.1. Thêm Mới Xã Phường\n- **Mô tả**: Người dùng cung cấp thông tin để tạo một xã phường mới, liên kết với một quận huyện cụ thể.\n- **Đầu vào**: Mã xã phường, tên xã phường, tên xã phường khác (tùy chọn), UUID của quận huyện, trạng thái (mặc định là hoạt động).\n- **Đầu ra**: Xã phường mới được tạo trong hệ thống.\n- **Người thực hiện**: Quản trị viên hệ thống hoặc người dùng được phân quyền.\n- **Điều kiện tiên quyết**: Người dùng đã đăng nhập và có quyền. Quận huyện liên kết phải tồn tại. Mã xã phường không được trùng lặp trong cùng một quận huyện và Entity.\n- **Xử lý ngoại lệ**:\n    - Nếu mã xã phường đã tồn tại trong quận huyện đó: Thông báo lỗi.\n    - Nếu quận huyện không tồn tại: Thông báo lỗi.\n    - Nếu thông tin không hợp lệ: Thông báo lỗi.\n\n#### 2.3.2. Cập Nhật Thông Tin Xã Phường\n- **Mô tả**: Người dùng thay đổi thông tin của một xã phường đã tồn tại.\n- **Đầu vào**: UUID của xã phường cần cập nhật, thông tin mới (mã xã phường, tên xã phường, tên xã phường khác, UUID quận huyện, trạng thái).\n- **Đầu ra**: Thông tin xã phường được cập nhật trong hệ thống.\n- **Người thực hiện**: Quản trị viên hệ thống hoặc người dùng được phân quyền.\n- **Điều kiện tiên quyết**: Xã phường tồn tại trong hệ thống. Người dùng có quyền cập nhật.\n- **Xử lý ngoại lệ**:\n    - Nếu xã phường không tồn tại: Thông báo lỗi.\n    - Nếu mã xã phường mới (nếu thay đổi) đã tồn tại cho một xã phường khác trong cùng quận huyện: Thông báo lỗi.\n    - Nếu thông tin không hợp lệ: Thông báo lỗi.\n\n#### 2.3.3. Xóa Xã Phường\n- **Mô tả**: Người dùng xóa một xã phường khỏi hệ thống.\n- **Đầu vào**: UUID của xã phường cần xóa.\n- **Đầu ra**: Xã phường bị xóa khỏi hệ thống (nếu không có ràng buộc).\n- **Người thực hiện**: Quản trị viên hệ thống hoặc người dùng được phân quyền.\n- **Điều kiện tiên quyết**: Xã phường tồn tại trong hệ thống. Người dùng có quyền xóa.\n- **Xử lý ngoại lệ**:\n    - Nếu xã phường không tồn tại: Thông báo lỗi.\n    - Nếu xã phường đang được sử dụng (ví dụ: có địa chỉ liên kết): Thông báo lỗi không thể xóa.\n\n#### 2.3.4. Xem Danh Sách Xã Phường\n- **Mô tả**: Người dùng xem danh sách các xã phường, có thể lọc theo quận huyện, và phân trang.\n- **Đầu vào**: Entity slug, tùy chọn: UUID quận huyện, trang, kích thước trang, các tiêu chí lọc (tên, mã).\n- **Đầu ra**: Danh sách các xã phường thỏa mãn điều kiện.\n- **Người thực hiện**: Bất kỳ người dùng nào có quyền truy cập chức năng.\n- **Điều kiện tiên quyết**: Người dùng đã đăng nhập.\n\n#### 2.3.5. Xem Chi Tiết Xã Phường\n- **Mô tả**: Người dùng xem thông tin chi tiết của một xã phường cụ thể.\n- **Đầu vào**: UUID của xã phường.\n- **Đầu ra**: Thông tin chi tiết của xã phường.\n- **Người thực hiện**: Bất kỳ người dùng nào có quyền truy cập chức năng.\n- **Điều kiện tiên quyết**: Xã phường tồn tại trong hệ thống.\n- **Xử lý ngoại lệ**: Nếu xã phường không tồn tại: Thông báo lỗi.\n\n### 2.4. Sơ Đồ Tuần Tự (Sequence Diagram) - Thêm Mới Xã Phường\n\n```mermaid\nsequenceDiagram\n    participant User as Người dùng\n    participant System as Hệ thống (API)\n    participant Service as XaPhuongModelService\n    participant Repository as XaPhuongRepository\n    participant QuanHuyenRepo as QuanHuyenRepository\n    participant DB as Cơ sở dữ liệu\n\n    User-\u003e\u003eSystem: POST /api/{entity_slug}/xa-phuong/ (data: ma_xa, ten_xa, quan_huyen_uuid, ...)\n    System-\u003e\u003eService: create_xa_phuong(entity_slug, data)\n    Service-\u003e\u003eService: _get_entity_model(entity_slug)\n    Service--\u003e\u003eService: entity_model\n    Service-\u003e\u003eQuanHuyenRepo: get_quan_huyen_by_uuid(data['quan_huyen_uuid'])\n    QuanHuyenRepo-\u003e\u003eDB: SELECT * FROM QuanHuyenModel WHERE uuid = ...\n    DB--\u003e\u003eQuanHuyenRepo: quan_huyen_model (or null)\n    QuanHuyenRepo--\u003e\u003eService: quan_huyen_model (or null)\n    alt Quận huyện không tồn tại\n        Service--\u003e\u003eSystem: Error: \"District not found\"\n        System--\u003e\u003eUser: Response 400 (Error message)\n    else Quận huyện tồn tại\n        Service-\u003e\u003eService: validate_xa_phuong_data(data)\n        Service--\u003e\u003eService: validated_data\n        Service-\u003e\u003eRepository: get_xa_phuong_by_code(entity_model, quan_huyen_model, validated_data['ma_xa'])\n        Repository-\u003e\u003eDB: SELECT * FROM XaPhuongModel WHERE entity_id = ... AND quan_huyen_id = ... AND ma_xa = ...\n        DB--\u003e\u003eRepository: existing_xa_phuong (or null)\n        Repository--\u003e\u003eService: existing_xa_phuong (or null)\n        alt Mã xã phường đã tồn tại trong quận huyện\n            Service--\u003e\u003eSystem: Error: \"Ward/Commune code already exists in this district\"\n            System--\u003e\u003eUser: Response 400 (Error message)\n        else Mã xã phường chưa tồn tại\n            Service-\u003e\u003eRepository: create_xa_phuong(validated_data_with_entity_and_quan_huyen)\n            Repository-\u003e\u003eDB: INSERT INTO XaPhuongModel (...) VALUES (...)\n            DB--\u003e\u003eRepository: new_xa_phuong_object\n            Repository--\u003e\u003eService: new_xa_phuong_object\n            Service--\u003e\u003eSystem: new_xa_phuong_object\n            System--\u003e\u003eUser: Response 201 (new_xa_phuong_data)\n        end\n    end\n```\n\n### 2.5. Luồng Nghiệp Vụ Thay Thế\n- **Tìm kiếm xã phường**: Người dùng có thể tìm kiếm xã phường theo tên hoặc theo mã.\n- **Lọc xã phường theo quận huyện**: Người dùng có thể xem danh sách xã phường thuộc một quận huyện cụ thể.\n\n## 3. Yêu Cầu Chức Năng\n\n### 3.1. Danh Sách Chức Năng\n\n| STT | Mã chức năng | Tên chức năng | Mô tả | Độ ưu tiên |\n|-----|--------------|---------------|-------|------------|\n| 1   | GEO_004_F01 | Thêm mới xã phường | Cho phép tạo một xã phường mới, thuộc một quận huyện. | Cao |\n| 2   | GEO_004_F02 | Cập nhật xã phường | Cho phép sửa thông tin của một xã phường đã có. | Cao |\n| 3   | GEO_004_F03 | Xóa xã phường | Cho phép xóa một xã phường khỏi hệ thống. | Cao |\n| 4   | GEO_004_F04 | Xem danh sách xã phường | Hiển thị danh sách các xã phường, hỗ trợ phân trang và lọc (theo quận huyện, tên, mã). | Cao |\n| 5   | GEO_004_F05 | Xem chi tiết xã phường | Hiển thị thông tin chi tiết của một xã phường. | Cao |\n| 6   | GEO_004_F06 | Tìm kiếm xã phường theo tên | Cho phép tìm kiếm xã phường dựa trên tên. | Trung bình |\n| 7   | GEO_004_F07 | Tìm kiếm xã phường theo mã | Cho phép tìm kiếm xã phường dựa trên mã. | Trung bình |\n| 8   | GEO_004_F08 | Lấy danh sách xã phường đang hoạt động | Lấy danh sách các xã phường có trạng thái là \"Hoạt động\". | Trung bình |\n| 9   | GEO_004_F09 | Lấy danh sách xã phường theo quận huyện | Lấy danh sách các xã phường thuộc một quận huyện cụ thể. | Cao |\n\n### 3.2. Chi Tiết Chức Năng\n\n#### 3.2.1. GEO_004_F01: Thêm mới xã phường\n- **Mô tả**: Chức năng cho phép người dùng tạo mới một xã phường.\n- **Đầu vào**:\n    - `entity_slug`: Slug của Entity.\n    - `data`: Đối tượng chứa thông tin xã phường:\n        - `ma_xa` (bắt buộc): Mã xã phường (string, max 100).\n        - `ten_xa` (bắt buộc): Tên xã phường (string, max 255).\n        - `ten_xa2` (tùy chọn): Tên xã phường khác (string, max 255).\n        - `quan_huyen_uuid` (bắt buộc): UUID của Quận Huyện.\n        - `status` (tùy chọn): Trạng thái (integer). Mặc định là 1.\n- **Đầu ra**: Đối tượng XaPhuongModel vừa được tạo.\n- **Điều kiện tiên quyết**: `entity_slug` và `quan_huyen_uuid` hợp lệ. `ma_xa` không trùng trong cùng `entity_slug` và `quan_huyen_uuid`.\n- **Luồng xử lý chính**:\n  1. Service lấy `EntityModel` và `QuanHuyenModel`.\n  2. Service validate dữ liệu (`ma_xa`, `ten_xa`, `quan_huyen_uuid`).\n  3. Service kiểm tra `ma_xa` đã tồn tại trong `Entity` và `QuanHuyen` chưa.\n  4. Nếu chưa, Service gọi Repository để tạo mới.\n- **Giao diện liên quan**: Form thêm mới xã phường.\n\n#### 3.2.2. GEO_004_F02: Cập nhật xã phường\n- **Mô tả**: Cập nhật thông tin xã phường.\n- **Đầu vào**:\n    - `entity_slug`: Slug của Entity.\n    - `uuid`: UUID của xã phường.\n    - `data`: Thông tin cập nhật (tương tự thêm mới, các trường tùy chọn).\n- **Đầu ra**: Đối tượng XaPhuongModel đã cập nhật.\n- **Điều kiện tiên quyết**: Xã phường tồn tại. Nếu `ma_xa` hoặc `quan_huyen_uuid` thay đổi, mã mới không được trùng.\n- **Giao diện liên quan**: Form cập nhật xã phường.\n\n#### 3.2.3. GEO_004_F03: Xóa xã phường\n- **Mô tả**: Xóa một xã phường.\n- **Đầu vào**: `entity_slug`, `uuid` của xã phường.\n- **Đầu ra**: HTTP 204 No Content.\n- **Điều kiện tiên quyết**: Xã phường tồn tại và không có ràng buộc (ví dụ: Địa Chỉ).\n- **Giao diện liên quan**: Nút xóa.\n\n#### 3.2.4. GEO_004_F04: Xem danh sách xã phường\n- **Mô tả**: Lấy danh sách xã phường, có phân trang và lọc.\n- **Đầu vào**: `entity_slug`, `page`, `page_size`, `quan_huyen_uuid` (lọc), `ma_xa`, `ten_xa`.\n- **Đầu ra**: Danh sách XaPhuongModel.\n- **Giao diện liên quan**: Trang danh sách xã phường.\n\n#### 3.2.5. GEO_004_F05: Xem chi tiết xã phường\n- **Mô tả**: Lấy chi tiết một xã phường.\n- **Đầu vào**: `entity_slug`, `uuid` của xã phường.\n- **Đầu ra**: Đối tượng XaPhuongModel.\n- **Giao diện liên quan**: Trang chi tiết xã phường.\n\n#### 3.2.9. GEO_004_F09: Lấy danh sách xã phường theo quận huyện\n- **Mô tả**: Lấy danh sách các xã phường thuộc một quận huyện cụ thể.\n- **Đầu vào**: `entity_slug`, `quan_huyen_uuid`.\n- **Đầu ra**: `QuerySet` các `XaPhuongModel`.\n\n## 4. Thiết Kế Kỹ Thuật\n\n### 4.1. Kiến Trúc Hệ Thống\nTương tự GEO_003, sử dụng Views/APIs, Services (`XaPhuongModelService`), Repositories (`XaPhuongRepository`), Models (`XaPhuongModel`, `QuanHuyenModel`, `EntityModel`).\n\n### 4.2. API Endpoints\n\n- **Base URL**: `/api/{entity_slug}/xa-phuong/`\n- **Endpoints**:\n    - `GET /`: Lấy danh sách xã phường. (GEO_004_F04)\n        - Query params: `page`, `page_size`, `quan_huyen_uuid`, `ma_xa`, `ten_xa`, `status`.\n    - `POST /`: Tạo mới xã phường. (GEO_004_F01)\n        - Request body: `{ \"ma_xa\": \"PBN\", \"ten_xa\": \"Phường Bến Nghé\", \"quan_huyen_uuid\": \"uuid_cua_Q1\", \"status\": 1 }`\n    - `GET /{uuid}/`: Lấy chi tiết xã phường. (GEO_004_F05)\n    - `PUT /{uuid}/`: Cập nhật xã phường. (GEO_004_F02)\n    - `PATCH /{uuid}/`: Cập nhật một phần xã phường. (GEO_004_F02)\n    - `DELETE /{uuid}/`: Xóa xã phường. (GEO_004_F03)\n    - `GET /theo-quan-huyen/{quan_huyen_uuid}/`: Lấy xã phường theo quận huyện. (GEO_004_F09)\n\n### 4.3. Service Logic (`XaPhuongModelService`)\n- Tương tự `QuanHuyenModelService` nhưng cho `XaPhuongModel`.\n- Sẽ có thêm logic kiểm tra sự tồn tại của `QuanHuyenModel` khi tạo/cập nhật xã phường.\n- Validate `ma_xa` phải duy nhất trong phạm vi `Entity` và `QuanHuyen`.\n\n### 4.4. Mô Hình Dữ Liệu\n\n#### 4.4.1. Entity Relationship Diagram (ERD)\n\n```mermaid\nerDiagram\n    ENTITY ||--|{ QUOC_GIA : \"quản lý\"\n    ENTITY ||--|{ TINH_THANH : \"quản lý\"\n    ENTITY ||--|{ QUAN_HUYEN : \"quản lý\"\n    ENTITY ||--|{ XA_PHUONG : \"quản lý\"\n    ENTITY ||--|{ DIA_CHI : \"quản lý\"\n\n    QUOC_GIA ||--o{ TINH_THANH : \"có\"\n    TINH_THANH ||--o{ QUAN_HUYEN : \"có\"\n    QUAN_HUYEN ||--o{ XA_PHUONG : \"có\"\n    XA_PHUONG ||--o{ DIA_CHI : \"thuộc\"\n\n    ENTITY {\n        uuid uuid PK\n        string slug\n        string name\n        \u003cem\u003e(các trường khác)\u003c/em\u003e\n    }\n\n    QUOC_GIA {\n        uuid uuid PK\n        string ma_qg\n        string ten_qg\n        uuid entity_id FK\n        \u003cem\u003e(các trường khác)\u003c/em\u003e\n    }\n\n    TINH_THANH {\n        uuid uuid PK\n        string ma_tinh\n        string ten_tinh\n        uuid quoc_gia_id FK\n        uuid entity_id FK\n        \u003cem\u003e(các trường khác)\u003c/em\u003e\n    }\n\n    QUAN_HUYEN {\n        uuid uuid PK\n        string ma_huyen\n        string ten_huyen\n        uuid tinh_thanh_id FK\n        uuid entity_id FK\n        \u003cem\u003e(các trường khác)\u003c/em\u003e\n    }\n\n    XA_PHUONG {\n        uuid uuid PK\n        string ma_xa \"Mã xã phường (duy nhất trong Quận Huyện \u0026 Entity)\"\n        string ten_xa \"Tên xã phường\"\n        string ten_xa2 \"Tên xã phường khác\"\n        integer status \"Trạng thái\"\n        datetime created\n        datetime updated\n        uuid entity_id FK \"Khóa ngoại tới ENTITY\"\n        uuid quan_huyen_id FK \"Khóa ngoại tới QUAN_HUYEN\"\n    }\n\n    DIA_CHI {\n        uuid uuid PK\n        string dia_chi_day_du\n        uuid xa_phuong_id FK\n        uuid entity_id FK\n        \u003cem\u003e(các trường khác)\u003c/em\u003e\n    }\n```\n\n#### 4.4.2. Chi Tiết Bảng Dữ Liệu\n\n##### Bảng: `XaPhuongModel` (django_ledger_xaphuongmodel)\n- **Mô tả**: Lưu trữ thông tin các xã phường.\n- **Các cột chính**:\n    - `uuid` (UUID, Khóa chính).\n    - `ma_xa` (CharField, max_length=100).\n    - `ten_xa` (CharField, max_length=255).\n    - `ten_xa2` (CharField, max_length=255, null=True, blank=True).\n    - `status` (IntegerField, default=1).\n    - `entity_model` (ForeignKey đến `EntityModel`).\n    - `quan_huyen` (ForeignKey đến `QuanHuyenModel`).\n    - `created` (DateTimeField, auto_now_add=True).\n    - `updated` (DateTimeField, auto_now=True).\n- **Indexes**:\n    - `unique_together = ('entity_model', 'quan_huyen', 'ma_xa')`.\n\n## 5. Kế Hoạch Kiểm Thử\n\n### 5.1. Phạm Vi Kiểm Thử\n- CRUD cho Xã Phường.\n- Lọc theo Quận Huyện.\n- Validation dữ liệu (bao gồm `quan_huyen_uuid`).\n- Ràng buộc duy nhất của `ma_xa` theo `entity_model` và `quan_huyen`.\n\n### 5.2. Kịch Bản Kiểm Thử (Ví dụ)\n\n| STT | Mã kịch bản | Tên kịch bản | Mô tả | Điều kiện tiên quyết | Các bước | Kết quả mong đợi |\n|-----|------------|--------------|-------|---------------------|----------|-----------------|\n| 1   | GEO_004_TC01 | Thêm mới xã phường thành công | Kiểm tra thêm xã phường với dữ liệu hợp lệ. | User đăng nhập, có quyền. Entity \"E1\", Quận Huyện \"Q1\" (uuid_q1) thuộc Tỉnh \"HCM\" tồn tại. | 1. POST `/api/E1/xa-phuong/`. 2. Payload: `{\"ma_xa\": \"PBN\", \"ten_xa\": \"Phường Bến Nghé\", \"quan_huyen_uuid\": \"uuid_q1\"}`. | 1. HTTP 201. 2. Dữ liệu xã phường được trả về. 3. Xã phường được lưu vào CSDL. |\n| 2   | GEO_004_TC02 | Thêm mới xã phường với mã trùng | Kiểm tra thêm xã phường có `ma_xa` đã tồn tại trong cùng Quận Huyện \u0026 Entity. | Như TC01. Xã phường \"PBN\" thuộc \"Q1\" đã tồn tại. | 1. POST `/api/E1/xa-phuong/`. 2. Payload: `{\"ma_xa\": \"PBN\", \"ten_xa\": \"Phường Bến Nghé Mới\", \"quan_huyen_uuid\": \"uuid_q1\"}`. | 1. HTTP 400. 2. Lỗi \"Ward/Commune code already exists in this district\". |\n| 3   | GEO_004_TC03 | Thêm mới xã phường với quận huyện không tồn tại | Kiểm tra thêm xã phường với `quan_huyen_uuid` không tồn tại. | Như TC01. `invalid_uuid_qh` không tồn tại. | 1. POST `/api/E1/xa-phuong/`. 2. Payload: `{\"ma_xa\": \"PDK\", \"ten_xa\": \"Phường Đa Kao\", \"quan_huyen_uuid\": \"invalid_uuid_qh\"}`. | 1. HTTP 400. 2. Lỗi \"District not found\". |\n| 4   | GEO_004_TC04 | Xem danh sách xã phường theo quận huyện | Lấy danh sách xã phường của quận huyện \"Q1\". | Như TC01. Có xã \"PBN\" và \"PDK\" thuộc \"Q1\". | 1. GET `/api/E1/xa-phuong/?quan_huyen_uuid=uuid_q1`. | 1. HTTP 200. 2. Danh sách chứa \"PBN\" và \"PDK\". |\n\n## 6. Phụ Lục\n\n### 6.1. Danh Sách Tài Liệu Tham Khảo\n- Mã nguồn Django Ledger: `django_ledger/services/xa_phuong/xa_phuong.py` (dự kiến)\n- Mã nguồn Django Ledger: `django_ledger/repositories/xa_phuong/xa_phuong.py` (dự kiến)\n- Mã nguồn Django Ledger: `django_ledger/models/xa_phuong.py` (dự kiến)\n\n### 6.2. Danh Mục Thuật Ngữ\n(Đã định nghĩa ở mục 1.3)\n\n### 6.3. Lịch Sử Thay Đổi Tài Liệu\n\n| Phiên bản | Ngày | Người thực hiện | Mô tả thay đổi |\n|-----------|------|-----------------|---------------|\n| 1.0 | 13/05/2025 | Cline | Tạo mới tài liệu. |\n"])</script><script>self.__next_f.push([1,"9:[\"slug\",\"erp/GEO_004_Quan_Ly_Xa_Phuong\",\"c\"]\nf:[]\n"])</script><script>self.__next_f.push([1,"0:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/erp-docs/_next/static/css/4b73dfd0f7bdc629.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"$L3\",null,{\"buildId\":\"X5KF-BjlTdL2YCafX7ACW\",\"assetPrefix\":\"/erp-docs\",\"initialCanonicalUrl\":\"/erp/GEO_004_Quan_Ly_Xa_Phuong/\",\"initialTree\":[\"\",{\"children\":[[\"slug\",\"erp/GEO_004_Quan_Ly_Xa_Phuong\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"erp\\\",\\\"GEO_004_Quan_Ly_Xa_Phuong\\\"]}\",{}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[[\"slug\",\"erp/GEO_004_Quan_Ly_Xa_Phuong\",\"c\"],{\"children\":[\"__PAGE__\",{},[[\"$L4\",[\"$\",\"$L5\",null,{\"children\":[\"$\",\"article\",null,{\"className\":\"prose prose-slate dark:prose-invert max-w-none\",\"children\":[[\"$\",\"header\",null,{\"className\":\"mb-8\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"mb-2\",\"children\":\"$undefined\"}],\"$undefined\",\"$undefined\"]}],[\"$\",\"$L6\",null,{\"content\":\"$7\"}]]}]}]],null],null]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$9\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}],null]},[[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[\"$\",\"body\",null,{\"className\":\"__className_985585\",\"children\":[\"$\",\"$Lb\",null,{\"attribute\":\"class\",\"defaultTheme\":\"system\",\"enableSystem\":true,\"disableTransitionOnChange\":true,\"children\":[\"$\",\"$Lc\",null,{\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"styles\":null}]}]}]}]}],null],null],\"couldBeIntercepted\":false,\"initialHead\":[false,\"$Ld\"],\"globalErrorComponent\":\"$e\",\"missingSlots\":\"$Wf\"}]]\n"])</script><script>self.__next_f.push([1,"d:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"undefined | ERP Documentation\"}],[\"$\",\"meta\",\"3\",{\"name\":\"keywords\",\"content\":\"documentation,ERP,technical,mermaid,markdown\"}],[\"$\",\"meta\",\"4\",{\"name\":\"next-size-adjust\"}]]\n4:null\n"])</script></body></html>