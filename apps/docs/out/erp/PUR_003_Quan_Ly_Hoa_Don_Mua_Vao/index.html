<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/erp-docs/_next/static/media/e4af272ccee01ff0-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/erp-docs/_next/static/css/4b73dfd0f7bdc629.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/erp-docs/_next/static/chunks/webpack-39532e8569213db6.js"/><script src="/erp-docs/_next/static/chunks/7384d974-8b753aa07a0575a2.js" async=""></script><script src="/erp-docs/_next/static/chunks/381-1b6d0728bba7b8e7.js" async=""></script><script src="/erp-docs/_next/static/chunks/main-app-5d87a2fd0f4f2f33.js" async=""></script><script src="/erp-docs/_next/static/chunks/d550ec10-485e3f71f5def856.js" async=""></script><script src="/erp-docs/_next/static/chunks/993-1b6a71072be86da4.js" async=""></script><script src="/erp-docs/_next/static/chunks/410-1ece2fcedd156d2f.js" async=""></script><script src="/erp-docs/_next/static/chunks/app/%5B...slug%5D/page-7978846c0e32abf5.js" async=""></script><script src="/erp-docs/_next/static/chunks/app/layout-b6ef60bec0ff2cf2.js" async=""></script><title>undefined | ERP Documentation</title><meta name="keywords" content="documentation,ERP,technical,mermaid,markdown"/><meta name="next-size-adjust"/><script src="/erp-docs/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="__className_985585"><div class="min-h-screen flex items-center justify-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div><script src="/erp-docs/_next/static/chunks/webpack-39532e8569213db6.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/erp-docs/_next/static/media/e4af272ccee01ff0-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/erp-docs/_next/static/css/4b73dfd0f7bdc629.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"3:I[5214,[],\"\"]\n5:I[3040,[\"135\",\"static/chunks/d550ec10-485e3f71f5def856.js\",\"993\",\"static/chunks/993-1b6a71072be86da4.js\",\"410\",\"static/chunks/410-1ece2fcedd156d2f.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-7978846c0e32abf5.js\"],\"DocLayout\"]\n6:I[1276,[\"135\",\"static/chunks/d550ec10-485e3f71f5def856.js\",\"993\",\"static/chunks/993-1b6a71072be86da4.js\",\"410\",\"static/chunks/410-1ece2fcedd156d2f.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-7978846c0e32abf5.js\"],\"MDXContent\"]\n8:I[6472,[],\"\"]\na:I[9190,[],\"\"]\nb:I[4550,[\"185\",\"static/chunks/app/layout-b6ef60bec0ff2cf2.js\"],\"ThemeProvider\"]\nc:I[8910,[\"185\",\"static/chunks/app/layout-b6ef60bec0ff2cf2.js\"],\"AuthProvider\"]\ne:I[3013,[],\"\"]\n7:T4f47,"])</script><script>self.__next_f.push([1,"# PUR_003_Quản Lý Hóa Đơn Mua Vào\n\n*Phiên bản: 1.1*  \n*Người tạo: Auto Generated*  \n*Ngày tạo: 25/07/2023*  \n*Cập nhật lần cuối: 09/07/2024*  \n*Người cập nhật: AI Assistant*\n\n## 1. Tổng Quan Nghiệp Vụ\n\n### 1.1. Mô Tả Nghiệp Vụ\nQuản lý hóa đơn mua vào (bill management) là quy trình xử lý, kiểm soát và theo dõi các hóa đơn, chứng từ từ nhà cung cấp liên quan đến việc mua hàng hóa và dịch vụ. Hệ thống theo dõi toàn bộ chu trình của hóa đơn từ trạng thái nháp (draft), đến đang xem xét (in review), đã phê duyệt (approved), đã thanh toán (paid), hủy bỏ (canceled) và vô hiệu hóa (void). Quy trình này đảm bảo tất cả các khoản phải trả được ghi nhận chính xác, được phê duyệt đúng quy định và được thanh toán đúng hạn. Ngoài ra, quy trình này cũng là cơ sở để ghi nhận chi phí, hàng hóa vào hệ thống kế toán, đối chiếu với đơn mua hàng, và làm cơ sở cho việc khấu trừ thuế giá trị gia tăng đầu vào.\n\n### 1.2. Phạm Vi Áp Dụng\nQuy trình này áp dụng cho tất cả các hóa đơn mua vào trong doanh nghiệp, bao gồm:\n- Bộ phận kế toán\n- Bộ phận mua hàng\n- Bộ phận kho\n- Ban lãnh đạo phê duyệt thanh toán\n- Các bộ phận liên quan đến việc nhận hàng hóa, dịch vụ từ nhà cung cấp\n\n### 1.3. Định Nghĩa Thuật Ngữ\n| Thuật ngữ | Định nghĩa |\n|-----------|------------|\n| Hóa đơn mua vào (BillModel) | Chứng từ do nhà cung cấp phát hành để yêu cầu thanh toán cho hàng hóa/dịch vụ đã cung cấp |\n| Đơn mua hàng (PO) | Tài liệu chính thức gửi cho nhà cung cấp để yêu cầu cung cấp hàng hóa/dịch vụ |\n| Phiếu nhập kho | Chứng từ ghi nhận việc nhập hàng hóa vào kho |\n| Tài khoản phải trả | Tài khoản kế toán ghi nhận các khoản nợ phải trả cho nhà cung cấp |\n| HĐGTGT | Hóa đơn giá trị gia tăng |\n| Sổ cái (Ledger) | Hệ thống ghi chép kế toán chính của doanh nghiệp |\n| BILL_STATUS_DRAFT | Trạng thái nháp của hóa đơn, chưa tác động đến sổ cái |\n| BILL_STATUS_REVIEW | Trạng thái đang xem xét của hóa đơn |\n| BILL_STATUS_APPROVED | Trạng thái đã phê duyệt của hóa đơn, đã ghi nhận vào sổ cái |\n| BILL_STATUS_PAID | Trạng thái đã thanh toán của hóa đơn |\n| BILL_STATUS_VOID | Trạng thái đã vô hiệu hóa của hóa đơn |\n| BILL_STATUS_CANCELED | Trạng thái đã hủy của hóa đơn |\n\n### 1.4. Tài Liệu Liên Quan\n\n| STT | Mã tài liệu | Tên tài liệu | Mô tả |\n|-----|-------------|--------------|-------|\n| 1   | PUR_001 | Quản Lý Nhà Cung Cấp | Quy trình quản lý thông tin nhà cung cấp |\n| 2   | PUR_002 | Quản Lý Đơn Mua Hàng | Quy trình tạo và quản lý đơn mua hàng |\n| 3   | INV_005 | Quản Lý Nhập Xuất Kho | Quy trình nhập xuất kho |\n| 4   | ACC_003 | Bút Toán Kế Toán | Quy trình tạo và quản lý các bút toán |\n| 5   | ACC_006 | Quản Lý Thuế | Quy trình quản lý thuế GTGT và các loại thuế khác |\n\n## 2. Quy Trình Nghiệp Vụ\n\n### 2.1. Tổng Quan Quy Trình\nQuy trình quản lý hóa đơn mua vào bao gồm các bước chính: nhận hóa đơn từ nhà cung cấp, kiểm tra đối chiếu với đơn mua hàng và phiếu nhập kho, nhập liệu vào hệ thống, phê duyệt, ghi nhận bút toán kế toán và thanh toán. Quy trình này đảm bảo tính chính xác và minh bạch trong quản lý các khoản phải trả cho nhà cung cấp.\n\n### 2.2. Sơ Đồ Quy Trình (Business Flow)\n\n```mermaid\nflowchart TD\n    A[Bắt đầu] --\u003e B[Nhận hóa đơn từ nhà cung cấp]\n    B --\u003e C[Kiểm tra hóa đơn]\n    C --\u003e D{Có đơn mua hàng?}\n    D --\u003e|Có| E[Đối chiếu với đơn mua hàng]\n    D --\u003e|Không| F[Xác nhận với bộ phận liên quan]\n    E --\u003e G{Đối chiếu OK?}\n    G --\u003e|Không| H[Yêu cầu điều chỉnh]\n    H --\u003e C\n    G --\u003e|Có| I[Nhập liệu vào hệ thống]\n    F --\u003e I\n    I --\u003e J[Phân bổ chi phí và thuế]\n    J --\u003e K[Tạo bút toán kế toán]\n    K --\u003e L[Gửi phê duyệt]\n    L --\u003e M{Được duyệt?}\n    M --\u003e|Không| N[Yêu cầu bổ sung]\n    N --\u003e I\n    M --\u003e|Có| O[Cập nhật vào sổ cái]\n    O --\u003e P[Lập kế hoạch thanh toán]\n    P --\u003e Q[Thanh toán]\n    Q --\u003e R[Cập nhật trạng thái đã thanh toán]\n    R --\u003e S[Lưu trữ chứng từ]\n    S --\u003e T[Kết thúc]\n```\n\n### 2.3. Chi Tiết Các Bước Quy Trình\n\n#### 2.3.1. Nhận hóa đơn từ nhà cung cấp\n- **Mô tả**: Nhận hóa đơn từ nhà cung cấp qua email, bưu điện hoặc trực tiếp\n- **Đầu vào**: Hóa đơn từ nhà cung cấp (bản cứng hoặc điện tử)\n- **Đầu ra**: Hóa đơn đã tiếp nhận\n- **Người thực hiện**: Nhân viên kế toán hoặc người được phân công\n- **Điều kiện tiên quyết**: Nhà cung cấp đã gửi hóa đơn\n- **Xử lý ngoại lệ**: Nếu hóa đơn không rõ ràng, liên hệ với nhà cung cấp để làm rõ\n\n#### 2.3.2. Kiểm tra hóa đơn và đối chiếu\n- **Mô tả**: Kiểm tra tính hợp lệ của hóa đơn và đối chiếu với đơn mua hàng, phiếu nhập kho\n- **Đầu vào**: Hóa đơn, đơn mua hàng, phiếu nhập kho\n- **Đầu ra**: Kết quả kiểm tra và đối chiếu\n- **Người thực hiện**: Nhân viên kế toán\n- **Điều kiện tiên quyết**: Đã có hóa đơn và đơn mua hàng liên quan\n- **Xử lý ngoại lệ**: Nếu có sai lệch, làm việc với nhà cung cấp để xác nhận và điều chỉnh\n\n#### 2.3.3. Nhập liệu và phân bổ\n- **Mô tả**: Nhập thông tin hóa đơn vào hệ thống và phân bổ chi phí, thuế\n- **Đầu vào**: Hóa đơn đã kiểm tra\n- **Đầu ra**: Bản ghi hóa đơn trong hệ thống\n- **Người thực hiện**: Nhân viên kế toán\n- **Điều kiện tiên quyết**: Hóa đơn đã được kiểm tra và xác nhận là hợp lệ\n- **Xử lý ngoại lệ**: Nếu có sai sót trong quá trình nhập liệu, cần sửa lại trước khi tiếp tục\n\n#### 2.3.4. Tạo bút toán kế toán\n- **Mô tả**: Tạo các bút toán kế toán liên quan đến hóa đơn\n- **Đầu vào**: Thông tin hóa đơn đã nhập\n- **Đầu ra**: Bút toán kế toán\n- **Người thực hiện**: Nhân viên kế toán\n- **Điều kiện tiên quyết**: Hóa đơn đã được nhập vào hệ thống\n- **Xử lý ngoại lệ**: Nếu có lỗi trong bút toán, kiểm tra lại thông tin hóa đơn và điều chỉnh\n\n#### 2.3.5. Phê duyệt và cập nhật sổ cái\n- **Mô tả**: Gửi hóa đơn để phê duyệt và cập nhật vào sổ cái sau khi được duyệt\n- **Đầu vào**: Hóa đơn và bút toán\n- **Đầu ra**: Hóa đơn được phê duyệt và cập nhật vào sổ cái\n- **Người thực hiện**: Kế toán trưởng/người được ủy quyền\n- **Điều kiện tiên quyết**: Hóa đơn và bút toán đã được tạo đầy đủ\n- **Xử lý ngoại lệ**: Nếu hóa đơn không được phê duyệt, cần xem xét lại và bổ sung thông tin\n\n#### 2.3.6. Thanh toán và lưu trữ\n- **Mô tả**: Lập kế hoạch thanh toán, thực hiện thanh toán và lưu trữ chứng từ\n- **Đầu vào**: Hóa đơn đã được phê duyệt\n- **Đầu ra**: Chứng từ thanh toán và trạng thái đã thanh toán\n- **Người thực hiện**: Nhân viên kế toán, thủ quỹ\n- **Điều kiện tiên quyết**: Hóa đơn đã được phê duyệt và đến hạn thanh toán\n- **Xử lý ngoại lệ**: Xử lý các trường hợp thanh toán không thành công, thanh toán một phần\n\n### 2.4. Sơ Đồ Tuần Tự (Sequence Diagram)\n\n```mermaid\nsequenceDiagram\n    participant Vendor as Nhà cung cấp\n    participant Accountant as Kế toán\n    participant System as Hệ thống\n    participant Approver as Người phê duyệt\n    participant Ledger as Sổ cái\n    participant Treasury as Thủ quỹ\n    \n    Vendor-\u003e\u003eAccountant: Gửi hóa đơn\n    Accountant-\u003e\u003eSystem: Nhập thông tin hóa đơn\n    System-\u003e\u003eSystem: Kiểm tra đối chiếu với PO\n    \n    alt Cần đối chiếu với PO\n        System-\u003e\u003eSystem: Đối chiếu với đơn mua hàng\n        \n        alt Không khớp\n            System--\u003e\u003eAccountant: Thông báo sai lệch\n            Accountant-\u003e\u003eVendor: Yêu cầu điều chỉnh\n            Vendor-\u003e\u003eAccountant: Gửi hóa đơn điều chỉnh\n            Accountant-\u003e\u003eSystem: Nhập lại thông tin\n        end\n    end\n    \n    System-\u003e\u003eSystem: Tạo bút toán kế toán\n    System-\u003e\u003eApprover: Gửi yêu cầu phê duyệt\n    \n    alt Từ chối\n        Approver--\u003e\u003eSystem: Từ chối với lý do\n        System--\u003e\u003eAccountant: Thông báo từ chối\n        Accountant-\u003e\u003eSystem: Điều chỉnh và gửi lại\n        System-\u003e\u003eApprover: Gửi yêu cầu phê duyệt lại\n    end\n    \n    Approver-\u003e\u003eSystem: Phê duyệt\n    System-\u003e\u003eLedger: Cập nhật sổ cái\n    System-\u003e\u003eTreasury: Lập kế hoạch thanh toán\n    \n    alt Thanh toán ngay\n        Treasury-\u003e\u003eSystem: Xác nhận thanh toán\n    else Thanh toán theo kế hoạch\n        Treasury-\u003e\u003eSystem: Đánh dấu chờ thanh toán\n        Note over Treasury,System: Theo dõi hạn thanh toán\n        Treasury-\u003e\u003eSystem: Xác nhận thanh toán khi đến hạn\n    end\n    \n    System-\u003e\u003eSystem: Cập nhật trạng thái thanh toán\n    System--\u003e\u003eAccountant: Thông báo đã thanh toán\n    Accountant-\u003e\u003eSystem: Lưu trữ chứng từ\n```\n\n### 2.5. Luồng Nghiệp Vụ Thay Thế\n- **Hóa đơn không có đơn mua hàng**: Trong trường hợp nhận hóa đơn cho các khoản chi phí không có đơn mua hàng trước đó (ví dụ: chi phí tiện ích, dịch vụ định kỳ), cần có quy trình xác nhận nội bộ từ bộ phận sử dụng dịch vụ\n- **Thanh toán trước**: Với một số nhà cung cấp yêu cầu thanh toán trước, cần có quy trình phê duyệt đặc biệt và theo dõi việc nhận hàng/dịch vụ sau khi thanh toán\n- **Hóa đơn điện tử**: Đối với hóa đơn điện tử, cần có quy trình xác thực, lưu trữ và quản lý phù hợp theo quy định của pháp luật\n\n## 3. Yêu Cầu Chức Năng\n\n### 3.1. Danh Sách Chức Năng\n\n| STT | Mã chức năng | Tên chức năng | Mô tả | Độ ưu tiên |\n|-----|--------------|---------------|-------|------------|\n| 1   | BILL_LIST | Xem danh sách hóa đơn | Hiển thị danh sách hóa đơn mua vào với các bộ lọc và tìm kiếm | Cao |\n| 2   | BILL_CREATE | Tạo hóa đơn mới | Nhập thông tin hóa đơn mới vào hệ thống | Cao |\n| 3   | BILL_UPDATE | Cập nhật hóa đơn | Chỉnh sửa thông tin hóa đơn | Cao |\n| 4   | BILL_VIEW | Xem chi tiết hóa đơn | Xem toàn bộ thông tin chi tiết của hóa đơn | Cao |\n| 5   | BILL_APPROVE | Phê duyệt hóa đơn | Phê duyệt hoặc từ chối hóa đơn | Cao |\n| 6   | BILL_STATUS | Cập nhật trạng thái | Cập nhật trạng thái của hóa đơn | Cao |\n| 7   | BILL_PAYMENT | Quản lý thanh toán | Lập kế hoạch và thực hiện thanh toán hóa đơn | Cao |\n| 8   | BILL_MATCH | Đối chiếu hóa đơn | Đối chiếu hóa đơn với đơn mua hàng và phiếu nhập kho | Cao |\n| 9   | BILL_REPORT | Báo cáo hóa đơn | Tạo báo cáo về tình hình hóa đơn mua vào | Trung bình |\n| 10  | BILL_EXPORT | Xuất dữ liệu | Xuất danh sách hóa đơn ra file Excel/PDF | Thấp |\n\n### 3.2. Chi Tiết Chức Năng\n\n#### 3.2.1. BILL_CREATE: Tạo hóa đơn mới\n- **Mô tả**: Cho phép người dùng nhập thông tin hóa đơn mới vào hệ thống\n- **Đầu vào**: Thông tin hóa đơn từ nhà cung cấp, bao gồm: nhà cung cấp, số hóa đơn, ngày hóa đơn, các mặt hàng/dịch vụ, số tiền, thuế, điều khoản thanh toán\n- **Đầu ra**: Bản ghi hóa đơn mới trong hệ thống\n- **Điều kiện tiên quyết**: Người dùng đã đăng nhập và có quyền tạo hóa đơn\n- **Luồng xử lý chính**:\n  1. Người dùng chọn \"Tạo hóa đơn mới\"\n  2. Hệ thống hiển thị form nhập thông tin\n  3. Người dùng chọn nhà cung cấp\n  4. Hệ thống hiển thị các đơn mua hàng chưa đối chiếu với nhà cung cấp đó (nếu có)\n  5. Người dùng có thể chọn đơn mua hàng để đối chiếu hoặc nhập hóa đơn độc lập\n  6. Người dùng nhập thông tin hóa đơn: số hóa đơn, ngày, các mặt hàng, số tiền...\n  7. Hệ thống tính toán tổng tiền, thuế\n  8. Người dùng nhấn \"Lưu\" hoặc \"Gửi phê duyệt\"\n  9. Hệ thống kiểm tra tính hợp lệ của dữ liệu\n  10. Hệ thống lưu hóa đơn và hiển thị thông báo thành công\n- **Luồng xử lý thay thế/ngoại lệ**:\n  1. Nếu dữ liệu không hợp lệ, hiển thị thông báo lỗi\n  2. Nếu số hóa đơn đã tồn tại cho cùng nhà cung cấp, cảnh báo trùng lặp\n- **Giao diện liên quan**: Form tạo hóa đơn\n\n#### 3.2.2. BILL_MATCH: Đối chiếu hóa đơn\n- **Mô tả**: Cho phép đối chiếu hóa đơn với đơn mua hàng và phiếu nhập kho\n- **Đầu vào**: ID hóa đơn, ID đơn mua hàng, ID phiếu nhập kho\n- **Đầu ra**: Kết quả đối chiếu và bản ghi hóa đơn đã cập nhật trạng thái\n- **Điều kiện tiên quyết**: Hóa đơn, đơn mua hàng và phiếu nhập kho đã tồn tại trong hệ thống\n- **Luồng xử lý chính**:\n  1. Người dùng chọn hóa đơn cần đối chiếu\n  2. Hệ thống hiển thị thông tin hóa đơn và các đơn mua hàng/phiếu nhập kho liên quan\n  3. Người dùng kiểm tra và xác nhận việc đối chiếu\n  4. Hệ thống cập nhật trạng thái hóa đơn và đơn mua hàng\n  5. Hệ thống hiển thị kết quả đối chiếu\n- **Luồng xử lý thay thế/ngoại lệ**:\n  1. Nếu có sai lệch, người dùng ghi chú lý do và có thể chọn chấp nhận sai lệch hoặc yêu cầu điều chỉnh\n- **Giao diện liên quan**: Màn hình đối chiếu hóa đơn\n\n## 4. Thiết Kế Kỹ Thuật\n\n### 4.1. Kiến Trúc Hệ Thống\n\n```mermaid\nflowchart TD\n    A[Client] --\u003e B[API Gateway]\n    B --\u003e C[BillService]\n    C --\u003e D[BillRepository]\n    C --\u003e E[PurchaseOrderService]\n    E --\u003e F[PurchaseOrderRepository]\n    C --\u003e G[LedgerService]\n    G --\u003e H[LedgerRepository]\n    C --\u003e I[VendorService]\n    I --\u003e J[VendorRepository]\n    D --\u003e K[(Database)]\n    F --\u003e K\n    H --\u003e K\n    J --\u003e K\n```\n\n### 4.2. API Endpoints\n\n#### 4.2.1. Lấy danh sách hóa đơn\n- **Mô tả**: Trả về danh sách hóa đơn mua vào theo điều kiện lọc\n- **URL**: `GET /api/v1/entity/{entity_slug}/bills/`\n- **Query Parameters**:\n  - `status`: Lọc theo trạng thái\n  - `vendor`: Lọc theo nhà cung cấp\n  - `date_range`: Lọc theo khoảng thời gian\n  - `search`: Từ khóa tìm kiếm\n  - `paid`: Lọc theo trạng thái thanh toán (true/false)\n  - `page`: Số trang\n  - `page_size`: Số bản ghi trên mỗi trang\n  - `ordering`: Trường sắp xếp\n- **Response**: Danh sách hóa đơn, phân trang\n\n#### 4.2.2. Lấy chi tiết hóa đơn\n- **Mô tả**: Trả về thông tin chi tiết của một hóa đơn\n- **URL**: `GET /api/v1/entity/{entity_slug}/bills/{uuid}/`\n- **Response**: Chi tiết hóa đơn và các dòng chi tiết\n\n#### 4.2.3. Tạo hóa đơn mới\n- **Mô tả**: Tạo hóa đơn mới trong hệ thống\n- **URL**: `POST /api/v1/entity/{entity_slug}/bills/`\n- **Request Body**: Thông tin hóa đơn\n- **Response**: Thông tin hóa đơn đã tạo\n\n#### 4.2.4. Cập nhật hóa đơn\n- **Mô tả**: Cập nhật thông tin hóa đơn\n- **URL**: `PUT /api/v1/entity/{entity_slug}/bills/{uuid}/`\n- **Request Body**: Thông tin cập nhật\n- **Response**: Thông tin hóa đơn đã cập nhật\n\n#### 4.2.5. Cập nhật trạng thái hóa đơn\n- **Mô tả**: Cập nhật trạng thái của hóa đơn\n- **URL**: `PATCH /api/v1/entity/{entity_slug}/bills/{uuid}/status/`\n- **Request Body**: Trạng thái mới, ghi chú\n- **Response**: Thông tin trạng thái đã cập nhật\n\n#### 4.2.6. Đối chiếu hóa đơn với đơn mua hàng\n- **Mô tả**: Đối chiếu hóa đơn với đơn mua hàng\n- **URL**: `POST /api/v1/entity/{entity_slug}/bills/{uuid}/match/`\n- **Request Body**: Thông tin đối chiếu\n- **Response**: Kết quả đối chiếu\n\n### 4.3. Service Logic\n\n#### 4.3.1. BillService\n- **Mô tả**: Xử lý logic nghiệp vụ liên quan đến quản lý hóa đơn mua vào\n- **Chức năng chính**:\n  1. Tạo và quản lý hóa đơn\n  2. Đối chiếu hóa đơn với đơn mua hàng\n  3. Quản lý trạng thái hóa đơn\n  4. Tính toán thuế, tổng tiền\n  5. Tạo bút toán kế toán từ hóa đơn\n- **Các dependencies**:\n  1. BillRepository\n  2. PurchaseOrderService\n  3. LedgerService\n  4. VendorService\n- **Sơ đồ luồng xử lý**:\n\n```mermaid\nflowchart TD\n    A[Nhận request] --\u003e B[Validate dữ liệu]\n    B --\u003e C{Dữ liệu hợp lệ?}\n    C --\u003e|Có| D[Xử lý business logic]\n    C --\u003e|Không| E[Trả về lỗi]\n    D --\u003e F{Loại thao tác?}\n    F --\u003e|Tạo| G[Tạo hóa đơn mới]\n    F --\u003e|Cập nhật| H[Cập nhật hóa đơn]\n    F --\u003e|Đối chiếu| I[Đối chiếu với PO]\n    F --\u003e|Phê duyệt| J[Xử lý phê duyệt]\n    G --\u003e K[Tính toán tổng tiền, thuế]\n    H --\u003e K\n    I --\u003e L[Cập nhật trạng thái]\n    J --\u003e M{Đã duyệt?}\n    M --\u003e|Có| N[Tạo bút toán kế toán]\n    N --\u003e O[Cập nhật sổ cái]\n    L --\u003e P[Ghi log]\n    K --\u003e P\n    M --\u003e|Không| P\n    O --\u003e P\n    P --\u003e Q[Trả về kết quả]\n    E --\u003e P\n```\n\n### 4.4. Mô Hình Dữ Liệu\n\n#### 4.4.1. Entity Relationship Diagram (ERD)\n\n```mermaid\nerDiagram\n    EntityModel ||--o{ BillModel : \"có\"\n    VendorModel ||--o{ BillModel : \"phát hành\"\n    PurchaseOrderModel ||--o{ BillModel : \"liên kết với\"\n    LedgerModel ||--|| BillModel : \"ghi nhận\"\n    \n    BillModel ||--o{ ItemTransactionModel : \"có\"\n    AccountModel }o--|| BillModel : \"cash_account\"\n    AccountModel }o--|| BillModel : \"prepaid_account\"\n    \n    BillModel {\n        UUID uuid PK\n        FK EntityModel entity_model\n        FK VendorModel vendor\n        String terms\n        String xref\n        String bill_number\n        String bill_status\n        FK LedgerModel ledger\n        FK AccountModel cash_account\n        FK AccountModel prepaid_account\n        FK AccountModel unearned_account\n        Date date_draft\n        Date date_in_review\n        Date date_approved\n        Date date_paid\n        Date date_void\n        Date date_canceled\n        Date date_due\n        String markdown_notes\n        Decimal amount_due\n        Decimal amount_paid\n        Decimal amount_receivable\n        Decimal amount_unearned\n        Decimal amount_earned\n    }\n    \n    ItemTransactionModel {\n        UUID uuid PK\n        FK BillModel bill_model\n        FK ItemModel item_model\n        String item_name\n        String item_description\n        Decimal quantity\n        Decimal unit_cost\n        Decimal total_amount\n        String item_status\n        String po_item_status\n        String entity_unit\n        Date date_draft\n    }\n```\n\n#### 4.4.2. Chi Tiết Bảng Dữ Liệu\n\n##### Bảng: BillModel\n- **Mô tả**: Lưu trữ thông tin về hóa đơn mua vào\n- **Các trường chính**:\n  - `uuid`: Khóa chính, định danh duy nhất\n  - `entity_model`: Khóa ngoại tham chiếu đến EntityModel\n  - `vendor`: Khóa ngoại tham chiếu đến nhà cung cấp (VendorModel)\n  - `terms`: Điều khoản thanh toán\n  - `xref`: Tham chiếu ngoài (số hóa đơn của nhà cung cấp)\n  - `bill_number`: Số hóa đơn trong hệ thống\n  - `bill_status"])</script><script>self.__next_f.push([1,"9:[\"slug\",\"erp/PUR_003_Quan_Ly_Hoa_Don_Mua_Vao\",\"c\"]\nf:[]\n"])</script><script>self.__next_f.push([1,"0:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/erp-docs/_next/static/css/4b73dfd0f7bdc629.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"$L3\",null,{\"buildId\":\"X5KF-BjlTdL2YCafX7ACW\",\"assetPrefix\":\"/erp-docs\",\"initialCanonicalUrl\":\"/erp/PUR_003_Quan_Ly_Hoa_Don_Mua_Vao/\",\"initialTree\":[\"\",{\"children\":[[\"slug\",\"erp/PUR_003_Quan_Ly_Hoa_Don_Mua_Vao\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"erp\\\",\\\"PUR_003_Quan_Ly_Hoa_Don_Mua_Vao\\\"]}\",{}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[[\"slug\",\"erp/PUR_003_Quan_Ly_Hoa_Don_Mua_Vao\",\"c\"],{\"children\":[\"__PAGE__\",{},[[\"$L4\",[\"$\",\"$L5\",null,{\"children\":[\"$\",\"article\",null,{\"className\":\"prose prose-slate dark:prose-invert max-w-none\",\"children\":[[\"$\",\"header\",null,{\"className\":\"mb-8\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"mb-2\",\"children\":\"$undefined\"}],\"$undefined\",\"$undefined\"]}],[\"$\",\"$L6\",null,{\"content\":\"$7\"}]]}]}]],null],null]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$9\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}],null]},[[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[\"$\",\"body\",null,{\"className\":\"__className_985585\",\"children\":[\"$\",\"$Lb\",null,{\"attribute\":\"class\",\"defaultTheme\":\"system\",\"enableSystem\":true,\"disableTransitionOnChange\":true,\"children\":[\"$\",\"$Lc\",null,{\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"styles\":null}]}]}]}]}],null],null],\"couldBeIntercepted\":false,\"initialHead\":[false,\"$Ld\"],\"globalErrorComponent\":\"$e\",\"missingSlots\":\"$Wf\"}]]\n"])</script><script>self.__next_f.push([1,"d:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"undefined | ERP Documentation\"}],[\"$\",\"meta\",\"3\",{\"name\":\"keywords\",\"content\":\"documentation,ERP,technical,mermaid,markdown\"}],[\"$\",\"meta\",\"4\",{\"name\":\"next-size-adjust\"}]]\n4:null\n"])</script></body></html>