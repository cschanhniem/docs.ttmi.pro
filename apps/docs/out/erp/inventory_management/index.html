<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/erp-docs/_next/static/media/e4af272ccee01ff0-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/erp-docs/_next/static/css/4b73dfd0f7bdc629.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/erp-docs/_next/static/chunks/webpack-39532e8569213db6.js"/><script src="/erp-docs/_next/static/chunks/7384d974-8b753aa07a0575a2.js" async=""></script><script src="/erp-docs/_next/static/chunks/381-1b6d0728bba7b8e7.js" async=""></script><script src="/erp-docs/_next/static/chunks/main-app-5d87a2fd0f4f2f33.js" async=""></script><script src="/erp-docs/_next/static/chunks/d550ec10-485e3f71f5def856.js" async=""></script><script src="/erp-docs/_next/static/chunks/993-1b6a71072be86da4.js" async=""></script><script src="/erp-docs/_next/static/chunks/410-1ece2fcedd156d2f.js" async=""></script><script src="/erp-docs/_next/static/chunks/app/%5B...slug%5D/page-7978846c0e32abf5.js" async=""></script><script src="/erp-docs/_next/static/chunks/app/layout-b6ef60bec0ff2cf2.js" async=""></script><title>undefined | ERP Documentation</title><meta name="keywords" content="documentation,ERP,technical,mermaid,markdown"/><meta name="next-size-adjust"/><script src="/erp-docs/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="__className_985585"><div class="min-h-screen flex items-center justify-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div><script src="/erp-docs/_next/static/chunks/webpack-39532e8569213db6.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/erp-docs/_next/static/media/e4af272ccee01ff0-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/erp-docs/_next/static/css/4b73dfd0f7bdc629.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"3:I[5214,[],\"\"]\n5:I[3040,[\"135\",\"static/chunks/d550ec10-485e3f71f5def856.js\",\"993\",\"static/chunks/993-1b6a71072be86da4.js\",\"410\",\"static/chunks/410-1ece2fcedd156d2f.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-7978846c0e32abf5.js\"],\"DocLayout\"]\n6:I[1276,[\"135\",\"static/chunks/d550ec10-485e3f71f5def856.js\",\"993\",\"static/chunks/993-1b6a71072be86da4.js\",\"410\",\"static/chunks/410-1ece2fcedd156d2f.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-7978846c0e32abf5.js\"],\"MDXContent\"]\n8:I[6472,[],\"\"]\na:I[9190,[],\"\"]\nb:I[4550,[\"185\",\"static/chunks/app/layout-b6ef60bec0ff2cf2.js\"],\"ThemeProvider\"]\nc:I[8910,[\"185\",\"static/chunks/app/layout-b6ef60bec0ff2cf2.js\"],\"AuthProvider\"]\ne:I[3013,[],\"\"]\n7:T35f6,"])</script><script>self.__next_f.push([1,"# Hướng Dẫn Quản Lý Hàng Tồn Kho và Tính Giá Thành\n\n## 1. Quản Lý Kho Hàng\n\n### 1.1. Nhập Kho\n```python\ndef nhap_kho(entity_model, warehouse, receipt_data):\n    \"\"\"\n    Tạo phiếu nhập kho\n    \"\"\"\n    # Tạo phiếu nhập kho\n    receipt = WarehouseReceiptModel.objects.create(\n        entity=entity_model,\n        warehouse=warehouse,\n        receipt_type=receipt_data['type'],\n        reference=receipt_data['reference'],\n        description=receipt_data['description']\n    )\n    \n    # Thêm chi tiết hàng hóa\n    for item in receipt_data['items']:\n        WarehouseReceiptLineModel.objects.create(\n            receipt=receipt,\n            item=item['item'],\n            quantity=item['quantity'],\n            unit_cost=item['unit_cost'],\n            lot_number=item.get('lot_number'),\n            expiry_date=item.get('expiry_date')\n        )\n        \n        # Cập nhật số lượng tồn kho\n        update_stock_balance(\n            entity_model,\n            warehouse,\n            item['item'],\n            item['quantity'],\n            'in'\n        )\n    \n    # Tạo bút toán kế toán\n    if receipt.receipt_type == 'purchase':\n        create_purchase_entry(receipt)\n    \n    return receipt\n```\n\n### 1.2. Xuất Kho\n```python\ndef xuat_kho(entity_model, warehouse, issue_data):\n    \"\"\"\n    Tạo phiếu xuất kho\n    \"\"\"\n    # Kiểm tra tồn kho\n    for item in issue_data['items']:\n        if not check_stock_available(\n            entity_model,\n            warehouse,\n            item['item'],\n            item['quantity']\n        ):\n            raise ValidationError(f'Không đủ số lượng tồn kho cho {item[\"item\"]}')\n    \n    # Tạo phiếu xuất kho\n    issue = WarehouseIssueModel.objects.create(\n        entity=entity_model,\n        warehouse=warehouse,\n        issue_type=issue_data['type'],\n        reference=issue_data['reference'],\n        description=issue_data['description']\n    )\n    \n    # Thêm chi tiết hàng hóa\n    for item in issue_data['items']:\n        # Áp dụng phương pháp tính giá xuất kho\n        cost = calculate_issue_cost(\n            entity_model,\n            warehouse,\n            item['item'],\n            item['quantity'],\n            issue_data['costing_method']\n        )\n        \n        WarehouseIssueLineModel.objects.create(\n            issue=issue,\n            item=item['item'],\n            quantity=item['quantity'],\n            unit_cost=cost['unit_cost'],\n            total_cost=cost['total_cost']\n        )\n        \n        # Cập nhật số lượng tồn kho\n        update_stock_balance(\n            entity_model,\n            warehouse,\n            item['item'],\n            item['quantity'],\n            'out'\n        )\n    \n    # Tạo bút toán kế toán\n    if issue.issue_type == 'sale':\n        create_sale_entry(issue)\n    elif issue.issue_type == 'production':\n        create_production_entry(issue)\n    \n    return issue\n```\n\n## 2. Phương Pháp Tính Giá\n\n### 2.1. Bình Quân Gia Quyền\n```python\ndef tinh_gia_binh_quan(entity_model, warehouse, item, as_of_date):\n    \"\"\"\n    Tính giá bình quân gia quyền\n    \"\"\"\n    # Lấy số dư đầu kỳ\n    opening = get_opening_balance(entity_model, warehouse, item, as_of_date)\n    \n    # Lấy các giao dịch nhập trong kỳ\n    receipts = WarehouseReceiptLineModel.objects.filter(\n        receipt__entity=entity_model,\n        receipt__warehouse=warehouse,\n        item=item,\n        receipt__date__lte=as_of_date\n    )\n    \n    total_quantity = opening['quantity']\n    total_value = opening['value']\n    \n    # Tính tổng số lượng và giá trị nhập\n    for receipt in receipts:\n        total_quantity += receipt.quantity\n        total_value += receipt.quantity * receipt.unit_cost\n    \n    # Tính giá bình quân\n    if total_quantity \u003e 0:\n        average_cost = total_value / total_quantity\n    else:\n        average_cost = Decimal('0')\n    \n    return {\n        'unit_cost': average_cost,\n        'total_quantity': total_quantity,\n        'total_value': total_value\n    }\n```\n\n### 2.2. Nhập Trước Xuất Trước (FIFO)\n```python\ndef tinh_gia_fifo(entity_model, warehouse, item, quantity):\n    \"\"\"\n    Tính giá xuất kho theo phương pháp FIFO\n    \"\"\"\n    # Lấy các lô hàng còn tồn theo thứ tự nhập kho\n    stock_lots = StockLotModel.objects.filter(\n        entity=entity_model,\n        warehouse=warehouse,\n        item=item,\n        remaining_quantity__gt=0\n    ).order_by('receipt_date')\n    \n    remaining_quantity = quantity\n    total_cost = Decimal('0')\n    lots_used = []\n    \n    for lot in stock_lots:\n        if remaining_quantity \u003c= 0:\n            break\n            \n        quantity_from_lot = min(\n            remaining_quantity,\n            lot.remaining_quantity\n        )\n        \n        total_cost += quantity_from_lot * lot.unit_cost\n        remaining_quantity -= quantity_from_lot\n        \n        lots_used.append({\n            'lot': lot,\n            'quantity': quantity_from_lot,\n            'unit_cost': lot.unit_cost,\n            'total_cost': quantity_from_lot * lot.unit_cost\n        })\n    \n    if remaining_quantity \u003e 0:\n        raise ValidationError('Không đủ số lượng tồn kho')\n        \n    return {\n        'unit_cost': total_cost / quantity,\n        'total_cost': total_cost,\n        'lots': lots_used\n    }\n```\n\n### 2.3. Nhập Sau Xuất Trước (LIFO)\n```python\ndef tinh_gia_lifo(entity_model, warehouse, item, quantity):\n    \"\"\"\n    Tính giá xuất kho theo phương pháp LIFO\n    \"\"\"\n    # Lấy các lô hàng còn tồn theo thứ tự nhập kho (mới nhất trước)\n    stock_lots = StockLotModel.objects.filter(\n        entity=entity_model,\n        warehouse=warehouse,\n        item=item,\n        remaining_quantity__gt=0\n    ).order_by('-receipt_date')\n    \n    remaining_quantity = quantity\n    total_cost = Decimal('0')\n    lots_used = []\n    \n    for lot in stock_lots:\n        if remaining_quantity \u003c= 0:\n            break\n            \n        quantity_from_lot = min(\n            remaining_quantity,\n            lot.remaining_quantity\n        )\n        \n        total_cost += quantity_from_lot * lot.unit_cost\n        remaining_quantity -= quantity_from_lot\n        \n        lots_used.append({\n            'lot': lot,\n            'quantity': quantity_from_lot,\n            'unit_cost': lot.unit_cost,\n            'total_cost': quantity_from_lot * lot.unit_cost\n        })\n    \n    if remaining_quantity \u003e 0:\n        raise ValidationError('Không đủ số lượng tồn kho')\n        \n    return {\n        'unit_cost': total_cost / quantity,\n        'total_cost': total_cost,\n        'lots': lots_used\n    }\n```\n\n## 3. Tính Giá Thành Sản Phẩm\n\n### 3.1. Chi Phí Nguyên Vật Liệu Trực Tiếp\n```python\ndef tinh_chi_phi_nvl(entity_model, product, quantity):\n    \"\"\"\n    Tính chi phí nguyên vật liệu trực tiếp\n    \"\"\"\n    # Lấy định mức nguyên vật liệu\n    bom = BillOfMaterialModel.objects.get(\n        entity=entity_model,\n        product=product\n    )\n    \n    total_cost = Decimal('0')\n    material_costs = []\n    \n    for material in bom.materials.all():\n        quantity_needed = material.quantity_per_unit * quantity\n        \n        # Tính giá xuất kho nguyên vật liệu\n        cost = calculate_issue_cost(\n            entity_model,\n            material.warehouse,\n            material.item,\n            quantity_needed,\n            'average'  # Hoặc 'fifo', 'lifo'\n        )\n        \n        material_costs.append({\n            'material': material.item,\n            'quantity': quantity_needed,\n            'unit_cost': cost['unit_cost'],\n            'total_cost': cost['total_cost']\n        })\n        \n        total_cost += cost['total_cost']\n    \n    return {\n        'details': material_costs,\n        'total_cost': total_cost,\n        'unit_cost': total_cost / quantity\n    }\n```\n\n### 3.2. Chi Phí Nhân Công Trực Tiếp\n```python\ndef tinh_chi_phi_nhan_cong(entity_model, product, quantity, period):\n    \"\"\"\n    Tính chi phí nhân công trực tiếp\n    \"\"\"\n    # Lấy định mức nhân công\n    labor = LaborStandardModel.objects.get(\n        entity=entity_model,\n        product=product\n    )\n    \n    total_hours = labor.hours_per_unit * quantity\n    \n    # Lấy chi phí nhân công thực tế\n    labor_costs = LaborCostModel.objects.filter(\n        entity=entity_model,\n        product=product,\n        date__range=period\n    )\n    \n    actual_cost = sum(cost.amount for cost in labor_costs)\n    \n    return {\n        'standard_hours': total_hours,\n        'actual_cost': actual_cost,\n        'unit_cost': actual_cost / quantity\n    }\n```\n\n### 3.3. Chi Phí Sản Xuất Chung\n```python\ndef tinh_chi_phi_san_xuat_chung(entity_model, product, quantity, period):\n    \"\"\"\n    Tính chi phí sản xuất chung\n    \"\"\"\n    # Lấy các chi phí sản xuất chung\n    overhead_costs = OverheadCostModel.objects.filter(\n        entity=entity_model,\n        date__range=period\n    )\n    \n    # Phân bổ chi phí\n    total_production = get_total_production(entity_model, period)\n    allocation_base = quantity / total_production\n    \n    costs = {\n        'khau_hao': Decimal('0'),\n        'dien_nuoc': Decimal('0'),\n        'van_hanh': Decimal('0'),\n        'khac': Decimal('0')\n    }\n    \n    for cost in overhead_costs:\n        allocated_cost = cost.amount * allocation_base\n        costs[cost.cost_type] += allocated_cost\n    \n    return {\n        'details': costs,\n        'total_cost': sum(costs.values()),\n        'unit_cost': sum(costs.values()) / quantity\n    }\n```\n\n## 4. Báo Cáo Kho Hàng\n\n### 4.1. Thẻ Kho\n```python\ndef in_the_kho(entity_model, warehouse, item, period):\n    \"\"\"\n    In thẻ kho theo vật tư\n    \"\"\"\n    # Lấy số dư đầu kỳ\n    opening = get_opening_balance(\n        entity_model,\n        warehouse,\n        item,\n        period['from_date']\n    )\n    \n    # Lấy các giao dịch trong kỳ\n    transactions = StockTransactionModel.objects.filter(\n        entity=entity_model,\n        warehouse=warehouse,\n        item=item,\n        date__range=[period['from_date'], period['to_date']]\n    ).order_by('date')\n    \n    entries = []\n    balance = {\n        'quantity': opening['quantity'],\n        'value': opening['value']\n    }\n    \n    for tx in transactions:\n        if tx.transaction_type == 'in':\n            balance['quantity'] += tx.quantity\n            balance['value'] += tx.total_cost\n        else:\n            balance['quantity'] -= tx.quantity\n            balance['value'] -= tx.total_cost\n            \n        entries.append({\n            'date': tx.date,\n            'document': tx.document_number,\n            'description': tx.description,\n            'in_quantity': tx.quantity if tx.transaction_type == 'in' else 0,\n            'in_value': tx.total_cost if tx.transaction_type == 'in' else 0,\n            'out_quantity': tx.quantity if tx.transaction_type == 'out' else 0,\n            'out_value': tx.total_cost if tx.transaction_type == 'out' else 0,\n            'balance_quantity': balance['quantity'],\n            'balance_value': balance['value']\n        })\n    \n    return {\n        'opening': opening,\n        'entries': entries,\n        'closing': balance\n    }\n```\n\n### 4.2. Báo Cáo Tồn Kho\n```python\ndef bao_cao_ton_kho(entity_model, warehouse, as_of_date):\n    \"\"\"\n    Báo cáo tồn kho tổng hợp\n    \"\"\"\n    items = ItemModel.objects.filter(entity=entity_model)\n    report = []\n    \n    for item in items:\n        stock = get_stock_balance(\n            entity_model,\n            warehouse,\n            item,\n            as_of_date\n        )\n        \n        if stock['quantity'] \u003e 0:\n            report.append({\n                'item': item,\n                'quantity': stock['quantity'],\n                'unit_cost': stock['value'] / stock['quantity'],\n                'total_value': stock['value']\n            })\n    \n    return report\n```\n\n### 4.3. Phân Tích ABC\n```python\ndef phan_tich_abc(entity_model, warehouse, period):\n    \"\"\"\n    Phân tích ABC hàng tồn kho\n    \"\"\"\n    # Tính giá trị sử dụng trong kỳ\n    items = ItemModel.objects.filter(entity=entity_model)\n    usage_values = []\n    \n    for item in items:\n        # Lấy số lượng xuất kho trong kỳ\n        issues = WarehouseIssueLineModel.objects.filter(\n            issue__entity=entity_model,\n            issue__warehouse=warehouse,\n            item=item,\n            issue__date__range=[period['from_date'], period['to_date']]\n        )\n        \n        total_quantity = sum(issue.quantity for issue in issues)\n        total_value = sum(issue.total_cost for issue in issues)\n        \n        if total_value \u003e 0:\n            usage_values.append({\n                'item': item,\n                'usage_value': total_value\n            })\n    \n    # Sắp xếp theo giá trị giảm dần\n    usage_values.sort(\n        key=lambda x: x['usage_value'],\n        reverse=True\n    )\n    \n    # Tính tổng giá trị\n    total_value = sum(item['usage_value'] for item in usage_values)\n    \n    # Phân loại ABC\n    cumulative = Decimal('0')\n    for item in usage_values:\n        cumulative += item['usage_value']\n        percentage = cumulative / total_value * 100\n        \n        if percentage \u003c= 80:\n            item['category'] = 'A'\n        elif percentage \u003c= 95:\n            item['category'] = 'B'\n        else:\n            item['category'] = 'C'\n    \n    return {\n        'items': usage_values,\n        'summary': {\n            'A': len([i for i in usage_values if i['category'] == 'A']),\n            'B': len([i for i in usage_values if i['category'] == 'B']),\n            'C': len([i for i in usage_values if i['category'] == 'C'])\n        }\n    }\n"])</script><script>self.__next_f.push([1,"9:[\"slug\",\"erp/inventory_management\",\"c\"]\nf:[]\n"])</script><script>self.__next_f.push([1,"0:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/erp-docs/_next/static/css/4b73dfd0f7bdc629.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"$L3\",null,{\"buildId\":\"X5KF-BjlTdL2YCafX7ACW\",\"assetPrefix\":\"/erp-docs\",\"initialCanonicalUrl\":\"/erp/inventory_management/\",\"initialTree\":[\"\",{\"children\":[[\"slug\",\"erp/inventory_management\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"erp\\\",\\\"inventory_management\\\"]}\",{}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[[\"slug\",\"erp/inventory_management\",\"c\"],{\"children\":[\"__PAGE__\",{},[[\"$L4\",[\"$\",\"$L5\",null,{\"children\":[\"$\",\"article\",null,{\"className\":\"prose prose-slate dark:prose-invert max-w-none\",\"children\":[[\"$\",\"header\",null,{\"className\":\"mb-8\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"mb-2\",\"children\":\"$undefined\"}],\"$undefined\",\"$undefined\"]}],[\"$\",\"$L6\",null,{\"content\":\"$7\"}]]}]}]],null],null]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$9\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}],null]},[[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[\"$\",\"body\",null,{\"className\":\"__className_985585\",\"children\":[\"$\",\"$Lb\",null,{\"attribute\":\"class\",\"defaultTheme\":\"system\",\"enableSystem\":true,\"disableTransitionOnChange\":true,\"children\":[\"$\",\"$Lc\",null,{\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"styles\":null}]}]}]}]}],null],null],\"couldBeIntercepted\":false,\"initialHead\":[false,\"$Ld\"],\"globalErrorComponent\":\"$e\",\"missingSlots\":\"$Wf\"}]]\n"])</script><script>self.__next_f.push([1,"d:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"undefined | ERP Documentation\"}],[\"$\",\"meta\",\"3\",{\"name\":\"keywords\",\"content\":\"documentation,ERP,technical,mermaid,markdown\"}],[\"$\",\"meta\",\"4\",{\"name\":\"next-size-adjust\"}]]\n4:null\n"])</script></body></html>