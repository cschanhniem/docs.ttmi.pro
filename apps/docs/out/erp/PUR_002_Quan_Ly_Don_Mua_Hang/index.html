<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/erp-docs/_next/static/media/e4af272ccee01ff0-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/erp-docs/_next/static/css/4b73dfd0f7bdc629.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/erp-docs/_next/static/chunks/webpack-39532e8569213db6.js"/><script src="/erp-docs/_next/static/chunks/7384d974-8b753aa07a0575a2.js" async=""></script><script src="/erp-docs/_next/static/chunks/381-1b6d0728bba7b8e7.js" async=""></script><script src="/erp-docs/_next/static/chunks/main-app-5d87a2fd0f4f2f33.js" async=""></script><script src="/erp-docs/_next/static/chunks/d550ec10-485e3f71f5def856.js" async=""></script><script src="/erp-docs/_next/static/chunks/993-1b6a71072be86da4.js" async=""></script><script src="/erp-docs/_next/static/chunks/410-1ece2fcedd156d2f.js" async=""></script><script src="/erp-docs/_next/static/chunks/app/%5B...slug%5D/page-7978846c0e32abf5.js" async=""></script><script src="/erp-docs/_next/static/chunks/app/layout-b6ef60bec0ff2cf2.js" async=""></script><title>undefined | ERP Documentation</title><meta name="keywords" content="documentation,ERP,technical,mermaid,markdown"/><meta name="next-size-adjust"/><script src="/erp-docs/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="__className_985585"><div class="min-h-screen flex items-center justify-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div><script src="/erp-docs/_next/static/chunks/webpack-39532e8569213db6.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/erp-docs/_next/static/media/e4af272ccee01ff0-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/erp-docs/_next/static/css/4b73dfd0f7bdc629.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"3:I[5214,[],\"\"]\n5:I[3040,[\"135\",\"static/chunks/d550ec10-485e3f71f5def856.js\",\"993\",\"static/chunks/993-1b6a71072be86da4.js\",\"410\",\"static/chunks/410-1ece2fcedd156d2f.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-7978846c0e32abf5.js\"],\"DocLayout\"]\n6:I[1276,[\"135\",\"static/chunks/d550ec10-485e3f71f5def856.js\",\"993\",\"static/chunks/993-1b6a71072be86da4.js\",\"410\",\"static/chunks/410-1ece2fcedd156d2f.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-7978846c0e32abf5.js\"],\"MDXContent\"]\n8:I[6472,[],\"\"]\na:I[9190,[],\"\"]\nb:I[4550,[\"185\",\"static/chunks/app/layout-b6ef60bec0ff2cf2.js\"],\"ThemeProvider\"]\nc:I[8910,[\"185\",\"static/chunks/app/layout-b6ef60bec0ff2cf2.js\"],\"AuthProvider\"]\ne:I[3013,[],\"\"]\n7:T5b7f,"])</script><script>self.__next_f.push([1,"# PUR_002_Quản Lý Đơn Mua Hàng\n\n*Phiên bản: 1.1*  \n*Người tạo: Auto Generated*  \n*Ngày tạo: 25/07/2023*  \n*Cập nhật lần cuối: 09/07/2024*  \n*Người cập nhật: AI Assistant*\n\n## 1. Tổng Quan Nghiệp Vụ\n\n### 1.1. Mô Tả Nghiệp Vụ\nQuản lý đơn mua hàng là quy trình xử lý và theo dõi các đơn đặt hàng với nhà cung cấp từ lúc tạo đơn cho đến khi nhận hàng và thanh toán. Đơn mua hàng (Purchase Order) là tài liệu chính thức được doanh nghiệp gửi đến nhà cung cấp để yêu cầu cung cấp hàng hóa hoặc dịch vụ với số lượng, chất lượng, giá cả, và thời gian giao hàng cụ thể. Hệ thống lưu trữ thông tin chi tiết về nhà cung cấp, ngày chứng từ, ngày hiệu lực, điều khoản thanh toán, thông tin giao hàng, và các chi tiết tài chính như tỷ giá, tổng số lượng, tổng tiền, thuế và tổng thanh toán. Quy trình này giúp doanh nghiệp kiểm soát chi phí mua hàng, đảm bảo tính minh bạch, và tạo cơ sở cho việc đối chiếu hóa đơn sau này.\n\n### 1.2. Phạm Vi Áp Dụng\nQuy trình này áp dụng cho tất cả các hoạt động mua hàng trong doanh nghiệp, bao gồm:\n- Bộ phận mua hàng\n- Bộ phận kế toán\n- Bộ phận kho\n- Các phòng ban có nhu cầu mua sắm hàng hóa/dịch vụ\n- Ban lãnh đạo phê duyệt đơn hàng có giá trị lớn\n\n### 1.3. Định Nghĩa Thuật Ngữ\n| Thuật ngữ | Định nghĩa |\n|-----------|------------|\n| Đơn mua hàng (DonMuaHangModel) | Tài liệu chính thức gửi cho nhà cung cấp để yêu cầu cung cấp hàng hóa/dịch vụ |\n| Nhà cung cấp (ma_ncc) | Tổ chức/cá nhân cung cấp hàng hóa, dịch vụ cho doanh nghiệp |\n| Điều khoản thanh toán (han_thanh_toan) | Các điều kiện về thời gian, phương thức thanh toán |\n| Mã ngoại tệ (ma_nt) | Loại tiền tệ sử dụng trong giao dịch |\n| Tỷ giá (ty_gia) | Tỷ lệ chuyển đổi giữa ngoại tệ và tiền tệ địa phương |\n| Số chứng từ (so_ct) | Mã định danh duy nhất cho mỗi đơn mua hàng |\n| Ngày chứng từ (ngay_ct) | Ngày lập chứng từ đơn mua hàng |\n| Ngày hiệu lực (ngay_hl) | Ngày đơn mua hàng có hiệu lực |\n| Status | Trạng thái của đơn mua hàng, mặc định là \"1\" (hoạt động) |\n\n### 1.4. Tài Liệu Liên Quan\n\n| STT | Mã tài liệu | Tên tài liệu | Mô tả |\n|-----|-------------|--------------|-------|\n| 1   | PUR_001 | Quản Lý Nhà Cung Cấp | Quy trình quản lý thông tin nhà cung cấp |\n| 2   | PUR_003 | Quản Lý Hóa Đơn Mua Vào | Quy trình quản lý hóa đơn mua vào |\n| 3   | PUR_004 | Quản Lý Giá Mua | Quy trình thiết lập và quản lý giá mua |\n| 4   | INV_005 | Quản Lý Nhập Xuất Kho | Quy trình nhập xuất kho |\n\n## 2. Quy Trình Nghiệp Vụ\n\n### 2.1. Tổng Quan Quy Trình\nQuy trình quản lý đơn mua hàng bao gồm các bước chính: tạo yêu cầu mua hàng, tạo đơn mua hàng, phê duyệt đơn, gửi đơn cho nhà cung cấp, nhận hàng và xác nhận hoàn thành đơn hàng. Các bên liên quan chính bao gồm người yêu cầu mua hàng, nhân viên mua hàng, người phê duyệt, nhà cung cấp và nhân viên kho.\n\n### 2.2. Sơ Đồ Quy Trình (Business Flow)\n\n```mermaid\nflowchart TD\n    A[Bắt đầu] --\u003e B[Tạo đơn mua hàng]\n    B --\u003e C[Nhập thông tin chi tiết đơn hàng]\n    C --\u003e D{Cần phê duyệt?}\n    D --\u003e|Có| E[Gửi phê duyệt]\n    E --\u003e F{Được duyệt?}\n    F --\u003e|Không| G[Chỉnh sửa đơn hàng]\n    G --\u003e E\n    F --\u003e|Có| H[Đánh dấu đã phê duyệt]\n    D --\u003e|Không| H\n    H --\u003e I[Gửi đơn cho nhà cung cấp]\n    I --\u003e J[Theo dõi đơn hàng]\n    J --\u003e K{Nhận hàng?}\n    K --\u003e|Chưa| L[Đánh dấu đang xử lý]\n    L --\u003e J\n    K --\u003e|Đã nhận| M[Cập nhật trạng thái]\n    M --\u003e N[Đối chiếu với hóa đơn]\n    N --\u003e O[Hoàn thành đơn hàng]\n    O --\u003e P[Kết thúc]\n```\n\n### 2.3. Chi Tiết Các Bước Quy Trình\n\n#### 2.3.1. Tạo đơn mua hàng\n- **Mô tả**: Nhân viên mua hàng tạo đơn mua hàng mới trong hệ thống\n- **Đầu vào**: Thông tin yêu cầu mua hàng, thông tin nhà cung cấp\n- **Đầu ra**: Đơn mua hàng ở trạng thái nháp\n- **Người thực hiện**: Nhân viên mua hàng\n- **Điều kiện tiên quyết**: Nhà cung cấp đã tồn tại trong hệ thống\n- **Xử lý ngoại lệ**: Nếu nhà cung cấp chưa tồn tại, cần tạo mới trong hệ thống\n\n#### 2.3.2. Nhập thông tin chi tiết đơn hàng\n- **Mô tả**: Nhập đầy đủ thông tin về các mặt hàng, số lượng, giá, thuế và các điều khoản khác\n- **Đầu vào**: Danh sách hàng hóa/dịch vụ, số lượng, giá, thuế, ngày giao hàng dự kiến\n- **Đầu ra**: Đơn mua hàng với thông tin chi tiết\n- **Người thực hiện**: Nhân viên mua hàng\n- **Điều kiện tiên quyết**: Đơn mua hàng đã được tạo ở trạng thái nháp\n- **Xử lý ngoại lệ**: Kiểm tra tính hợp lệ của giá, số lượng và các thông tin khác\n\n#### 2.3.3. Phê duyệt đơn mua hàng\n- **Mô tả**: Người có thẩm quyền xem xét và phê duyệt đơn mua hàng\n- **Đầu vào**: Đơn mua hàng cần phê duyệt\n- **Đầu ra**: Đơn mua hàng được phê duyệt hoặc từ chối\n- **Người thực hiện**: Người quản lý/phê duyệt\n- **Điều kiện tiên quyết**: Đơn mua hàng đã được tạo đầy đủ thông tin\n- **Xử lý ngoại lệ**: Trường hợp từ chối, cần ghi rõ lý do\n\n#### 2.3.4. Gửi đơn cho nhà cung cấp\n- **Mô tả**: Gửi đơn mua hàng đã được phê duyệt đến nhà cung cấp\n- **Đầu vào**: Đơn mua hàng đã phê duyệt\n- **Đầu ra**: Xác nhận đã gửi đơn\n- **Người thực hiện**: Nhân viên mua hàng\n- **Điều kiện tiên quyết**: Đơn mua hàng đã được phê duyệt\n- **Xử lý ngoại lệ**: Xử lý trường hợp không thể liên hệ với nhà cung cấp\n\n#### 2.3.5. Theo dõi và cập nhật đơn hàng\n- **Mô tả**: Theo dõi tiến độ thực hiện đơn hàng, liên hệ với nhà cung cấp nếu cần\n- **Đầu vào**: Mã đơn mua hàng, thông tin liên hệ nhà cung cấp\n- **Đầu ra**: Cập nhật trạng thái đơn hàng\n- **Người thực hiện**: Nhân viên mua hàng\n- **Điều kiện tiên quyết**: Đơn hàng đã được gửi cho nhà cung cấp\n- **Xử lý ngoại lệ**: Xử lý các trường hợp giao hàng trễ hoặc thay đổi điều khoản\n\n#### 2.3.6. Nhận hàng và hoàn thành đơn hàng\n- **Mô tả**: Xác nhận việc nhận hàng và cập nhật trạng thái đơn hàng\n- **Đầu vào**: Biên bản giao nhận hàng, thông tin đơn hàng\n- **Đầu ra**: Đơn mua hàng được cập nhật trạng thái \"Đã nhận hàng\"\n- **Người thực hiện**: Nhân viên kho, nhân viên mua hàng\n- **Điều kiện tiên quyết**: Hàng hóa đã được giao đến\n- **Xử lý ngoại lệ**: Xử lý trường hợp hàng hóa không đúng số lượng, chất lượng\n\n### 2.4. Sơ Đồ Tuần Tự (Sequence Diagram)\n\n```mermaid\nsequenceDiagram\n    participant Buyer as Nhân viên mua hàng\n    participant System as Hệ thống\n    participant Approver as Người phê duyệt\n    participant Vendor as Nhà cung cấp\n    participant Warehouse as Kho\n    \n    Buyer-\u003e\u003eSystem: Tạo đơn mua hàng\n    System--\u003e\u003eBuyer: Trả về form đơn hàng\n    Buyer-\u003e\u003eSystem: Nhập thông tin chi tiết\n    System-\u003e\u003eSystem: Kiểm tra dữ liệu\n    \n    alt Cần phê duyệt\n        Buyer-\u003e\u003eSystem: Gửi yêu cầu phê duyệt\n        System-\u003e\u003eApprover: Chuyển đơn để phê duyệt\n        Approver-\u003e\u003eSystem: Phê duyệt/Từ chối\n        \n        alt Từ chối\n            System--\u003e\u003eBuyer: Thông báo từ chối\n            Buyer-\u003e\u003eSystem: Chỉnh sửa đơn hàng\n            Buyer-\u003e\u003eSystem: Gửi lại phê duyệt\n            System-\u003e\u003eApprover: Chuyển đơn phê duyệt\n            Approver-\u003e\u003eSystem: Phê duyệt\n        end\n    end\n    \n    System--\u003e\u003eBuyer: Xác nhận đơn đã duyệt\n    Buyer-\u003e\u003eVendor: Gửi đơn mua hàng\n    \n    loop Theo dõi đơn hàng\n        Buyer-\u003e\u003eSystem: Cập nhật trạng thái\n        System--\u003e\u003eBuyer: Hiển thị trạng thái hiện tại\n    end\n    \n    Vendor-\u003e\u003eWarehouse: Giao hàng\n    Warehouse-\u003e\u003eSystem: Xác nhận nhận hàng\n    System-\u003e\u003eSystem: Cập nhật trạng thái\n    System--\u003e\u003eBuyer: Thông báo đã nhận hàng\n    Buyer-\u003e\u003eSystem: Hoàn thành đơn hàng\n```\n\n### 2.5. Luồng Nghiệp Vụ Thay Thế\n- **Hủy đơn hàng**: Trong trường hợp cần hủy đơn hàng đã phê duyệt, nhân viên mua hàng cần liên hệ với nhà cung cấp, xác nhận hủy đơn và cập nhật trạng thái trong hệ thống\n- **Thay đổi đơn hàng**: Nếu cần thay đổi thông tin đơn hàng sau khi đã phê duyệt, cần tạo phiên bản mới và qua quy trình phê duyệt lại\n- **Nhận hàng một phần**: Trong trường hợp chỉ nhận được một phần hàng, cần cập nhật số lượng đã nhận và giữ đơn hàng ở trạng thái \"Đang xử lý\" cho đến khi nhận đủ\n\n## 3. Yêu Cầu Chức Năng\n\n### 3.1. Danh Sách Chức Năng\n\n| STT | Mã chức năng | Tên chức năng | Mô tả | Độ ưu tiên |\n|-----|--------------|---------------|-------|------------|\n| 1   | PO_LIST | Xem danh sách đơn mua hàng | Hiển thị danh sách đơn mua hàng với các bộ lọc và tìm kiếm | Cao |\n| 2   | PO_CREATE | Tạo đơn mua hàng | Tạo mới đơn mua hàng trong hệ thống | Cao |\n| 3   | PO_UPDATE | Cập nhật đơn mua hàng | Chỉnh sửa thông tin đơn mua hàng | Cao |\n| 4   | PO_VIEW | Xem chi tiết đơn mua hàng | Xem toàn bộ thông tin chi tiết của đơn mua hàng | Cao |\n| 5   | PO_APPROVE | Phê duyệt đơn mua hàng | Phê duyệt hoặc từ chối đơn mua hàng | Cao |\n| 6   | PO_STATUS | Cập nhật trạng thái | Cập nhật trạng thái của đơn mua hàng | Cao |\n| 7   | PO_PRINT | In đơn mua hàng | Xuất đơn mua hàng ra file PDF để in | Trung bình |\n| 8   | PO_EXPORT | Xuất danh sách ra file | Xuất danh sách đơn mua hàng ra file Excel | Thấp |\n\n### 3.2. Chi Tiết Chức Năng\n\n#### 3.2.1. PO_CREATE: Tạo đơn mua hàng\n- **Mô tả**: Cho phép người dùng tạo đơn mua hàng mới trong hệ thống\n- **Đầu vào**: Thông tin nhà cung cấp, danh sách hàng hóa/dịch vụ, số lượng, giá, thuế, điều khoản thanh toán, ngày giao hàng dự kiến\n- **Đầu ra**: Đơn mua hàng mới được tạo trong hệ thống\n- **Điều kiện tiên quyết**: Người dùng đã đăng nhập và có quyền tạo đơn mua hàng\n- **Luồng xử lý chính**:\n  1. Người dùng chọn \"Tạo đơn mua hàng mới\"\n  2. Hệ thống hiển thị form nhập thông tin\n  3. Người dùng chọn nhà cung cấp\n  4. Hệ thống tự động điền thông tin nhà cung cấp\n  5. Người dùng thêm các mặt hàng, số lượng, giá, thuế\n  6. Hệ thống tính toán tổng tiền, thuế\n  7. Người dùng nhập các thông tin khác (ngày giao hàng, điều khoản thanh toán)\n  8. Người dùng nhấn \"Lưu\" hoặc \"Gửi phê duyệt\"\n  9. Hệ thống kiểm tra tính hợp lệ của dữ liệu\n  10. Hệ thống lưu đơn mua hàng và hiển thị thông báo thành công\n- **Luồng xử lý thay thế/ngoại lệ**:\n  1. Nếu dữ liệu không hợp lệ, hiển thị thông báo lỗi tương ứng\n  2. Nếu nhà cung cấp không tồn tại, gợi ý tạo mới nhà cung cấp\n- **Giao diện liên quan**: Form tạo đơn mua hàng\n\n#### 3.2.2. PO_UPDATE: Cập nhật đơn mua hàng\n- **Mô tả**: Cho phép người dùng cập nhật thông tin đơn mua hàng\n- **Đầu vào**: ID đơn mua hàng, thông tin cần cập nhật\n- **Đầu ra**: Đơn mua hàng đã cập nhật\n- **Điều kiện tiên quyết**: Đơn mua hàng đã tồn tại và đang ở trạng thái cho phép chỉnh sửa\n- **Luồng xử lý chính**:\n  1. Người dùng chọn đơn mua hàng cần cập nhật\n  2. Hệ thống hiển thị form với thông tin hiện tại\n  3. Người dùng chỉnh sửa thông tin\n  4. Người dùng nhấn \"Lưu\"\n  5. Hệ thống kiểm tra tính hợp lệ của dữ liệu\n  6. Hệ thống lưu thông tin đã cập nhật và hiển thị thông báo thành công\n- **Luồng xử lý thay thế/ngoại lệ**:\n  1. Nếu đơn đã được phê duyệt, không cho phép chỉnh sửa trực tiếp\n  2. Nếu cần chỉnh sửa đơn đã phê duyệt, yêu cầu tạo phiên bản mới\n- **Giao diện liên quan**: Form cập nhật đơn mua hàng\n\n## 4. Thiết Kế Kỹ Thuật\n\n### 4.1. Kiến Trúc Hệ Thống\n\n```mermaid\nflowchart TD\n    A[Client] --\u003e B[API Gateway]\n    B --\u003e C[PurchaseOrderService]\n    C --\u003e D[PurchaseOrderRepository]\n    C --\u003e E[VendorService]\n    E --\u003e F[VendorRepository]\n    C --\u003e G[ItemService]\n    G --\u003e H[ItemRepository]\n    D --\u003e I[(Database)]\n    F --\u003e I\n    H --\u003e I\n```\n\n### 4.2. API Endpoints\n\n#### 4.2.1. Lấy danh sách đơn mua hàng\n- **Mô tả**: Trả về danh sách đơn mua hàng theo điều kiện lọc\n- **URL**: `GET /api/v1/entity/{entity_slug}/purchase/`\n- **Query Parameters**:\n  - `status`: Lọc theo trạng thái\n  - `vendor`: Lọc theo nhà cung cấp\n  - `date_range`: Lọc theo khoảng thời gian\n  - `search`: Từ khóa tìm kiếm\n  - `page`: Số trang\n  - `page_size`: Số bản ghi trên mỗi trang\n  - `ordering`: Trường sắp xếp\n- **Response**: Danh sách đơn mua hàng, phân trang\n\n#### 4.2.2. Lấy chi tiết đơn mua hàng\n- **Mô tả**: Trả về thông tin chi tiết của một đơn mua hàng\n- **URL**: `GET /api/v1/entity/{entity_slug}/purchase/{uuid}/`\n- **Response**: Chi tiết đơn mua hàng và các dòng chi tiết\n\n#### 4.2.3. Tạo đơn mua hàng mới\n- **Mô tả**: Tạo đơn mua hàng mới trong hệ thống\n- **URL**: `POST /api/v1/entity/{entity_slug}/purchase/`\n- **Request Body**: Thông tin đơn mua hàng\n- **Response**: Thông tin đơn mua hàng đã tạo\n\n#### 4.2.4. Cập nhật đơn mua hàng\n- **Mô tả**: Cập nhật thông tin đơn mua hàng\n- **URL**: `PUT /api/v1/entity/{entity_slug}/purchase/{uuid}/`\n- **Request Body**: Thông tin cập nhật\n- **Response**: Thông tin đơn mua hàng đã cập nhật\n\n#### 4.2.5. Cập nhật trạng thái đơn mua hàng\n- **Mô tả**: Cập nhật trạng thái của đơn mua hàng\n- **URL**: `PATCH /api/v1/entity/{entity_slug}/purchase/{uuid}/status/`\n- **Request Body**: Trạng thái mới, ghi chú\n- **Response**: Thông tin trạng thái đã cập nhật\n\n### 4.3. Service Logic\n\n#### 4.3.1. PurchaseOrderService\n- **Mô tả**: Xử lý logic nghiệp vụ liên quan đến quản lý đơn mua hàng\n- **Chức năng chính**:\n  1. Tạo đơn mua hàng mới\n  2. Cập nhật thông tin đơn mua hàng\n  3. Quản lý trạng thái đơn mua hàng\n  4. Tính toán tổng tiền, thuế\n  5. Phê duyệt đơn mua hàng\n- **Các dependencies**:\n  1. PurchaseOrderRepository\n  2. VendorService\n  3. ItemService\n- **Sơ đồ luồng xử lý**:\n\n```mermaid\nflowchart TD\n    A[Nhận request] --\u003e B[Validate dữ liệu]\n    B --\u003e C{Dữ liệu hợp lệ?}\n    C --\u003e|Có| D[Xử lý business logic]\n    C --\u003e|Không| E[Trả về lỗi]\n    D --\u003e F[Gọi repository]\n    F --\u003e G[Ghi log]\n    G --\u003e H[Trả về kết quả]\n    E --\u003e G\n```\n\n### 4.4. Mô Hình Dữ Liệu\n\n#### 4.4.1. Entity Relationship Diagram (ERD)\n\n```mermaid\nerDiagram\n    EntityModel ||--o{ DonMuaHangModel : \"có\"\n    CustomerModel ||--o{ DonMuaHangModel : \"cung cấp cho\"\n    NhanVienModel ||--o{ DonMuaHangModel : \"tạo bởi\"\n    KhoHangModel ||--o{ DonMuaHangModel : \"giao đến\"\n    \n    DonMuaHangModel ||--o{ ChiTietDonMuaHangModel : \"có\"\n    \n    DonMuaHangModel {\n        UUID uuid PK\n        FK EntityModel entity_model\n        FK CustomerModel ma_ncc\n        String mst\n        String ten_ncc\n        String nguoi_lien_he\n        String dia_chi\n        String e_mail\n        FK NhanVienModel ma_nvmh\n        FK HanThanhToanModel han_thanh_toan\n        String dien_giai\n        FK QuyenChungTu so_ct\n        Date ngay_ct\n        Date ngay_lct\n        Date ngay_hl\n        String so_hd\n        FK NgoaiTeModel ma_nt\n        Decimal ty_gia\n        String status\n        String dien_thoai\n        FK KhoHangModel ma_kho\n        FK PhuongThucThanhToanModel phuong_thuc_thanh_toan\n        FK DiaChiNhanHangModel noi_nhan\n        String giao_dich\n        String ly_do_huy\n        String ghi_chu\n        Decimal t_so_luong\n        Decimal t_chi_phi\n        Decimal t_tien\n        Decimal t_thue\n        Decimal t_tt\n    }\n    \n    ChiTietDonMuaHangModel {\n        UUID uuid PK\n        FK DonMuaHangModel don_mua_hang\n        FK VatTuModel ma_vt\n        String ten_vt\n        String dvt\n        Decimal so_luong\n        Decimal gia\n        Decimal thanh_tien\n        Decimal ty_le_ck\n        Decimal tien_ck\n        FK ThueSuatModel thue_suat\n        Decimal tien_thue\n        Decimal tong_tien\n        String ghi_chu\n    }\n```\n\n#### 4.4.2. Chi Tiết Bảng Dữ Liệu\n\n##### Bảng: DonMuaHangModel\n- **Mô tả**: Lưu trữ thông tin về đơn mua hàng\n- **Các trường chính**:\n  - `uuid`: Khóa chính, định danh duy nhất\n  - `entity_model`: Khóa ngoại tham chiếu đến EntityModel\n  - `ma_ncc`: Khóa ngoại tham chiếu đến nhà cung cấp (CustomerModel)\n  - `mst`: Mã số thuế của nhà cung cấp\n  - `ten_ncc`: Tên nhà cung cấp\n  - `nguoi_lien_he`: Người liên hệ tại nhà cung cấp\n  - `dia_chi`: Địa chỉ nhà cung cấp\n  - `e_mail`: Email nhà cung cấp\n  - `ma_nvmh`: Khóa ngoại tham chiếu đến nhân viên mua hàng (NhanVienModel)\n  - `han_thanh_toan`: Khóa ngoại tham chiếu đến hạn thanh toán (HanThanhToanModel)\n  - `dien_giai`: Mô tả chi tiết về đơn mua hàng\n  - `so_ct`: Khóa ngoại tham chiếu đến số chứng từ (QuyenChungTu)\n  - `ngay_ct`: Ngày chứng từ\n  - `ngay_lct`: Ngày lập chứng từ\n  - `ngay_hl`: Ngày hiệu lực\n  - `so_hd`: Số hợp đồng (nếu có)\n  - `ma_nt`: Khóa ngoại tham chiếu đến ngoại tệ (NgoaiTeModel)\n  - `ty_gia`: Tỷ giá quy đổi\n  - `status`: Trạng thái đơn mua hàng\n  - `dien_thoai`: Số điện thoại liên hệ\n  - `ma_kho`: Khóa ngoại tham chiếu đến kho nhận hàng (KhoHangModel)\n  - `phuong_thuc_thanh_toan`: Khóa ngoại tham chiếu đến phương thức thanh toán (PhuongThucThanhToanModel)\n  - `noi_nhan`: Khóa ngoại tham chiếu đến địa chỉ nhận hàng (DiaChiNhanHangModel)\n  - `ly_do_huy`: Lý do hủy đơn (nếu có)\n  - `ghi_chu`: Ghi chú thêm\n  - `t_so_luong`: Tổng số lượng\n  - `t_chi_phi`: Tổng chi phí\n  - `t_tien`: Tổng tiền trước thuế\n  - `t_thue`: Tổng thuế\n  - `t_tt`: Tổng thanh toán (sau thuế)\n\n##### Bảng: ChiTietDonMuaHangModel\n- **Mô tả**: Lưu trữ thông tin chi tiết về các mặt hàng trong đơn mua hàng\n- **Các trường chính**:\n  - `uuid`: Khóa chính, định danh duy nhất\n  - `don_mua_hang`: Khóa ngoại tham chiếu đến đơn mua hàng (DonMuaHangModel)\n  - `ma_vt`: Khóa ngoại tham chiếu đến vật tư/hàng hóa (VatTuModel)\n  - `ten_vt`: Tên vật tư/hàng hóa\n  - `dvt`: Đơn vị tính\n  - `so_luong`: Số lượng đặt mua\n  - `gia`: Đơn giá\n  - `thanh_tien`: Thành tiền (số lượng x đơn giá)\n  - `ty_le_ck`: Tỷ lệ chiết khấu (%)\n  - `tien_ck`: Tiền chiết khấu\n  - `thue_suat`: Khóa ngoại tham chiếu đến thuế suất (ThueSuatModel)\n  - `tien_thue`: Tiền thuế\n  - `tong_tien`: Tổng tiền (thành tiền - tiền chiết khấu + tiền thuế)\n  - `ghi_chu`: Ghi chú thêm\n\n## 5. Kế Hoạch Kiểm Thử\n\n### 5.1. Phạm Vi Kiểm Thử\nKiểm thử sẽ bao gồm tất cả các chức năng liên quan đến quản lý đơn mua hàng, bao gồm:\n- Tạo mới đơn mua hàng\n- Cập nhật thông tin đơn mua hàng\n- Thêm, sửa, xóa chi tiết đơn hàng\n- Phê duyệt đơn mua hàng\n- Thay đổi trạng thái đơn mua hàng\n- Tích hợp với các phân hệ liên quan (nhà cung cấp, hàng hóa, kho)\n\n### 5.2. Kịch Bản Kiểm Thử\n\n| STT | Mã kịch bản | Tên kịch bản | Mô tả | Điều kiện tiên quyết | Các bước | Kết quả mong đợi |\n|-----|------------|--------------|-------|---------------------|----------|-----------------|\n| 1   | TC_PO_C01 | Tạo đơn mua hàng mới thành công | Kiểm tra việc tạo đơn mua hàng mới | Người dùng đã đăng nhập và có quyền tạo | 1. Truy cập form tạo đơn\u003cbr\u003e2. Chọn nhà cung cấp\u003cbr\u003e3. Thêm các mặt hàng\u003cbr\u003e4. Nhập thông tin khác\u003cbr\u003e5. Nhấn Lưu | Đơn mua hàng mới được tạo với số chứng từ tự động |\n| 2   | TC_PO_C02 | Tạo đơn với dữ liệu thiếu | Kiểm tra validate dữ liệu bắt buộc | Người dùng đã đăng nhập và có quyền tạo | 1. Truy cập form tạo đơn\u003cbr\u003e2. Bỏ trống các trường bắt buộc\u003cbr\u003e3. Nhấn Lưu | Hiển thị thông báo lỗi về các trường bắt buộc |\n| 3   | TC_PO_U01 | Cập nhật thông tin đơn mua hàng | Kiểm tra cập nhật thông tin | Đơn mua hàng đã tồn tại ở trạng thái nháp | 1. Mở form cập nhật\u003cbr\u003e2. Thay đổi thông tin\u003cbr\u003e3. Nhấn Lưu | Thông tin được cập nhật thành công |\n| 4   | TC_PO_A01 | Phê duyệt đơn mua hàng | Kiểm tra quy trình phê duyệt | Đơn mua hàng đã tồn tại chờ phê duyệt | 1. Chọn đơn cần phê duyệt\u003cbr\u003e2. Nhấn nút Phê duyệt\u003cbr\u003e3. Xác nhận | Trạng thái đơn chuyển thành \"Đã phê duyệt\" |\n| 5   | TC_PO_S01 | Thay đổi trạng thái đơn mua hàng | Kiểm tra thay đổi trạng thái | Đơn mua hàng đã tồn tại | 1. Chọn đơn hàng\u003cbr\u003e2. Chọn trạng thái mới\u003cbr\u003e3. Nhấn cập nhật | Trạng thái được cập nhật thành công |\n\n## 6. Phụ Lục\n\n### 6.1. Danh Sách Tài Liệu Tham Khảo\n1. Tài liệu thiết kế cơ sở dữ liệu ERP\n2. Tài liệu API đặc tả\n3. Quy định về quy trình mua hàng của doanh nghiệp\n\n### 6.2. Danh Mục Thuật Ngữ\n- **PO**: Purchase Order - Đơn mua hàng\n- **MST**: Mã số thuế\n- **Số CT**: Số chứng từ\n- **Ngoại tệ**: Loại tiền tệ sử dụng trong giao dịch\n- **Tỷ giá**: Tỷ lệ quy đổi giữa ngoại tệ và tiền tệ địa phương\n\n### 6.3. Lịch Sử Thay Đổi Tài Liệu\n\n| Phiên bản | Ngày | Người thực hiện | Mô tả thay đổi |\n|-----------|------|-----------------|---------------|\n| 1.0 | 25/07/2023 | Auto Generated | Tạo mới tài liệu |\n| 1.1 | 09/07/2024 | AI Assistant | Cập nhật tài liệu theo mã nguồn thực tế |"])</script><script>self.__next_f.push([1,"9:[\"slug\",\"erp/PUR_002_Quan_Ly_Don_Mua_Hang\",\"c\"]\nf:[]\n"])</script><script>self.__next_f.push([1,"0:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/erp-docs/_next/static/css/4b73dfd0f7bdc629.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"$L3\",null,{\"buildId\":\"X5KF-BjlTdL2YCafX7ACW\",\"assetPrefix\":\"/erp-docs\",\"initialCanonicalUrl\":\"/erp/PUR_002_Quan_Ly_Don_Mua_Hang/\",\"initialTree\":[\"\",{\"children\":[[\"slug\",\"erp/PUR_002_Quan_Ly_Don_Mua_Hang\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"erp\\\",\\\"PUR_002_Quan_Ly_Don_Mua_Hang\\\"]}\",{}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[[\"slug\",\"erp/PUR_002_Quan_Ly_Don_Mua_Hang\",\"c\"],{\"children\":[\"__PAGE__\",{},[[\"$L4\",[\"$\",\"$L5\",null,{\"children\":[\"$\",\"article\",null,{\"className\":\"prose prose-slate dark:prose-invert max-w-none\",\"children\":[[\"$\",\"header\",null,{\"className\":\"mb-8\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"mb-2\",\"children\":\"$undefined\"}],\"$undefined\",\"$undefined\"]}],[\"$\",\"$L6\",null,{\"content\":\"$7\"}]]}]}]],null],null]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$9\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}],null]},[[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[\"$\",\"body\",null,{\"className\":\"__className_985585\",\"children\":[\"$\",\"$Lb\",null,{\"attribute\":\"class\",\"defaultTheme\":\"system\",\"enableSystem\":true,\"disableTransitionOnChange\":true,\"children\":[\"$\",\"$Lc\",null,{\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"styles\":null}]}]}]}]}],null],null],\"couldBeIntercepted\":false,\"initialHead\":[false,\"$Ld\"],\"globalErrorComponent\":\"$e\",\"missingSlots\":\"$Wf\"}]]\n"])</script><script>self.__next_f.push([1,"d:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"undefined | ERP Documentation\"}],[\"$\",\"meta\",\"3\",{\"name\":\"keywords\",\"content\":\"documentation,ERP,technical,mermaid,markdown\"}],[\"$\",\"meta\",\"4\",{\"name\":\"next-size-adjust\"}]]\n4:null\n"])</script></body></html>