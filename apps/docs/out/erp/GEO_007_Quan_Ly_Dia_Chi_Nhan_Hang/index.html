<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/erp-docs/_next/static/media/e4af272ccee01ff0-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/erp-docs/_next/static/css/4b73dfd0f7bdc629.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/erp-docs/_next/static/chunks/webpack-39532e8569213db6.js"/><script src="/erp-docs/_next/static/chunks/7384d974-8b753aa07a0575a2.js" async=""></script><script src="/erp-docs/_next/static/chunks/381-1b6d0728bba7b8e7.js" async=""></script><script src="/erp-docs/_next/static/chunks/main-app-5d87a2fd0f4f2f33.js" async=""></script><script src="/erp-docs/_next/static/chunks/d550ec10-485e3f71f5def856.js" async=""></script><script src="/erp-docs/_next/static/chunks/993-1b6a71072be86da4.js" async=""></script><script src="/erp-docs/_next/static/chunks/410-1ece2fcedd156d2f.js" async=""></script><script src="/erp-docs/_next/static/chunks/app/%5B...slug%5D/page-7978846c0e32abf5.js" async=""></script><script src="/erp-docs/_next/static/chunks/app/layout-b6ef60bec0ff2cf2.js" async=""></script><title>undefined | ERP Documentation</title><meta name="keywords" content="documentation,ERP,technical,mermaid,markdown"/><meta name="next-size-adjust"/><script src="/erp-docs/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="__className_985585"><div class="min-h-screen flex items-center justify-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div><script src="/erp-docs/_next/static/chunks/webpack-39532e8569213db6.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/erp-docs/_next/static/media/e4af272ccee01ff0-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/erp-docs/_next/static/css/4b73dfd0f7bdc629.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"3:I[5214,[],\"\"]\n5:I[3040,[\"135\",\"static/chunks/d550ec10-485e3f71f5def856.js\",\"993\",\"static/chunks/993-1b6a71072be86da4.js\",\"410\",\"static/chunks/410-1ece2fcedd156d2f.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-7978846c0e32abf5.js\"],\"DocLayout\"]\n6:I[1276,[\"135\",\"static/chunks/d550ec10-485e3f71f5def856.js\",\"993\",\"static/chunks/993-1b6a71072be86da4.js\",\"410\",\"static/chunks/410-1ece2fcedd156d2f.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-7978846c0e32abf5.js\"],\"MDXContent\"]\n8:I[6472,[],\"\"]\na:I[9190,[],\"\"]\nb:I[4550,[\"185\",\"static/chunks/app/layout-b6ef60bec0ff2cf2.js\"],\"ThemeProvider\"]\nc:I[8910,[\"185\",\"static/chunks/app/layout-b6ef60bec0ff2cf2.js\"],\"AuthProvider\"]\ne:I[3013,[],\"\"]\n7:T4edd,"])</script><script>self.__next_f.push([1,"# GEO_007_Geography_Quản Lý Thông Tin Địa Chỉ Nhận Hàng\n\n*Phiên bản: 1.0*\n*Người tạo: Cline*\n*Ngày tạo: 13/05/2025*\n*Cập nhật lần cuối: 13/05/2025*\n*Người cập nhật: Cline*\n\n## 1. Tổng Quan Nghiệp Vụ\n\n### 1.1. Mô Tả Nghiệp Vụ\nNghiệp vụ này cho phép quản lý các thông tin bổ sung cụ thể cho mục đích nhận hàng hoặc giao hàng, liên kết với một địa chỉ cơ sở đã được định nghĩa trong hệ thống (`GEO_006_Quan_Ly_Dia_Chi`). Các thông tin này bao gồm tên người nhận, số điện thoại người nhận, email, tên gợi nhớ cho địa chỉ (ví dụ: \"Nhà riêng\", \"Văn phòng\"), và các hướng dẫn giao hàng đặc biệt. Một bản ghi \"Thông Tin Địa Chỉ Nhận Hàng\" giúp chuẩn hóa và tái sử dụng thông tin giao nhận cho các đối tượng khác nhau như Khách hàng, Đơn hàng Bán, Đơn hàng Mua.\n\n### 1.2. Phạm Vi Áp Dụng\nÁp dụng cho các bộ phận liên quan đến giao nhận hàng hóa, quản lý khách hàng, quản lý đơn hàng. Người dùng có thể tạo, cập nhật, xem và xóa các bản ghi thông tin địa chỉ nhận hàng này. Các bản ghi này sau đó có thể được chọn và liên kết khi tạo đơn hàng hoặc thiết lập thông tin giao hàng cho khách hàng/nhà cung cấp.\n\n### 1.3. Định Nghĩa Thuật Ngữ\n| Thuật ngữ | Định nghĩa |\n|-----------|------------|\n| Thông Tin Địa Chỉ Nhận Hàng | Một bản ghi chứa các thông tin cụ thể cho việc giao/nhận hàng tại một địa chỉ. |\n| Địa Chỉ Cơ Sở (dia_chi_uuid) | UUID của một bản ghi `DiaChiModel` (từ GEO_006) mà thông tin nhận hàng này áp dụng. |\n| Tên Người Nhận (ten_nguoi_nhan) | Tên của người hoặc bộ phận sẽ nhận hàng. |\n| Số Điện Thoại Người Nhận (so_dien_thoai_nguoi_nhan) | Số điện thoại liên lạc của người nhận. |\n| Email Người Nhận (email_nguoi_nhan) | Địa chỉ email của người nhận (tùy chọn). |\n| Tên Gợi Nhớ Địa Chỉ (ten_goi_nho_dia_chi) | Tên ngắn gọn, dễ nhớ để phân biệt các địa chỉ nhận hàng khác nhau (ví dụ: \"Kho chính\", \"VP Hà Nội\"). |\n| Hướng Dẫn Giao Hàng (huong_dan_giao_hang) | Các chỉ dẫn đặc biệt cho người giao hàng (ví dụ: \"Giao hàng trong giờ hành chính\", \"Gọi trước khi đến\"). |\n| Trạng Thái (status) | Trạng thái của thông tin địa chỉ nhận hàng (ví dụ: 1 - Hoạt động, 0 - Không hoạt động). |\n| Entity (Đơn vị) | Đơn vị/Công ty sử dụng hệ thống ERP. Mỗi bản ghi được quản lý trong phạm vi một Entity cụ thể. |\n\n### 1.4. Tài Liệu Liên Quan\n| STT | Mã tài liệu | Tên tài liệu | Mô tả |\n|-----|-------------|--------------|-------|\n| 1   | GEO_006 | Quản Lý Địa Chỉ | Cung cấp các bản ghi địa chỉ cơ sở. |\n| 2   | SAL_001 | Quản Lý Khách Hàng | Khách hàng có thể có nhiều thông tin địa chỉ nhận hàng được lưu. |\n| 3   | SAL_004 | Quản Lý Hóa Đơn Bán Hàng | Đơn hàng bán sẽ sử dụng thông tin địa chỉ nhận hàng để giao hàng. |\n| 4   | PUR_002 | Quản Lý Đơn Mua Hàng | Đơn hàng mua có thể chỉ định thông tin địa chỉ nhận hàng của công ty. |\n\n## 2. Quy Trình Nghiệp Vụ\n\n### 2.1. Tổng Quan Quy Trình\nQuy trình bao gồm việc tạo mới một bản ghi \"Thông Tin Địa Chỉ Nhận Hàng\" bằng cách chọn một địa chỉ cơ sở (từ GEO_006) và điền các thông tin giao nhận cụ thể. Người dùng cũng có thể xem, cập nhật và xóa (logic) các bản ghi này.\n\n### 2.2. Sơ Đồ Quy Trình (Business Flow)\n\n```mermaid\nflowchart TD\n    A[Người dùng yêu cầu thao tác quản lý thông tin địa chỉ nhận hàng] --\u003e B{Chọn thao tác};\n    B --\u003e|Thêm mới| C[Chọn Địa chỉ cơ sở (GEO_006) \u0026 Nhập thông tin người nhận, SĐT, tên gợi nhớ, hướng dẫn...];\n    B --\u003e|Cập nhật| D[Chọn bản ghi thông tin \u0026 Nhập thông tin mới];\n    B --\u003e|Xóa| E[Chọn bản ghi thông tin \u0026 Xác nhận xóa];\n    B --\u003e|Xem danh sách| F[Hệ thống hiển thị danh sách thông tin địa chỉ nhận hàng (có thể lọc)];\n    B --\u003e|Xem chi tiết| G[Chọn bản ghi thông tin \u0026 Hệ thống hiển thị chi tiết];\n    C --\u003e H[Hệ thống kiểm tra dữ liệu (Địa chỉ cơ sở tồn tại, ...)];\n    D --\u003e H;\n    H --\u003e|Hợp lệ| I[Lưu thông tin vào CSDL];\n    H --\u003e|Không hợp lệ| J[Thông báo lỗi];\n    I --\u003e K[Thông báo thành công];\n    E --\u003e L[Hệ thống kiểm tra ràng buộc (Đang được sử dụng trong Đơn hàng?)];\n    L --\u003e|Không có ràng buộc / Cho phép xóa logic| M[Xóa bản ghi khỏi CSDL hoặc cập nhật trạng thái];\n    L --\u003e|Có ràng buộc| N[Thông báo lỗi không thể xóa];\n    M --\u003e K;\n    F --\u003e Z[Kết thúc];\n    G --\u003e Z;\n    J --\u003e A;\n    K --\u003e A;\n    N --\u003e A;\n```\n\n### 2.3. Chi Tiết Các Bước Quy Trình\n\n#### 2.3.1. Thêm Mới Thông Tin Địa Chỉ Nhận Hàng\n- **Mô tả**: Người dùng tạo một bản ghi mới chứa thông tin chi tiết cho việc nhận/giao hàng tại một địa chỉ cụ thể.\n- **Đầu vào**: UUID của địa chỉ cơ sở (`dia_chi_uuid`), tên người nhận, SĐT người nhận, email người nhận (tùy chọn), tên gợi nhớ địa chỉ, hướng dẫn giao hàng (tùy chọn), trạng thái (mặc định là hoạt động).\n- **Đầu ra**: Bản ghi \"Thông Tin Địa Chỉ Nhận Hàng\" mới được tạo.\n- **Người thực hiện**: Người dùng có quyền.\n- **Điều kiện tiên quyết**: Người dùng đã đăng nhập. Địa chỉ cơ sở (`DiaChiModel`) phải tồn tại.\n- **Xử lý ngoại lệ**:\n    - Nếu địa chỉ cơ sở không tồn tại: Thông báo lỗi.\n    - Nếu thông tin không hợp lệ: Thông báo lỗi.\n\n#### 2.3.2. Cập Nhật Thông Tin Địa Chỉ Nhận Hàng\n- **Mô tả**: Người dùng thay đổi thông tin của một bản ghi đã tồn tại.\n- **Đầu vào**: UUID của bản ghi \"Thông Tin Địa Chỉ Nhận Hàng\" cần cập nhật, thông tin mới.\n- **Đầu ra**: Thông tin bản ghi được cập nhật.\n- **Người thực hiện**: Người dùng có quyền.\n- **Điều kiện tiên quyết**: Bản ghi tồn tại trong hệ thống.\n- **Xử lý ngoại lệ**:\n    - Nếu bản ghi không tồn tại: Thông báo lỗi.\n    - Nếu thông tin không hợp lệ: Thông báo lỗi.\n\n#### 2.3.3. Xóa Thông Tin Địa Chỉ Nhận Hàng\n- **Mô tả**: Người dùng xóa một bản ghi \"Thông Tin Địa Chỉ Nhận Hàng\".\n- **Đầu vào**: UUID của bản ghi cần xóa.\n- **Đầu ra**: Bản ghi bị xóa (hoặc đánh dấu không hoạt động).\n- **Người thực hiện**: Người dùng có quyền.\n- **Điều kiện tiên quyết**: Bản ghi tồn tại.\n- **Xử lý ngoại lệ**:\n    - Nếu bản ghi không tồn tại: Thông báo lỗi.\n    - Nếu bản ghi đang được tham chiếu (ví dụ: trong một đơn hàng chưa hoàn thành): Cân nhắc chỉ cho phép xóa logic.\n\n#### 2.3.4. Xem Danh Sách Thông Tin Địa Chỉ Nhận Hàng\n- **Mô tả**: Người dùng xem danh sách các thông tin địa chỉ nhận hàng. Có thể lọc theo địa chỉ cơ sở, tên người nhận, v.v.\n- **Đầu vào**: Entity slug, tùy chọn: các tiêu chí lọc, phân trang.\n- **Đầu ra**: Danh sách các bản ghi \"Thông Tin Địa Chỉ Nhận Hàng\".\n- **Người thực hiện**: Bất kỳ người dùng nào có quyền truy cập chức năng.\n\n#### 2.3.5. Xem Chi Tiết Thông Tin Địa Chỉ Nhận Hàng\n- **Mô tả**: Người dùng xem thông tin chi tiết của một bản ghi cụ thể.\n- **Đầu vào**: UUID của bản ghi.\n- **Đầu ra**: Thông tin chi tiết của bản ghi, bao gồm cả thông tin địa chỉ cơ sở liên quan.\n- **Người thực hiện**: Bất kỳ người dùng nào có quyền truy cập chức năng.\n- **Điều kiện tiên quyết**: Bản ghi tồn tại.\n- **Xử lý ngoại lệ**: Nếu bản ghi không tồn tại: Thông báo lỗi.\n\n### 2.4. Sơ Đồ Tuần Tự (Sequence Diagram) - Thêm Mới Thông Tin Địa Chỉ Nhận Hàng\n\n```mermaid\nsequenceDiagram\n    participant User as Người dùng\n    participant System as Hệ thống (API)\n    participant Service as DiaChiNhanHangModelService\n    participant Repository as DiaChiNhanHangRepository\n    participant DiaChiRepo as DiaChiRepository\n    participant DB as Cơ sở dữ liệu\n\n    User-\u003e\u003eSystem: POST /api/{entity_slug}/dia-chi-nhan-hang/ (data: dia_chi_uuid, ten_nguoi_nhan, ...)\n    System-\u003e\u003eService: create_dia_chi_nhan_hang(entity_slug, data)\n    Service-\u003e\u003eService: _get_entity_model(entity_slug)\n    Service--\u003e\u003eService: entity_model\n    Service-\u003e\u003eDiaChiRepo: get_dia_chi_by_uuid(data['dia_chi_uuid'])\n    DiaChiRepo-\u003e\u003eDB: SELECT * FROM DiaChiModel WHERE uuid = ... AND entity_id = ...\n    DB--\u003e\u003eDiaChiRepo: dia_chi_model (or null)\n    DiaChiRepo--\u003e\u003eService: dia_chi_model (or null)\n    alt Địa chỉ cơ sở không tồn tại\n        Service--\u003e\u003eSystem: Error: \"Base Address not found\"\n        System--\u003e\u003eUser: Response 400 (Error message)\n    else Địa chỉ cơ sở tồn tại\n        Service-\u003e\u003eService: validate_dia_chi_nhan_hang_data(data)\n        Service--\u003e\u003eService: validated_data\n        Service-\u003e\u003eRepository: create_dia_chi_nhan_hang(entity_model, dia_chi_model, validated_data)\n        Repository-\u003e\u003eDB: INSERT INTO DiaChiNhanHangModel (...) VALUES (...)\n        DB--\u003e\u003eRepository: new_object\n        Repository--\u003e\u003eService: new_object\n        Service--\u003e\u003eSystem: new_object_with_details\n        System--\u003e\u003eUser: Response 201 (new_data)\n    end\n```\n\n## 3. Yêu Cầu Chức Năng\n\n### 3.1. Danh Sách Chức Năng\n\n| STT | Mã chức năng | Tên chức năng | Mô tả | Độ ưu tiên |\n|-----|--------------|---------------|-------|------------|\n| 1   | GEO_007_F01 | Thêm mới thông tin địa chỉ nhận hàng | Cho phép tạo một bản ghi thông tin nhận hàng mới, liên kết với một địa chỉ cơ sở. | Cao |\n| 2   | GEO_007_F02 | Cập nhật thông tin địa chỉ nhận hàng | Cho phép sửa thông tin của một bản ghi đã có. | Cao |\n| 3   | GEO_007_F03 | Xóa thông tin địa chỉ nhận hàng | Cho phép xóa một bản ghi. | Cao |\n| 4   | GEO_007_F04 | Xem danh sách thông tin địa chỉ nhận hàng | Hiển thị danh sách, hỗ trợ phân trang và lọc. | Cao |\n| 5   | GEO_007_F05 | Xem chi tiết thông tin địa chỉ nhận hàng | Hiển thị thông tin chi tiết của một bản ghi. | Cao |\n| 6   | GEO_007_F06 | Tìm kiếm thông tin địa chỉ nhận hàng | Cho phép tìm kiếm dựa trên tên người nhận, SĐT, tên gợi nhớ. | Trung bình |\n\n### 3.2. Chi Tiết Chức Năng\n\n#### 3.2.1. GEO_007_F01: Thêm mới thông tin địa chỉ nhận hàng\n- **Mô tả**: Tạo mới một bản ghi thông tin địa chỉ nhận hàng.\n- **Đầu vào**:\n    - `entity_slug`: Slug của Entity.\n    - `data`: Đối tượng chứa thông tin:\n        - `dia_chi_uuid` (bắt buộc): UUID của `DiaChiModel` (địa chỉ cơ sở).\n        - `ten_nguoi_nhan` (bắt buộc): Tên người nhận (string, max 255).\n        - `so_dien_thoai_nguoi_nhan` (bắt buộc): SĐT người nhận (string, max 20).\n        - `email_nguoi_nhan` (tùy chọn): Email người nhận (string, max 255).\n        - `ten_goi_nho_dia_chi` (tùy chọn): Tên gợi nhớ (string, max 255).\n        - `huong_dan_giao_hang` (tùy chọn): Hướng dẫn giao hàng (text).\n        - `status` (tùy chọn): Trạng thái (integer). Mặc định là 1.\n- **Đầu ra**: Đối tượng `DiaChiNhanHangModel` vừa được tạo.\n- **Điều kiện tiên quyết**: `entity_slug` và `dia_chi_uuid` hợp lệ.\n- **Luồng xử lý chính**:\n  1. Service lấy `EntityModel` và `DiaChiModel`.\n  2. Service validate dữ liệu.\n  3. Service gọi Repository để tạo mới.\n- **Giao diện liên quan**: Form thêm mới thông tin địa chỉ nhận hàng.\n\n#### 3.2.2. GEO_007_F02: Cập nhật thông tin địa chỉ nhận hàng\n- **Mô tả**: Cập nhật thông tin.\n- **Đầu vào**: `entity_slug`, `uuid` của bản ghi, `data` cập nhật.\n- **Đầu ra**: Đối tượng `DiaChiNhanHangModel` đã cập nhật.\n- **Giao diện liên quan**: Form cập nhật.\n\n#### 3.2.3. GEO_007_F03: Xóa thông tin địa chỉ nhận hàng\n- **Mô tả**: Xóa một bản ghi.\n- **Đầu vào**: `entity_slug`, `uuid` của bản ghi.\n- **Đầu ra**: HTTP 204 No Content hoặc đối tượng đã cập nhật trạng thái.\n- **Điều kiện tiên quyết**: Kiểm tra ràng buộc tham chiếu.\n- **Giao diện liên quan**: Nút xóa.\n\n#### 3.2.4. GEO_007_F04: Xem danh sách thông tin địa chỉ nhận hàng\n- **Mô tả**: Lấy danh sách, có phân trang và lọc.\n- **Đầu vào**: `entity_slug`, `page`, `page_size`, các tham số lọc.\n- **Đầu ra**: Danh sách `DiaChiNhanHangModel`.\n- **Giao diện liên quan**: Trang danh sách.\n\n#### 3.2.5. GEO_007_F05: Xem chi tiết thông tin địa chỉ nhận hàng\n- **Mô tả**: Lấy chi tiết một bản ghi.\n- **Đầu vào**: `entity_slug`, `uuid` của bản ghi.\n- **Đầu ra**: Đối tượng `DiaChiNhanHangModel` với chi tiết địa chỉ cơ sở.\n- **Giao diện liên quan**: Trang chi tiết.\n\n## 4. Thiết Kế Kỹ Thuật\n\n### 4.1. Kiến Trúc Hệ Thống\nSử dụng Views/APIs, Services (`DiaChiNhanHangModelService`), Repositories (`DiaChiNhanHangRepository`), Models (`DiaChiNhanHangModel`, `DiaChiModel`, `EntityModel`).\n\n### 4.2. API Endpoints\n\n- **Base URL**: `/api/{entity_slug}/dia-chi-nhan-hang/`\n- **Endpoints**:\n    - `GET /`: Lấy danh sách. (GEO_007_F04)\n        - Query params: `page`, `page_size`, `dia_chi_uuid`, `ten_nguoi_nhan`, `status`.\n    - `POST /`: Tạo mới. (GEO_007_F01)\n        - Request body: `{ \"dia_chi_uuid\": \"uuid_dia_chi_co_so\", \"ten_nguoi_nhan\": \"Nguyễn Văn A\", ... }`\n    - `GET /{uuid}/`: Lấy chi tiết. (GEO_007_F05)\n    - `PUT /{uuid}/`: Cập nhật. (GEO_007_F02)\n    - `PATCH /{uuid}/`: Cập nhật một phần. (GEO_007_F02)\n    - `DELETE /{uuid}/`: Xóa. (GEO_007_F03)\n\n### 4.3. Service Logic (`DiaChiNhanHangModelService`)\n- Kiểm tra sự tồn tại của `DiaChiModel` khi tạo/cập nhật.\n- Xử lý việc xóa (kiểm tra tham chiếu từ Đơn hàng, Khách hàng, etc.).\n\n### 4.4. Mô Hình Dữ Liệu\n\n#### 4.4.1. Entity Relationship Diagram (ERD)\n\n```mermaid\nerDiagram\n    ENTITY ||--|{ DIA_CHI : \"quản lý\"\n    ENTITY ||--|{ DIA_CHI_NHAN_HANG : \"quản lý\"\n\n    DIA_CHI ||--o{ DIA_CHI_NHAN_HANG : \"là cơ sở cho\"\n\n    KHACH_HANG {\n        uuid uuid PK\n        string ten_kh\n        \u003cem\u003e(các trường khác)\u003c/em\u003e\n    }\n    KHACH_HANG ||--o{ DIA_CHI_NHAN_HANG : \"có nhiều địa chỉ nhận hàng\"\n    \n    DON_HANG_BAN {\n        uuid uuid PK\n        string ma_don_hang\n        uuid dia_chi_giao_hang_id FK \"Thông tin địa chỉ giao hàng\"\n        \u003cem\u003e(các trường khác)\u003c/em\u003e\n    }\n    DON_HANG_BAN }o--|| DIA_CHI_NHAN_HANG : \"giao tới\"\n\n\n    ENTITY {\n        uuid uuid PK\n        string slug\n        string name\n        \u003cem\u003e(các trường khác)\u003c/em\u003e\n    }\n\n    DIA_CHI {\n        uuid uuid PK\n        string dia_chi_day_du\n        uuid xa_phuong_id FK\n        \u003cem\u003e(các trường khác của Địa Chỉ)\u003c/em\u003e\n    }\n\n    DIA_CHI_NHAN_HANG {\n        uuid uuid PK\n        string ten_nguoi_nhan\n        string so_dien_thoai_nguoi_nhan\n        string email_nguoi_nhan\n        string ten_goi_nho_dia_chi\n        text huong_dan_giao_hang\n        integer status\n        datetime created\n        datetime updated\n        uuid entity_id FK \"Khóa ngoại tới ENTITY\"\n        uuid dia_chi_id FK \"Khóa ngoại tới DIA_CHI (Địa chỉ cơ sở)\"\n    }\n```\n*Lưu ý: Mối quan hệ từ `KHACH_HANG` và `DON_HANG_BAN` tới `DIA_CHI_NHAN_HANG` là ví dụ. `DIA_CHI_NHAN_HANG` có thể được liên kết bởi nhiều đối tượng khác nhau cần thông tin giao nhận.*\n\n#### 4.4.2. Chi Tiết Bảng Dữ Liệu\n\n##### Bảng: `DiaChiNhanHangModel` (django_ledger_diachinhanhangmodel)\n- **Mô tả**: Lưu trữ thông tin chi tiết cho việc nhận/giao hàng, liên kết với một địa chỉ cơ sở.\n- **Các cột chính**:\n    - `uuid` (UUID, Khóa chính).\n    - `dia_chi` (ForeignKey đến `DiaChiModel`, on_delete=models.PROTECT).\n    - `entity_model` (ForeignKey đến `EntityModel`).\n    - `ten_nguoi_nhan` (CharField, max_length=255).\n    - `so_dien_thoai_nguoi_nhan` (CharField, max_length=20).\n    - `email_nguoi_nhan` (EmailField, max_length=255, null=True, blank=True).\n    - `ten_goi_nho_dia_chi` (CharField, max_length=255, null=True, blank=True).\n    - `huong_dan_giao_hang` (TextField, null=True, blank=True).\n    - `status` (IntegerField, default=1).\n    - `created` (DateTimeField, auto_now_add=True).\n    - `updated` (DateTimeField, auto_now=True).\n- **Indexes**:\n    - Index trên (`entity_model`, `dia_chi`).\n    - Index trên (`entity_model`, `ten_nguoi_nhan`).\n\n## 5. Kế Hoạch Kiểm Thử\n\n### 5.1. Phạm Vi Kiểm Thử\n- CRUD cho Thông Tin Địa Chỉ Nhận Hàng.\n- Liên kết chính xác với `DiaChiModel`.\n- Validation dữ liệu.\n- Xử lý xóa và kiểm tra tham chiếu.\n\n### 5.2. Kịch Bản Kiểm Thử (Ví dụ)\n\n| STT | Mã kịch bản | Tên kịch bản | Mô tả | Điều kiện tiên quyết | Các bước | Kết quả mong đợi |\n|-----|------------|--------------|-------|---------------------|----------|-----------------|\n| 1   | GEO_007_TC01 | Thêm mới thông tin địa chỉ nhận hàng thành công | Kiểm tra thêm mới với dữ liệu hợp lệ. | User đăng nhập, có quyền. Entity \"E1\", Địa chỉ cơ sở \"DC1\" (uuid_dc1) tồn tại. | 1. POST `/api/E1/dia-chi-nhan-hang/`. 2. Payload: `{\"dia_chi_uuid\": \"uuid_dc1\", \"ten_nguoi_nhan\": \"Chị Lan\", \"so_dien_thoai_nguoi_nhan\": \"0909123456\", \"ten_goi_nho_dia_chi\": \"Văn phòng Q1\"}`. | 1. HTTP 201. 2. Dữ liệu được trả về. 3. Bản ghi được lưu vào CSDL. |\n| 2   | GEO_007_TC02 | Thêm mới với địa chỉ cơ sở không tồn tại | Kiểm tra thêm mới với `dia_chi_uuid` không tồn tại. | Như TC01. `invalid_uuid_dc` không tồn tại. | 1. POST `/api/E1/dia-chi-nhan-hang/`. 2. Payload: `{\"dia_chi_uuid\": \"invalid_uuid_dc\", ...}`. | 1. HTTP 400. 2. Lỗi \"Base Address not found\". |\n| 3   | GEO_007_TC03 | Cập nhật thông tin | Thay đổi SĐT người nhận. | Bản ghi \"DCNH1\" (uuid_dcnh1) tồn tại. | 1. PATCH `/api/E1/dia-chi-nhan-hang/uuid_dcnh1/`. 2. Payload: `{\"so_dien_thoai_nguoi_nhan\": \"0987654321\"}`. | 1. HTTP 200. 2. SĐT được cập nhật. |\n| 4   | GEO_007_TC04 | Xóa thông tin đang được sử dụng | Cố gắng xóa \"DCNH1\" đang được một Đơn hàng \"DH001\" sử dụng. | \"DCNH1\" được \"DH001\" tham chiếu. | 1. DELETE `/api/E1/dia-chi-nhan-hang/uuid_dcnh1/`. | 1. HTTP 400 (hoặc 200 nếu xóa logic). 2. Thông báo lỗi \"Shipping Address Info is in use\" hoặc trạng thái được cập nhật. |\n\n## 6. Phụ Lục\n\n### 6.1. Danh Sách Tài Liệu Tham Khảo\n- Mã nguồn Django Ledger: `django_ledger/services/dia_chi_nhan_hang/dia_chi_nhan_hang.py` (dự kiến)\n- Mã nguồn Django Ledger: `django_ledger/repositories/dia_chi_nhan_hang/dia_chi_nhan_hang.py` (dự kiến)\n- Mã nguồn Django Ledger: `django_ledger/models/dia_chi_nhan_hang.py` (dự kiến)\n\n### 6.2. Danh Mục Thuật Ngữ\n(Đã định nghĩa ở mục 1.3)\n\n### 6.3. Lịch Sử Thay Đổi Tài Liệu\n\n| Phiên bản | Ngày | Người thực hiện | Mô tả thay đổi |\n|-----------|------|-----------------|---------------|\n| 1.0 | 13/05/2025 | Cline | Tạo mới tài liệu. |\n"])</script><script>self.__next_f.push([1,"9:[\"slug\",\"erp/GEO_007_Quan_Ly_Dia_Chi_Nhan_Hang\",\"c\"]\nf:[]\n"])</script><script>self.__next_f.push([1,"0:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/erp-docs/_next/static/css/4b73dfd0f7bdc629.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"$L3\",null,{\"buildId\":\"X5KF-BjlTdL2YCafX7ACW\",\"assetPrefix\":\"/erp-docs\",\"initialCanonicalUrl\":\"/erp/GEO_007_Quan_Ly_Dia_Chi_Nhan_Hang/\",\"initialTree\":[\"\",{\"children\":[[\"slug\",\"erp/GEO_007_Quan_Ly_Dia_Chi_Nhan_Hang\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"erp\\\",\\\"GEO_007_Quan_Ly_Dia_Chi_Nhan_Hang\\\"]}\",{}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[[\"slug\",\"erp/GEO_007_Quan_Ly_Dia_Chi_Nhan_Hang\",\"c\"],{\"children\":[\"__PAGE__\",{},[[\"$L4\",[\"$\",\"$L5\",null,{\"children\":[\"$\",\"article\",null,{\"className\":\"prose prose-slate dark:prose-invert max-w-none\",\"children\":[[\"$\",\"header\",null,{\"className\":\"mb-8\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"mb-2\",\"children\":\"$undefined\"}],\"$undefined\",\"$undefined\"]}],[\"$\",\"$L6\",null,{\"content\":\"$7\"}]]}]}]],null],null]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$9\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}],null]},[[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[\"$\",\"body\",null,{\"className\":\"__className_985585\",\"children\":[\"$\",\"$Lb\",null,{\"attribute\":\"class\",\"defaultTheme\":\"system\",\"enableSystem\":true,\"disableTransitionOnChange\":true,\"children\":[\"$\",\"$Lc\",null,{\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"styles\":null}]}]}]}]}],null],null],\"couldBeIntercepted\":false,\"initialHead\":[false,\"$Ld\"],\"globalErrorComponent\":\"$e\",\"missingSlots\":\"$Wf\"}]]\n"])</script><script>self.__next_f.push([1,"d:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"undefined | ERP Documentation\"}],[\"$\",\"meta\",\"3\",{\"name\":\"keywords\",\"content\":\"documentation,ERP,technical,mermaid,markdown\"}],[\"$\",\"meta\",\"4\",{\"name\":\"next-size-adjust\"}]]\n4:null\n"])</script></body></html>