<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/erp-docs/_next/static/media/e4af272ccee01ff0-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/erp-docs/_next/static/css/4b73dfd0f7bdc629.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/erp-docs/_next/static/chunks/webpack-39532e8569213db6.js"/><script src="/erp-docs/_next/static/chunks/7384d974-8b753aa07a0575a2.js" async=""></script><script src="/erp-docs/_next/static/chunks/381-1b6d0728bba7b8e7.js" async=""></script><script src="/erp-docs/_next/static/chunks/main-app-5d87a2fd0f4f2f33.js" async=""></script><script src="/erp-docs/_next/static/chunks/d550ec10-485e3f71f5def856.js" async=""></script><script src="/erp-docs/_next/static/chunks/993-1b6a71072be86da4.js" async=""></script><script src="/erp-docs/_next/static/chunks/410-1ece2fcedd156d2f.js" async=""></script><script src="/erp-docs/_next/static/chunks/app/%5B...slug%5D/page-7978846c0e32abf5.js" async=""></script><script src="/erp-docs/_next/static/chunks/app/layout-b6ef60bec0ff2cf2.js" async=""></script><title>undefined | ERP Documentation</title><meta name="keywords" content="documentation,ERP,technical,mermaid,markdown"/><meta name="next-size-adjust"/><script src="/erp-docs/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="__className_985585"><div class="min-h-screen flex items-center justify-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div><script src="/erp-docs/_next/static/chunks/webpack-39532e8569213db6.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/erp-docs/_next/static/media/e4af272ccee01ff0-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/erp-docs/_next/static/css/4b73dfd0f7bdc629.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"3:I[5214,[],\"\"]\n5:I[3040,[\"135\",\"static/chunks/d550ec10-485e3f71f5def856.js\",\"993\",\"static/chunks/993-1b6a71072be86da4.js\",\"410\",\"static/chunks/410-1ece2fcedd156d2f.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-7978846c0e32abf5.js\"],\"DocLayout\"]\n6:I[1276,[\"135\",\"static/chunks/d550ec10-485e3f71f5def856.js\",\"993\",\"static/chunks/993-1b6a71072be86da4.js\",\"410\",\"static/chunks/410-1ece2fcedd156d2f.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-7978846c0e32abf5.js\"],\"MDXContent\"]\n8:I[6472,[],\"\"]\na:I[9190,[],\"\"]\nb:I[4550,[\"185\",\"static/chunks/app/layout-b6ef60bec0ff2cf2.js\"],\"ThemeProvider\"]\nc:I[8910,[\"185\",\"static/chunks/app/layout-b6ef60bec0ff2cf2.js\"],\"AuthProvider\"]\ne:I[3013,[],\"\"]\n7:T5546,"])</script><script>self.__next_f.push([1,"# TRN_001_Transportation_Quản Lý Phương Tiện Vận Chuyển\n\n*Phiên bản: 1.0*\n*Người tạo: Gemini AI Assistant*\n*Ngày tạo: 2024-07-31*\n*Cập nhật lần cuối: 2024-07-31*\n*Người cập nhật: Gemini AI Assistant*\n\n## 1. Tổng Quan Nghiệp Vụ\n\n### 1.1. Mô Tả Nghiệp Vụ\nNghiệp vụ Quản Lý Phương Tiện Vận Chuyển (trong mã nguồn là `PhuongTienVanChuyenModel`, còn được gọi là Shipping Method) cho phép người dùng định nghĩa và quản lý các phương thức vận chuyển hàng hóa cho đơn hàng và giao nhận. Các phương thức này có thể bao gồm vận chuyển đường hàng không, đường biển, đường bộ, v.v. Mỗi phương tiện vận chuyển được xác định bởi một mã, tên, trạng thái (hoạt động/không hoạt động) và thuộc về một Đơn vị (Entity) cụ thể trong hệ thống. Mục đích là cung cấp một danh mục chuẩn hóa các phương tiện vận chuyển để sử dụng trong các quy trình liên quan đến đơn hàng, giao nhận và tính toán chi phí vận chuyển.\n\n### 1.2. Phạm Vi Áp Dụng\n- Áp dụng cho từng Đơn vị (Entity) trong hệ thống.\n- Các bộ phận liên quan đến quản lý đơn hàng, kho vận, giao nhận, kế toán chi phí.\n\n### 1.3. Định Nghĩa Thuật Ngữ\n| Thuật ngữ | Định nghĩa |\n|-----------|------------|\n| Phương Tiện Vận Chuyển (PTVC) | Một phương thức vận chuyển được định nghĩa trong hệ thống (ví dụ: đường bộ, đường hàng không). Trong mã nguồn là `PhuongTienVanChuyenModel`. |\n| Đơn vị (Entity) | Tổ chức hoặc công ty mà PTVC được định nghĩa và áp dụng. |\n| `ma_ptvc` | Mã định danh duy nhất cho một PTVC trong một đơn vị (tối đa 10 ký tự). |\n| `ten_ptvc` | Tên mô tả chính của PTVC. |\n| `ten_ptvc2` | Tên mô tả phụ/thay thế của PTVC (tùy chọn). |\n| `status` | Trạng thái của PTVC: '1' (Active - Hoạt động), '0' (Inactive - Không hoạt động). |\n| `entity_model` | Đối tượng Đơn vị (Entity) mà PTVC này trực thuộc. |\n| UUID | Định danh duy nhất toàn cục cho mỗi bản ghi PTVC. |\n\n### 1.4. Tài Liệu Liên Quan\n| STT | Mã tài liệu | Tên tài liệu | Mô tả |\n|-----|-------------|--------------|-------|\n| 1   | `django_ledger/models/phuong_tien_van_chuyen.py` | Model Định Nghĩa PTVC | Định nghĩa cấu trúc dữ liệu cho `PhuongTienVanChuyenModel`. |\n| 2   | `django_ledger/api/views/phuong_tien_van_chuyen.py` | API Endpoints PTVC | Các điểm cuối API để tương tác với nghiệp vụ Quản Lý PTVC. |\n| 3   | `django_ledger/api/serializers/phuong_tien_van_chuyen.py` | Serializers PTVC | Định dạng dữ liệu JSON cho API, thực hiện validation. |\n| 4   | `django_ledger/services/phuong_tien_van_chuyen/phuong_tien_van_chuyen.py` | Service Logic PTVC | Logic nghiệp vụ cho việc tạo, cập nhật, xóa, truy vấn PTVC. |\n| 5   | `django_ledger/repositories/phuong_tien_van_chuyen/phuong_tien_van_chuyen.py` | Repository PTVC | Lớp truy cập dữ liệu cho PTVC. |\n| 6   | `django_ledger/api/urls.py` | URL Configuration | Đăng ký endpoint `/api/{entity_slug}/shipping-methods/` cho PTVC. |\n| 7   | `django_ledger/models/ban_hang/hoa_don_ban_ra/hoa_don_ban_hang/hoa_don_ban_hang.py` | Hóa Đơn Bán Hàng Model | Sử dụng `PhuongTienVanChuyenModel` làm ForeignKey (`ma_ptvc`). |\n\n## 2. Quy Trình Nghiệp Vụ\n\n### 2.1. Tổng Quan Quy Trình\nNgười dùng có thẩm quyền (ví dụ: quản trị viên, nhân viên kho vận) tương tác với hệ thống thông qua giao diện người dùng hoặc API để thực hiện các thao tác CRUD (Create, Read, Update, Delete) đối với các Phương Tiện Vận Chuyển. Hệ thống sẽ xử lý các yêu cầu này thông qua `PhuongTienVanChuyenModelViewSet`, sử dụng `PhuongTienVanChuyenModelService` để thực thi logic nghiệp vụ và `PhuongTienVanChuyenRepository` để tương tác với cơ sở dữ liệu. Dữ liệu đầu vào sẽ được kiểm tra (validate) bởi `PhuongTienVanChuyenModelSerializer` và `PhuongTienVanChuyenModelService`.\n\n### 2.2. Sơ Đồ Quy Trình (Business Flow)\n\n```mermaid\nflowchart TD\n    A[Người dùng yêu cầu thao tác PTVC] --\u003e B{API Gateway nhận yêu cầu};\n    B --\u003e C[Xác thực \u0026 Ủy quyền (IsAuthenticated)];\n    C --\u003e D[PhuongTienVanChuyenModelViewSet];\n    D --\u003e E[PhuongTienVanChuyenModelService];\n    E --\u003e F[PhuongTienVanChuyenRepository];\n    F --\u003e G[(Cơ sở dữ liệu - Bảng ptvc)];\n    G --\u003e F;\n    F --\u003e E;\n    E --\u003e D;\n    subgraph \"Validation\"\n        direction LR\n        H[Request Data] --\u003e I[PhuongTienVanChuyenModelSerializer];\n        I --\u003e J[PhuongTienVanChuyenModelService.validate_phuong_tien_van_chuyen_data];\n    end\n    D --\u003e H;\n    J -- Dữ liệu hợp lệ --\u003e E;\n    J -- Dữ liệu không hợp lệ --\u003e K[Báo lỗi cho ViewSet];\n    K --\u003e B;\n    D --\u003e L[Trả kết quả cho người dùng];\n    B --\u003e L;\n```\n\n### 2.3. Chi Tiết Các Bước Quy Trình\n\n#### 2.3.1. Tạo Mới Phương Tiện Vận Chuyển\n- **Mô tả**: Người dùng cung cấp thông tin để tạo một PTVC mới cho một Đơn vị.\n- **Đầu vào**: Dữ liệu PTVC (`ma_ptvc`, `ten_ptvc`, `ten_ptvc2` (tùy chọn), `status` (tùy chọn, mặc định '1')). `entity_slug` được lấy từ URL.\n- **Đầu ra**: PTVC mới được tạo thành công hoặc thông báo lỗi.\n- **Người thực hiện**: Quản trị viên, nhân viên kho vận.\n- **Điều kiện tiên quyết**: Đăng nhập hệ thống, có quyền truy cập vào Đơn vị. `ma_ptvc` phải là duy nhất trong Đơn vị đó. `ma_ptvc` và `ten_ptvc` là bắt buộc.\n- **Xử lý ngoại lệ**: Dữ liệu không hợp lệ (thiếu trường, sai định dạng, `ma_ptvc` quá dài hoặc trùng), Đơn vị không tồn tại.\n\n#### 2.3.2. Xem/Tìm Kiếm Phương Tiện Vận Chuyển\n- **Mô tả**: Người dùng xem danh sách các PTVC của một Đơn vị hoặc chi tiết một PTVC cụ thể. Hỗ trợ lọc theo trạng thái (`status`) và phân trang.\n- **Đầu vào**: `entity_slug` (từ URL). Tùy chọn: `uuid` của PTVC (để xem chi tiết), `status` (để lọc danh sách), tham số phân trang (`page`, `page_size`).\n- **Đầu ra**: Danh sách các PTVC hoặc thông tin chi tiết của một PTVC.\n- **Người thực hiện**: Mọi người dùng có quyền xem.\n- **Điều kiện tiên quyết**: Đăng nhập hệ thống.\n- **Xử lý ngoại lệ**: PTVC không tồn tại, Đơn vị không tồn tại.\n\n#### 2.3.3. Cập Nhật Phương Tiện Vận Chuyển\n- **Mô tả**: Người dùng thay đổi thông tin của một PTVC đã tồn tại.\n- **Đầu vào**: `entity_slug`, `uuid` của PTVC, và dữ liệu cần cập nhật (`ma_ptvc`, `ten_ptvc`, `ten_ptvc2`, `status`).\n- **Đầu ra**: PTVC được cập nhật thành công hoặc thông báo lỗi.\n- **Người thực hiện**: Quản trị viên, nhân viên kho vận.\n- **Điều kiện tiên quyết**: Đăng nhập, PTVC phải tồn tại và thuộc Đơn vị chỉ định. Nếu `ma_ptvc` thay đổi, mã mới không được trùng.\n- **Xử lý ngoại lệ**: Dữ liệu không hợp lệ, PTVC không tồn tại, `ma_ptvc` mới bị trùng.\n\n#### 2.3.4. Xóa Phương Tiện Vận Chuyển\n- **Mô tả**: Người dùng xóa một PTVC khỏi hệ thống.\n- **Đầu vào**: `entity_slug`, `uuid` của PTVC.\n- **Đầu ra**: Thông báo xóa thành công (HTTP 204) hoặc lỗi.\n- **Người thực hiện**: Quản trị viên, nhân viên kho vận.\n- **Điều kiện tiên quyết**: Đăng nhập, PTVC phải tồn tại và thuộc Đơn vị chỉ định. (Cần xem xét ràng buộc nếu PTVC đang được sử dụng trong các Hóa đơn bán hàng).\n- **Xử lý ngoại lệ**: PTVC không tồn tại.\n\n### 2.4. Sơ Đồ Tuần Tự (Sequence Diagram) - Tạo mới Phương Tiện Vận Chuyển\n\n```mermaid\nsequenceDiagram\n    participant User\n    participant APIView as PhuongTienVanChuyenModelViewSet\n    participant Service as PhuongTienVanChuyenModelService\n    participant Serializer as PhuongTienVanChuyenModelSerializer\n    participant Repository as PhuongTienVanChuyenRepository\n    participant Model as PhuongTienVanChuyenModel\n    participant DB as Database\n\n    User-\u003e\u003eAPIView: POST /api/{entity_slug}/shipping-methods/ (data)\n    APIView-\u003e\u003eService: get_service()\n    Service--\u003e\u003eAPIView: service_instance\n    APIView-\u003e\u003eService: create_phuong_tien_van_chuyen(entity_slug, data)\n    Service-\u003e\u003eService: _get_entity_model(entity_slug)\n    Service--\u003e\u003eService: entity_model\n    Service-\u003e\u003eService: validate_phuong_tien_van_chuyen_data(data)\n    alt Dữ liệu không hợp lệ (Service validation)\n        Service--\u003e\u003eAPIView: Raise ValueError\n        APIView--\u003e\u003eUser: HTTP 400 (Error details)\n    else Dữ liệu hợp lệ\n        Service--\u003e\u003eService: validated_data\n        Service-\u003e\u003eRepository: create_phuong_tien_van_chuyen(validated_data, entity_model)\n        Repository-\u003e\u003eModel: objects.create(entity_model=entity_model, **validated_data)\n        Model-\u003e\u003eDB: INSERT INTO ptvc\n        DB--\u003e\u003eModel: created_ptvc_instance\n        Model--\u003e\u003eRepository: created_ptvc_instance\n        Repository--\u003e\u003eService: created_ptvc_instance\n        Service--\u003e\u003eAPIView: created_ptvc_instance\n        APIView-\u003e\u003eSerializer: get_serializer(created_ptvc_instance)\n        Serializer--\u003e\u003eAPIView: serialized_data\n        APIView--\u003e\u003eUser: HTTP 201 (serialized_data)\n    end\n```\n\n### 2.5. Luồng Nghiệp Vụ Thay Thế\n- **Validation ở Serializer**: `PhuongTienVanChuyenModelSerializer` cũng thực hiện validation cho `ma_ptvc` (không trống, không quá 10 ký tự) và `ten_ptvc` (không trống). Nếu validation này thất bại ở ViewSet trước khi gọi Service, lỗi cũng sẽ được trả về.\n- **Kiểm tra quyền**: `EntityRelatedViewSet` và `PhuongTienVanChuyenModelQueryset.for_entity` đảm bảo người dùng chỉ có thể thao tác trên các PTVC thuộc các Đơn vị mà họ có quyền truy cập.\n\n## 3. Yêu Cầu Chức Năng\n\n### 3.1. Danh Sách Chức Năng\n\n| STT | Mã chức năng | Tên chức năng | Mô tả | Độ ưu tiên |\n|-----|--------------|---------------|-------|------------|\n| 1   | TRN001-PTVC-LIST | Xem danh sách PTVC | Lấy danh sách PTVC theo Đơn vị, hỗ trợ lọc theo `status`, phân trang. | Cao |\n| 2   | TRN001-PTVC-CREATE | Tạo mới PTVC | Tạo một PTVC mới cho một Đơn vị. | Cao |\n| 3   | TRN001-PTVC-RETRIEVE | Xem chi tiết PTVC | Lấy thông tin chi tiết của một PTVC bằng UUID. | Cao |\n| 4   | TRN001-PTVC-UPDATE | Cập nhật PTVC | Cập nhật thông tin của một PTVC đã có (PUT). | Cao |\n| 5   | TRN001-PTVC-PARTIAL-UPDATE | Cập nhật một phần PTVC | Cập nhật một phần thông tin của một PTVC đã có (PATCH). | Cao |\n| 6   | TRN001-PTVC-DELETE | Xóa PTVC | Xóa một PTVC. | Cao |\n\n### 3.2. Chi Tiết Chức Năng\n\n#### 3.2.1. TRN001-PTVC-CREATE: Tạo mới Phương Tiện Vận Chuyển\n- **Mô tả**: Cho phép tạo một PTVC mới.\n- **Đầu vào**: `entity_slug` (trong URL). Dữ liệu JSON body: `ma_ptvc` (string, bắt buộc, max 10), `ten_ptvc` (string, bắt buộc), `ten_ptvc2` (string, tùy chọn), `status` (string '0' hoặc '1', tùy chọn, default '1').\n- **Đầu ra**: Dữ liệu JSON của PTVC vừa tạo.\n- **Điều kiện tiên quyết**: `ma_ptvc`, `ten_ptvc` phải được cung cấp. `ma_ptvc` phải là duy nhất cho `entity_model`.\n- **Luồng xử lý chính**:\n  1. `PhuongTienVanChuyenModelViewSet.create()` nhận request.\n  2. Lấy `service` instance.\n  3. Gọi `service.create_phuong_tien_van_chuyen(entity_slug, request.data)`.\n     a. Service lấy `entity_model` từ `entity_slug`.\n     b. Service gọi `validate_phuong_tien_van_chuyen_data()`: kiểm tra `ma_ptvc`, `ten_ptvc` bắt buộc, `ma_ptvc` không quá 10 ký tự, `status` hợp lệ.\n     c. Service gọi `repository.create_phuong_tien_van_chuyen()` với `validated_data` và `entity_model`.\n     d. Repository tạo bản ghi `PhuongTienVanChuyenModel` trong DB.\n  4. Serialize instance mới tạo và trả về HTTP 201.\n- **Luồng xử lý thay thế/ngoại lệ**:\n  - Validation thất bại (Serializer hoặc Service): Trả về HTTP 400 với chi tiết lỗi.\n  - `entity_slug` không hợp lệ: `_get_entity_model` trong service sẽ raise Http404 (hoặc tương đương).\n  - `unique_together` (`entity_model`, `ma_ptvc`) bị vi phạm ở DB: Django sẽ raise IntegrityError, cần được bắt và xử lý phù hợp (thường DRF xử lý và trả 400).\n- **Giao diện liên quan**: Form tạo mới PTVC.\n\n*(Các chức năng LIST, RETRIEVE, UPDATE, PARTIAL_UPDATE, DELETE được cung cấp bởi `PhuongTienVanChuyenModelViewSet` kế thừa từ `EntityRelatedViewSet`, sử dụng service và repository tương ứng. `list` có thêm logic lọc theo `status`.)*\n\n## 4. Thiết Kế Kỹ Thuật\n\n### 4.1. Kiến Trúc Hệ Thống\nNghiệp vụ này tuân theo kiến trúc 3 lớp với sự hỗ trợ của Repository pattern:\n- **View (API Layer)**: `PhuongTienVanChuyenModelViewSet` xử lý HTTP request/response, xác thực, phân trang, và gọi các services.\n- **Service Layer**: `PhuongTienVanChuyenModelService` chứa logic nghiệp vụ chính, điều phối hoạt động giữa View và Repository, thực hiện validation nghiệp vụ.\n- **Repository Layer**: `PhuongTienVanChuyenRepository` chịu trách nhiệm tương tác trực tiếp với cơ sở dữ liệu thông qua Django ORM (`PhuongTienVanChuyenModel`).\n- **Model Layer**: `PhuongTienVanChuyenModel` định nghĩa cấu trúc dữ liệu, bao gồm các trường, ràng buộc và custom manager/queryset.\n\n```mermaid\ngraph TD\n    Client --\u003e Nginx --\u003e Gunicorn\n    Gunicorn --\u003e DjangoApp[Django Application]\n\n    subgraph DjangoApp\n        APILayer[API Layer: PhuongTienVanChuyenModelViewSet]\n        ServiceLayer[Service Layer: PhuongTienVanChuyenModelService]\n        RepositoryLayer[Repository Layer: PhuongTienVanChuyenRepository]\n        ModelLayer[Model Layer: PhuongTienVanChuyenModel]\n        Database[(PostgreSQL Database - ptvc table)]\n\n        APILayer --\u003e|calls| ServiceLayer\n        ServiceLayer --\u003e|uses| RepositoryLayer\n        RepositoryLayer --\u003e|accesses| ModelLayer\n        ModelLayer --\u003e|maps to| Database\n    end\n```\n\n### 4.2. API Endpoints\n\n#### 4.2.1. Phương Tiện Vận Chuyển (`PhuongTienVanChuyenModel`)\n- **Mô tả**: Quản lý các phương tiện vận chuyển.\n- **Base URL**: `/api/{entity_slug}/shipping-methods/`\n- **Endpoints**:\n  - `GET /`: Lấy danh sách PTVC (hỗ trợ lọc theo `status`, phân trang `ERPPagination`).\n    - Query params: `status` (0 hoặc 1), `page`, `page_size`.\n  - `POST /`: Tạo một PTVC mới.\n  - `GET /{uuid}/`: Lấy chi tiết một PTVC.\n  - `PUT /{uuid}/`: Cập nhật toàn bộ một PTVC.\n  - `PATCH /{uuid}/`: Cập nhật một phần một PTVC.\n  - `DELETE /{uuid}/`: Xóa một PTVC.\n\n### 4.3. Service Logic (`PhuongTienVanChuyenModelService`)\n- **Mô tả**: Cung cấp logic nghiệp vụ cho `PhuongTienVanChuyenModel`.\n- **Chức năng chính**:\n  1. `_get_entity_model(entity_slug)`: Lấy `EntityModel` từ slug.\n  2. `validate_phuong_tien_van_chuyen_data(data)`: Kiểm tra các trường bắt buộc (`ma_ptvc`, `ten_ptvc`), độ dài `ma_ptvc`, giá trị `status`.\n  3. `get_all_phuong_tien_van_chuyen(entity_slug, user_model)`: Lấy tất cả PTVC cho entity.\n  4. `get_phuong_tien_van_chuyen(entity_slug, uuid)`: Lấy PTVC cụ thể, kiểm tra có thuộc entity không.\n  5. `create_phuong_tien_van_chuyen(entity_slug, data)`:\n     - Lấy `entity_model`.\n     - Validate dữ liệu.\n     - Gọi `repository.create_phuong_tien_van_chuyen()`.\n  6. `update_phuong_tien_van_chuyen(entity_slug, uuid, data)`:\n     - Lấy `entity_model`.\n     - Validate dữ liệu.\n     - Kiểm tra PTVC tồn tại và thuộc entity.\n     - Gọi `repository.update_phuong_tien_van_chuyen()`.\n  7. `delete_phuong_tien_van_chuyen(entity_slug, uuid)`:\n     - Kiểm tra PTVC tồn tại và thuộc entity.\n     - Gọi `repository.delete_phuong_tien_van_chuyen()`.\n- **Các dependencies**: `PhuongTienVanChuyenRepository`, `EntityModel`.\n\n### 4.4. Mô Hình Dữ Liệu\n\n#### 4.4.1. Entity Relationship Diagram (ERD)\n\n```mermaid\nerDiagram\n    EntityModel ||--o{ PhuongTienVanChuyenModel : \"has\"\n    PhuongTienVanChuyenModel }o--|| HoaDonBanHangModel : \"can be used in\"\n\n    EntityModel {\n        UUID uuid PK\n        string slug\n        string name\n        # ... other fields\n    }\n\n    PhuongTienVanChuyenModel {\n        UUID uuid PK\n        UUID entity_model_id FK\n        string ma_ptvc \"Mã PTVC (unique per entity, max 10)\"\n        string ten_ptvc \"Tên PTVC\"\n        string ten_ptvc2 \"Tên PTVC (phụ)\"\n        string status \"Trạng thái ('1' Active, '0' Inactive)\"\n        datetime created\n        datetime updated\n    }\n\n    HoaDonBanHangModel {\n        UUID uuid PK\n        # ... other fields\n        UUID ma_ptvc_id FK \"FK to PhuongTienVanChuyenModel\"\n    }\n```\n\n#### 4.4.2. Chi Tiết Bảng Dữ Liệu\n\n##### Bảng: `ptvc` (mapped from `PhuongTienVanChuyenModel`)\n- **Mô tả**: Lưu trữ thông tin các phương tiện vận chuyển.\n- **Các cột chính**:\n  - `uuid` (PK, UUIDField): Định danh duy nhất.\n  - `entity_model_id` (FK, UUIDField): Liên kết đến bảng `entity`.\n  - `ma_ptvc` (CharField(10)): Mã phương tiện vận chuyển, duy nhất trong phạm vi `entity_model`.\n  - `ten_ptvc` (CharField(255)): Tên phương tiện vận chuyển.\n  - `ten_ptvc2` (CharField(255), nullable): Tên thay thế.\n  - `status` (CharField(1), default '1'): Trạng thái ('1' = Active, '0' = Inactive).\n  - `created` (DateTimeField): Thời điểm tạo.\n  - `updated` (DateTimeField): Thời điểm cập nhật cuối.\n- **Indexes**: (`entity_model`, `ma_ptvc`), (`ma_ptvc`), (`status`).\n- **Unique Together**: (`entity_model`, `ma_ptvc`).\n\n## 5. Kế Hoạch Kiểm Thử\n\n### 5.1. Phạm Vi Kiểm Thử\n- Kiểm thử các chức năng CRUD cho PTVC qua API endpoints.\n- Kiểm thử validation dữ liệu đầu vào (trường bắt buộc, độ dài, giá trị hợp lệ, tính duy nhất của `ma_ptvc`).\n- Kiểm thử logic phân quyền (người dùng chỉ thao tác được PTVC của Entity mình có quyền).\n- Kiểm thử API endpoints (status codes, response format, pagination, filtering theo `status`).\n- Kiểm thử ràng buộc khi PTVC được sử dụng (ví dụ: trong Hóa đơn bán hàng - nếu có).\n\n### 5.2. Kịch Bản Kiểm Thử\n| STT | Mã kịch bản | Tên kịch bản | Mô tả | Điều kiện tiên quyết | Các bước | Kết quả mong đợi |\n|-----|------------|--------------|-------|---------------------|----------|-----------------|\n| 1   | TC_TRN001_001 | Tạo PTVC thành công | Kiểm tra tạo mới PTVC với dữ liệu hợp lệ. | User đăng nhập, có quyền. `entity_slug` hợp lệ. | 1. Gửi POST request tới `/api/{entity_slug}/shipping-methods/` với data (`ma_ptvc`, `ten_ptvc`) hợp lệ. | 1. Response status 201. 2. Response body chứa thông tin PTVC đã tạo. 3. Dữ liệu được lưu đúng trong DB. |\n| 2   | TC_TRN001_002 | Tạo PTVC thất bại - `ma_ptvc` trùng | Kiểm tra không cho tạo PTVC nếu `ma_ptvc` đã tồn tại cho entity. | User đăng nhập. `ma_ptvc` đã tồn tại cho entity. | 1. Gửi POST request với `ma_ptvc` đã có. | 1. Response status 400. 2. Thông báo lỗi về `ma_ptvc` bị trùng hoặc lỗi validation từ service. |\n| 3   | TC_TRN001_003 | Tạo PTVC thất bại - thiếu `ten_ptvc` | Kiểm tra lỗi khi thiếu trường `ten_ptvc`. | User đăng nhập. | 1. Gửi POST request chỉ có `ma_ptvc`. | 1. Response status 400. 2. Thông báo lỗi trường `ten_ptvc` là bắt buộc. |\n| 4   | TC_TRN001_004 | Lấy danh sách PTVC | Kiểm tra lấy danh sách PTVC, có phân trang và lọc theo `status`. | Có sẵn vài PTVC với status khác nhau. | 1. Gửi GET request tới `/api/{entity_slug}/shipping-methods/?page=1\u0026page_size=2\u0026status=1`. | 1. Response status 200. 2. Response body chứa danh sách PTVC (tối đa 2), status='1', thông tin phân trang. |\n| 5   | TC_TRN001_005 | Cập nhật PTVC | Kiểm tra cập nhật thông tin PTVC. | PTVC tồn tại. | 1. Gửi PUT request tới `/api/{entity_slug}/shipping-methods/{uuid}/` với data mới. | 1. Response status 200. 2. Dữ liệu PTVC được cập nhật trong DB. |\n| 6   | TC_TRN001_006 | Xóa PTVC | Kiểm tra xóa PTVC. | PTVC tồn tại. | 1. Gửi DELETE request tới `/api/{entity_slug}/shipping-methods/{uuid}/`. | 1. Response status 204. 2. PTVC bị xóa khỏi DB. |\n\n## 6. Phụ Lục\n\n### 6.1. Danh Sách Tài Liệu Tham Khảo\n- Mã nguồn dự án ERP-BE (các file đã liệt kê ở mục 1.4).\n- Tài liệu Django REST framework.\n- Tài liệu drf-spectacular (nếu dùng cho schema generation).\n\n### 6.2. Danh Mục Thuật Ngữ\n(Xem mục 1.3)\n\n### 6.3. Lịch Sử Thay Đổi Tài Liệu\n| Phiên bản | Ngày       | Người thực hiện      | Mô tả thay đổi                         |\n|-----------|------------|----------------------|----------------------------------------|\n| 1.0       | 2024-07-31 | Gemini AI Assistant  | Tạo tài liệu ban đầu dựa trên source code. |\n\n\u003c/rewritten_file\u003e "])</script><script>self.__next_f.push([1,"9:[\"slug\",\"erp/TRN_001_Quan_Ly_Phuong_Tien_Van_Chuyen\",\"c\"]\nf:[]\n"])</script><script>self.__next_f.push([1,"0:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/erp-docs/_next/static/css/4b73dfd0f7bdc629.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"$L3\",null,{\"buildId\":\"X5KF-BjlTdL2YCafX7ACW\",\"assetPrefix\":\"/erp-docs\",\"initialCanonicalUrl\":\"/erp/TRN_001_Quan_Ly_Phuong_Tien_Van_Chuyen/\",\"initialTree\":[\"\",{\"children\":[[\"slug\",\"erp/TRN_001_Quan_Ly_Phuong_Tien_Van_Chuyen\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"erp\\\",\\\"TRN_001_Quan_Ly_Phuong_Tien_Van_Chuyen\\\"]}\",{}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[[\"slug\",\"erp/TRN_001_Quan_Ly_Phuong_Tien_Van_Chuyen\",\"c\"],{\"children\":[\"__PAGE__\",{},[[\"$L4\",[\"$\",\"$L5\",null,{\"children\":[\"$\",\"article\",null,{\"className\":\"prose prose-slate dark:prose-invert max-w-none\",\"children\":[[\"$\",\"header\",null,{\"className\":\"mb-8\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"mb-2\",\"children\":\"$undefined\"}],\"$undefined\",\"$undefined\"]}],[\"$\",\"$L6\",null,{\"content\":\"$7\"}]]}]}]],null],null]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$9\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}],null]},[[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[\"$\",\"body\",null,{\"className\":\"__className_985585\",\"children\":[\"$\",\"$Lb\",null,{\"attribute\":\"class\",\"defaultTheme\":\"system\",\"enableSystem\":true,\"disableTransitionOnChange\":true,\"children\":[\"$\",\"$Lc\",null,{\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"styles\":null}]}]}]}]}],null],null],\"couldBeIntercepted\":false,\"initialHead\":[false,\"$Ld\"],\"globalErrorComponent\":\"$e\",\"missingSlots\":\"$Wf\"}]]\n"])</script><script>self.__next_f.push([1,"d:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"undefined | ERP Documentation\"}],[\"$\",\"meta\",\"3\",{\"name\":\"keywords\",\"content\":\"documentation,ERP,technical,mermaid,markdown\"}],[\"$\",\"meta\",\"4\",{\"name\":\"next-size-adjust\"}]]\n4:null\n"])</script></body></html>