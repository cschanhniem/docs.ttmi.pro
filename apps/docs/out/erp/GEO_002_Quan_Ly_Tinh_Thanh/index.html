<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/erp-docs/_next/static/media/e4af272ccee01ff0-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/erp-docs/_next/static/css/4b73dfd0f7bdc629.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/erp-docs/_next/static/chunks/webpack-39532e8569213db6.js"/><script src="/erp-docs/_next/static/chunks/7384d974-8b753aa07a0575a2.js" async=""></script><script src="/erp-docs/_next/static/chunks/381-1b6d0728bba7b8e7.js" async=""></script><script src="/erp-docs/_next/static/chunks/main-app-5d87a2fd0f4f2f33.js" async=""></script><script src="/erp-docs/_next/static/chunks/d550ec10-485e3f71f5def856.js" async=""></script><script src="/erp-docs/_next/static/chunks/993-1b6a71072be86da4.js" async=""></script><script src="/erp-docs/_next/static/chunks/410-1ece2fcedd156d2f.js" async=""></script><script src="/erp-docs/_next/static/chunks/app/%5B...slug%5D/page-7978846c0e32abf5.js" async=""></script><script src="/erp-docs/_next/static/chunks/app/layout-b6ef60bec0ff2cf2.js" async=""></script><title>undefined | ERP Documentation</title><meta name="keywords" content="documentation,ERP,technical,mermaid,markdown"/><meta name="next-size-adjust"/><script src="/erp-docs/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="__className_985585"><div class="min-h-screen flex items-center justify-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div><script src="/erp-docs/_next/static/chunks/webpack-39532e8569213db6.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/erp-docs/_next/static/media/e4af272ccee01ff0-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/erp-docs/_next/static/css/4b73dfd0f7bdc629.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"3:I[5214,[],\"\"]\n5:I[3040,[\"135\",\"static/chunks/d550ec10-485e3f71f5def856.js\",\"993\",\"static/chunks/993-1b6a71072be86da4.js\",\"410\",\"static/chunks/410-1ece2fcedd156d2f.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-7978846c0e32abf5.js\"],\"DocLayout\"]\n6:I[1276,[\"135\",\"static/chunks/d550ec10-485e3f71f5def856.js\",\"993\",\"static/chunks/993-1b6a71072be86da4.js\",\"410\",\"static/chunks/410-1ece2fcedd156d2f.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-7978846c0e32abf5.js\"],\"MDXContent\"]\n8:I[6472,[],\"\"]\na:I[9190,[],\"\"]\nb:I[4550,[\"185\",\"static/chunks/app/layout-b6ef60bec0ff2cf2.js\"],\"ThemeProvider\"]\nc:I[8910,[\"185\",\"static/chunks/app/layout-b6ef60bec0ff2cf2.js\"],\"AuthProvider\"]\ne:I[3013,[],\"\"]\n7:T5075,"])</script><script>self.__next_f.push([1,"# GEO_002_Geography_Quản Lý Tỉnh Thành\n\n*Phiên bản: 1.0*\n*Người tạo: Cline*\n*Ngày tạo: 13/05/2025*\n*Cập nhật lần cuối: 13/05/2025*\n*Người cập nhật: Cline*\n\n## 1. Tổng Quan Nghiệp Vụ\n\n### 1.1. Mô Tả Nghiệp Vụ\nNghiệp vụ này cho phép quản lý thông tin các tỉnh thành (hoặc thành phố trực thuộc trung ương) trong hệ thống ERP. Bao gồm việc tạo mới, xem, cập nhật và xóa thông tin tỉnh thành. Thông tin tỉnh thành là một phần quan trọng trong việc quản lý địa chỉ chi tiết, phân vùng địa lý cho khách hàng, nhà cung cấp.\n\n### 1.2. Phạm Vi Áp Dụng\nÁp dụng cho các bộ phận cần sử dụng thông tin địa lý chi tiết, bao gồm bộ phận kinh doanh, mua hàng, kế toán, và quản lý kho. Người dùng có quyền quản trị hệ thống hoặc được phân quyền cụ thể mới có thể thực hiện các thao tác quản lý tỉnh thành.\n\n### 1.3. Định Nghĩa Thuật Ngữ\n| Thuật ngữ | Định nghĩa |\n|-----------|------------|\n| Mã Tỉnh Thành (ma_tinh) | Mã định danh duy nhất cho mỗi tỉnh thành trong một quốc gia. |\n| Tên Tỉnh Thành (ten_tinh) | Tên chính thức của tỉnh thành. |\n| Tên Tỉnh Thành Khác (ten_tinh2) | Tên thay thế hoặc tên tiếng Anh của tỉnh thành. |\n| Quốc Gia (quoc_gia) | Quốc gia mà tỉnh thành này trực thuộc. |\n| Trạng Thái (status) | Trạng thái của tỉnh thành (ví dụ: 1 - Hoạt động, 0 - Không hoạt động). |\n| Entity (Đơn vị) | Đơn vị/Công ty sử dụng hệ thống ERP. Mỗi tỉnh thành được quản lý trong phạm vi một Entity cụ thể. |\n\n### 1.4. Tài Liệu Liên Quan\n| STT | Mã tài liệu | Tên tài liệu | Mô tả |\n|-----|-------------|--------------|-------|\n| 1   | GEO_001 | Quản Lý Quốc Gia | Tài liệu mô tả quy trình quản lý thông tin quốc gia, là cấp cha của tỉnh thành. |\n| 2   | GEO_003 | Quản Lý Quận Huyện | Tài liệu mô tả quy trình quản lý thông tin quận huyện, là cấp con của tỉnh thành. |\n| 3   | GEO_006 | Quản Lý Địa Chỉ | Tài liệu mô tả quy trình quản lý thông tin địa chỉ, sử dụng thông tin tỉnh thành. |\n\n## 2. Quy Trình Nghiệp Vụ\n\n### 2.1. Tổng Quan Quy Trình\nQuy trình quản lý tỉnh thành bao gồm các bước: người dùng yêu cầu thực hiện thao tác (thêm, sửa, xóa, xem danh sách, xem chi tiết), hệ thống kiểm tra dữ liệu và quyền hạn, sau đó thực thi yêu cầu và phản hồi kết quả cho người dùng.\n\n### 2.2. Sơ Đồ Quy Trình (Business Flow)\n\n```mermaid\nflowchart TD\n    A[Người dùng yêu cầu thao tác quản lý tỉnh thành] --\u003e B{Chọn thao tác};\n    B --\u003e|Thêm mới| C[Nhập thông tin tỉnh thành (bao gồm chọn Quốc Gia)];\n    B --\u003e|Cập nhật| D[Chọn tỉnh thành \u0026 Nhập thông tin mới];\n    B --\u003e|Xóa| E[Chọn tỉnh thành \u0026 Xác nhận xóa];\n    B --\u003e|Xem danh sách| F[Hệ thống hiển thị danh sách tỉnh thành (có thể lọc theo Quốc Gia)];\n    B --\u003e|Xem chi tiết| G[Chọn tỉnh thành \u0026 Hệ thống hiển thị chi tiết];\n    C --\u003e H[Hệ thống kiểm tra dữ liệu];\n    D --\u003e H;\n    H --\u003e|Hợp lệ| I[Lưu thông tin vào CSDL];\n    H --\u003e|Không hợp lệ| J[Thông báo lỗi];\n    I --\u003e K[Thông báo thành công];\n    E --\u003e L[Hệ thống kiểm tra ràng buộc (ví dụ: Quận Huyện)];\n    L --\u003e|Không có ràng buộc| M[Xóa tỉnh thành khỏi CSDL];\n    L --\u003e|Có ràng buộc| N[Thông báo lỗi không thể xóa];\n    M --\u003e K;\n    F --\u003e Z[Kết thúc];\n    G --\u003e Z;\n    J --\u003e A;\n    K --\u003e A;\n    N --\u003e A;\n```\n\n### 2.3. Chi Tiết Các Bước Quy Trình\n\n#### 2.3.1. Thêm Mới Tỉnh Thành\n- **Mô tả**: Người dùng cung cấp thông tin để tạo một tỉnh thành mới, liên kết với một quốc gia cụ thể.\n- **Đầu vào**: Mã tỉnh thành, tên tỉnh thành, tên tỉnh thành khác (tùy chọn), UUID của quốc gia, trạng thái (mặc định là hoạt động).\n- **Đầu ra**: Tỉnh thành mới được tạo trong hệ thống.\n- **Người thực hiện**: Quản trị viên hệ thống hoặc người dùng được phân quyền.\n- **Điều kiện tiên quyết**: Người dùng đã đăng nhập và có quyền. Quốc gia liên kết phải tồn tại. Mã tỉnh thành không được trùng lặp trong cùng một quốc gia và Entity.\n- **Xử lý ngoại lệ**:\n    - Nếu mã tỉnh thành đã tồn tại trong quốc gia đó: Thông báo lỗi.\n    - Nếu quốc gia không tồn tại: Thông báo lỗi.\n    - Nếu thông tin không hợp lệ: Thông báo lỗi.\n\n#### 2.3.2. Cập Nhật Thông Tin Tỉnh Thành\n- **Mô tả**: Người dùng thay đổi thông tin của một tỉnh thành đã tồn tại.\n- **Đầu vào**: UUID của tỉnh thành cần cập nhật, thông tin mới (mã tỉnh thành, tên tỉnh thành, tên tỉnh thành khác, UUID quốc gia, trạng thái).\n- **Đầu ra**: Thông tin tỉnh thành được cập nhật trong hệ thống.\n- **Người thực hiện**: Quản trị viên hệ thống hoặc người dùng được phân quyền.\n- **Điều kiện tiên quyết**: Tỉnh thành tồn tại trong hệ thống. Người dùng có quyền cập nhật.\n- **Xử lý ngoại lệ**:\n    - Nếu tỉnh thành không tồn tại: Thông báo lỗi.\n    - Nếu mã tỉnh thành mới (nếu thay đổi) đã tồn tại cho một tỉnh thành khác trong cùng quốc gia: Thông báo lỗi.\n    - Nếu thông tin không hợp lệ: Thông báo lỗi.\n\n#### 2.3.3. Xóa Tỉnh Thành\n- **Mô tả**: Người dùng xóa một tỉnh thành khỏi hệ thống.\n- **Đầu vào**: UUID của tỉnh thành cần xóa.\n- **Đầu ra**: Tỉnh thành bị xóa khỏi hệ thống (nếu không có ràng buộc).\n- **Người thực hiện**: Quản trị viên hệ thống hoặc người dùng được phân quyền.\n- **Điều kiện tiên quyết**: Tỉnh thành tồn tại trong hệ thống. Người dùng có quyền xóa.\n- **Xử lý ngoại lệ**:\n    - Nếu tỉnh thành không tồn tại: Thông báo lỗi.\n    - Nếu tỉnh thành đang được sử dụng (ví dụ: có quận huyện liên kết): Thông báo lỗi không thể xóa.\n\n#### 2.3.4. Xem Danh Sách Tỉnh Thành\n- **Mô tả**: Người dùng xem danh sách các tỉnh thành, có thể lọc theo quốc gia, và phân trang.\n- **Đầu vào**: Entity slug, tùy chọn: UUID quốc gia, trang, kích thước trang, các tiêu chí lọc (tên, mã).\n- **Đầu ra**: Danh sách các tỉnh thành thỏa mãn điều kiện.\n- **Người thực hiện**: Bất kỳ người dùng nào có quyền truy cập chức năng.\n- **Điều kiện tiên quyết**: Người dùng đã đăng nhập.\n\n#### 2.3.5. Xem Chi Tiết Tỉnh Thành\n- **Mô tả**: Người dùng xem thông tin chi tiết của một tỉnh thành cụ thể.\n- **Đầu vào**: UUID của tỉnh thành.\n- **Đầu ra**: Thông tin chi tiết của tỉnh thành.\n- **Người thực hiện**: Bất kỳ người dùng nào có quyền truy cập chức năng.\n- **Điều kiện tiên quyết**: Tỉnh thành tồn tại trong hệ thống.\n- **Xử lý ngoại lệ**: Nếu tỉnh thành không tồn tại: Thông báo lỗi.\n\n### 2.4. Sơ Đồ Tuần Tự (Sequence Diagram) - Thêm Mới Tỉnh Thành\n\n```mermaid\nsequenceDiagram\n    participant User as Người dùng\n    participant System as Hệ thống (API)\n    participant Service as TinhThanhModelService\n    participant Repository as TinhThanhRepository\n    participant QuocGiaRepo as QuocGiaRepository\n    participant DB as Cơ sở dữ liệu\n\n    User-\u003e\u003eSystem: POST /api/{entity_slug}/tinh-thanh/ (data: ma_tinh, ten_tinh, quoc_gia_uuid, ...)\n    System-\u003e\u003eService: create_tinh_thanh(entity_slug, data)\n    Service-\u003e\u003eService: _get_entity_model(entity_slug)\n    Service--\u003e\u003eService: entity_model\n    Service-\u003e\u003eQuocGiaRepo: get_quoc_gia_by_uuid(data['quoc_gia_uuid'])\n    QuocGiaRepo-\u003e\u003eDB: SELECT * FROM QuocGiaModel WHERE uuid = ...\n    DB--\u003e\u003eQuocGiaRepo: quoc_gia_model (or null)\n    QuocGiaRepo--\u003e\u003eService: quoc_gia_model (or null)\n    alt Quốc gia không tồn tại\n        Service--\u003e\u003eSystem: Error: \"Country not found\"\n        System--\u003e\u003eUser: Response 400 (Error message)\n    else Quốc gia tồn tại\n        Service-\u003e\u003eService: validate_tinh_thanh_data(data)\n        Service--\u003e\u003eService: validated_data\n        Service-\u003e\u003eRepository: get_tinh_thanh_by_code(entity_model, quoc_gia_model, validated_data['ma_tinh'])\n        Repository-\u003e\u003eDB: SELECT * FROM TinhThanhModel WHERE entity_id = ... AND quoc_gia_id = ... AND ma_tinh = ...\n        DB--\u003e\u003eRepository: existing_tinh_thanh (or null)\n        Repository--\u003e\u003eService: existing_tinh_thanh (or null)\n        alt Mã tỉnh thành đã tồn tại trong quốc gia\n            Service--\u003e\u003eSystem: Error: \"Province/City code already exists in this country\"\n            System--\u003e\u003eUser: Response 400 (Error message)\n        else Mã tỉnh thành chưa tồn tại\n            Service-\u003e\u003eRepository: create_tinh_thanh(validated_data_with_entity_and_country)\n            Repository-\u003e\u003eDB: INSERT INTO TinhThanhModel (...) VALUES (...)\n            DB--\u003e\u003eRepository: new_tinh_thanh_object\n            Repository--\u003e\u003eService: new_tinh_thanh_object\n            Service--\u003e\u003eSystem: new_tinh_thanh_object\n            System--\u003e\u003eUser: Response 201 (new_tinh_thanh_data)\n        end\n    end\n```\n\n### 2.5. Luồng Nghiệp Vụ Thay Thế\n- **Tìm kiếm tỉnh thành**: Người dùng có thể tìm kiếm tỉnh thành theo tên hoặc theo mã.\n- **Lọc tỉnh thành theo quốc gia**: Người dùng có thể xem danh sách tỉnh thành thuộc một quốc gia cụ thể.\n\n## 3. Yêu Cầu Chức Năng\n\n### 3.1. Danh Sách Chức Năng\n\n| STT | Mã chức năng | Tên chức năng | Mô tả | Độ ưu tiên |\n|-----|--------------|---------------|-------|------------|\n| 1   | GEO_002_F01 | Thêm mới tỉnh thành | Cho phép tạo một tỉnh thành mới với các thông tin cần thiết, thuộc một quốc gia. | Cao |\n| 2   | GEO_002_F02 | Cập nhật tỉnh thành | Cho phép sửa thông tin của một tỉnh thành đã có. | Cao |\n| 3   | GEO_002_F03 | Xóa tỉnh thành | Cho phép xóa một tỉnh thành khỏi hệ thống. | Cao |\n| 4   | GEO_002_F04 | Xem danh sách tỉnh thành | Hiển thị danh sách các tỉnh thành, hỗ trợ phân trang và lọc (theo quốc gia, tên, mã). | Cao |\n| 5   | GEO_002_F05 | Xem chi tiết tỉnh thành | Hiển thị thông tin chi tiết của một tỉnh thành. | Cao |\n| 6   | GEO_002_F06 | Tìm kiếm tỉnh thành theo tên | Cho phép tìm kiếm tỉnh thành dựa trên tên. | Trung bình |\n| 7   | GEO_002_F07 | Tìm kiếm tỉnh thành theo mã | Cho phép tìm kiếm tỉnh thành dựa trên mã. | Trung bình |\n| 8   | GEO_002_F08 | Lấy danh sách tỉnh thành đang hoạt động | Lấy danh sách các tỉnh thành có trạng thái là \"Hoạt động\". | Trung bình |\n| 9   | GEO_002_F09 | Lấy danh sách tỉnh thành theo quốc gia | Lấy danh sách các tỉnh thành thuộc một quốc gia cụ thể. | Cao |\n\n### 3.2. Chi Tiết Chức Năng\n\n#### 3.2.1. GEO_002_F01: Thêm mới tỉnh thành\n- **Mô tả**: Chức năng cho phép người dùng tạo mới một tỉnh thành.\n- **Đầu vào**:\n    - `entity_slug`: Slug của Entity.\n    - `data`: Đối tượng chứa thông tin tỉnh thành:\n        - `ma_tinh` (bắt buộc): Mã tỉnh thành (string, max 100).\n        - `ten_tinh` (bắt buộc): Tên tỉnh thành (string, max 255).\n        - `ten_tinh2` (tùy chọn): Tên tỉnh thành khác (string, max 255).\n        - `quoc_gia_uuid` (bắt buộc): UUID của Quốc Gia.\n        - `status` (tùy chọn): Trạng thái (integer). Mặc định là 1.\n- **Đầu ra**: Đối tượng TinhThanhModel vừa được tạo.\n- **Điều kiện tiên quyết**: `entity_slug` và `quoc_gia_uuid` hợp lệ. `ma_tinh` không trùng trong cùng `entity_slug` và `quoc_gia_uuid`.\n- **Luồng xử lý chính**:\n  1. Service lấy `EntityModel` và `QuocGiaModel`.\n  2. Service validate dữ liệu (`ma_tinh`, `ten_tinh`, `quoc_gia_uuid`).\n  3. Service kiểm tra `ma_tinh` đã tồn tại trong `Entity` và `QuocGia` chưa.\n  4. Nếu chưa, Service gọi Repository để tạo mới.\n- **Giao diện liên quan**: Form thêm mới tỉnh thành.\n\n#### 3.2.2. GEO_002_F02: Cập nhật tỉnh thành\n- **Mô tả**: Cập nhật thông tin tỉnh thành.\n- **Đầu vào**:\n    - `entity_slug`: Slug của Entity.\n    - `uuid`: UUID của tỉnh thành.\n    - `data`: Thông tin cập nhật (tương tự thêm mới, các trường tùy chọn).\n- **Đầu ra**: Đối tượng TinhThanhModel đã cập nhật.\n- **Điều kiện tiên quyết**: Tỉnh thành tồn tại. Nếu `ma_tinh` hoặc `quoc_gia_uuid` thay đổi, mã mới không được trùng.\n- **Giao diện liên quan**: Form cập nhật tỉnh thành.\n\n#### 3.2.3. GEO_002_F03: Xóa tỉnh thành\n- **Mô tả**: Xóa một tỉnh thành.\n- **Đầu vào**: `entity_slug`, `uuid` của tỉnh thành.\n- **Đầu ra**: HTTP 204 No Content.\n- **Điều kiện tiên quyết**: Tỉnh thành tồn tại và không có ràng buộc (ví dụ: Quận Huyện).\n- **Giao diện liên quan**: Nút xóa.\n\n#### 3.2.4. GEO_002_F04: Xem danh sách tỉnh thành\n- **Mô tả**: Lấy danh sách tỉnh thành, có phân trang và lọc.\n- **Đầu vào**: `entity_slug`, `page`, `page_size`, `quoc_gia_uuid` (lọc), `ma_tinh`, `ten_tinh`.\n- **Đầu ra**: Danh sách TinhThanhModel.\n- **Giao diện liên quan**: Trang danh sách tỉnh thành.\n\n#### 3.2.5. GEO_002_F05: Xem chi tiết tỉnh thành\n- **Mô tả**: Lấy chi tiết một tỉnh thành.\n- **Đầu vào**: `entity_slug`, `uuid` của tỉnh thành.\n- **Đầu ra**: Đối tượng TinhThanhModel.\n- **Giao diện liên quan**: Trang chi tiết tỉnh thành.\n\n#### 3.2.9. GEO_002_F09: Lấy danh sách tỉnh thành theo quốc gia\n- **Mô tả**: Lấy danh sách các tỉnh thành thuộc một quốc gia cụ thể.\n- **Đầu vào**: `entity_slug`, `quoc_gia_uuid`.\n- **Đầu ra**: `QuerySet` các `TinhThanhModel`.\n\n## 4. Thiết Kế Kỹ Thuật\n\n### 4.1. Kiến Trúc Hệ Thống\nTương tự GEO_001, sử dụng Views/APIs, Services (`TinhThanhModelService`), Repositories (`TinhThanhRepository`), Models (`TinhThanhModel`, `QuocGiaModel`, `EntityModel`).\n\n### 4.2. API Endpoints\n\n- **Base URL**: `/api/{entity_slug}/tinh-thanh/`\n- **Endpoints**:\n    - `GET /`: Lấy danh sách tỉnh thành. (GEO_002_F04)\n        - Query params: `page`, `page_size`, `quoc_gia_uuid`, `ma_tinh`, `ten_tinh`, `status`.\n    - `POST /`: Tạo mới tỉnh thành. (GEO_002_F01)\n        - Request body: `{ \"ma_tinh\": \"HCM\", \"ten_tinh\": \"Hồ Chí Minh\", \"quoc_gia_uuid\": \"uuid_cua_VN\", \"status\": 1 }`\n    - `GET /{uuid}/`: Lấy chi tiết tỉnh thành. (GEO_002_F05)\n    - `PUT /{uuid}/`: Cập nhật tỉnh thành. (GEO_002_F02)\n    - `PATCH /{uuid}/`: Cập nhật một phần tỉnh thành. (GEO_002_F02)\n    - `DELETE /{uuid}/`: Xóa tỉnh thành. (GEO_002_F03)\n    - `GET /theo-quoc-gia/{quoc_gia_uuid}/`: Lấy tỉnh thành theo quốc gia. (GEO_002_F09)\n\n### 4.3. Service Logic (`TinhThanhModelService`)\n- Tương tự `QuocGiaModelService` nhưng cho `TinhThanhModel`.\n- Sẽ có thêm logic kiểm tra sự tồn tại của `QuocGiaModel` khi tạo/cập nhật tỉnh thành.\n- Validate `ma_tinh` phải duy nhất trong phạm vi `Entity` và `QuocGia`.\n\n### 4.4. Mô Hình Dữ Liệu\n\n#### 4.4.1. Entity Relationship Diagram (ERD)\n\n```mermaid\nerDiagram\n    ENTITY ||--|{ QUOC_GIA : \"quản lý\"\n    ENTITY ||--|{ TINH_THANH : \"quản lý\"\n    ENTITY ||--|{ QUAN_HUYEN : \"quản lý\"\n\n    QUOC_GIA ||--o{ TINH_THANH : \"có\"\n    TINH_THANH ||--o{ QUAN_HUYEN : \"có\"\n\n    ENTITY {\n        uuid uuid PK\n        string slug\n        string name\n        \u003cem\u003e(các trường khác)\u003c/em\u003e\n    }\n\n    QUOC_GIA {\n        uuid uuid PK\n        string ma_qg\n        string ten_qg\n        uuid entity_id FK\n        \u003cem\u003e(các trường khác)\u003c/em\u003e\n    }\n\n    TINH_THANH {\n        uuid uuid PK\n        string ma_tinh \"Mã tỉnh thành (duy nhất trong Quốc Gia \u0026 Entity)\"\n        string ten_tinh \"Tên tỉnh thành\"\n        string ten_tinh2 \"Tên tỉnh thành khác\"\n        integer status \"Trạng thái\"\n        datetime created\n        datetime updated\n        uuid entity_id FK \"Khóa ngoại tới ENTITY\"\n        uuid quoc_gia_id FK \"Khóa ngoại tới QUOC_GIA\"\n    }\n\n    QUAN_HUYEN {\n        uuid uuid PK\n        string ma_huyen \"Mã quận huyện\"\n        string ten_huyen \"Tên quận huyện\"\n        uuid tinh_thanh_id FK \"Khóa ngoại tới TINH_THANH\"\n        uuid entity_id FK \"Khóa ngoại tới ENTITY\"\n        \u003cem\u003e(các trường khác)\u003c/em\u003e\n    }\n```\n\n#### 4.4.2. Chi Tiết Bảng Dữ Liệu\n\n##### Bảng: `TinhThanhModel` (django_ledger_tinhthanhmodel)\n- **Mô tả**: Lưu trữ thông tin các tỉnh thành.\n- **Các cột chính**:\n    - `uuid` (UUID, Khóa chính).\n    - `ma_tinh` (CharField, max_length=100).\n    - `ten_tinh` (CharField, max_length=255).\n    - `ten_tinh2` (CharField, max_length=255, null=True, blank=True).\n    - `status` (IntegerField, default=1).\n    - `entity_model` (ForeignKey đến `EntityModel`).\n    - `quoc_gia` (ForeignKey đến `QuocGiaModel`).\n    - `created` (DateTimeField, auto_now_add=True).\n    - `updated` (DateTimeField, auto_now=True).\n- **Indexes**:\n    - `unique_together = ('entity_model', 'quoc_gia', 'ma_tinh')`.\n\n## 5. Kế Hoạch Kiểm Thử\n\n### 5.1. Phạm Vi Kiểm Thử\n- CRUD cho Tỉnh Thành.\n- Lọc theo Quốc Gia.\n- Validation dữ liệu (bao gồm `quoc_gia_uuid`).\n- Ràng buộc duy nhất của `ma_tinh` theo `entity_model` và `quoc_gia`.\n\n### 5.2. Kịch Bản Kiểm Thử (Ví dụ)\n\n| STT | Mã kịch bản | Tên kịch bản | Mô tả | Điều kiện tiên quyết | Các bước | Kết quả mong đợi |\n|-----|------------|--------------|-------|---------------------|----------|-----------------|\n| 1   | GEO_002_TC01 | Thêm mới tỉnh thành thành công | Kiểm tra thêm tỉnh thành với dữ liệu hợp lệ. | User đăng nhập, có quyền. Entity \"E1\", Quốc gia \"VN\" (uuid_vn) tồn tại. | 1. POST `/api/E1/tinh-thanh/`. 2. Payload: `{\"ma_tinh\": \"HCM\", \"ten_tinh\": \"Hồ Chí Minh\", \"quoc_gia_uuid\": \"uuid_vn\"}`. | 1. HTTP 201. 2. Dữ liệu tỉnh thành được trả về. 3. Tỉnh thành được lưu vào CSDL. |\n| 2   | GEO_002_TC02 | Thêm mới tỉnh thành với mã trùng | Kiểm tra thêm tỉnh thành có `ma_tinh` đã tồn tại trong cùng Quốc gia \u0026 Entity. | Như TC01. Tỉnh thành \"HCM\" thuộc \"VN\" đã tồn tại. | 1. POST `/api/E1/tinh-thanh/`. 2. Payload: `{\"ma_tinh\": \"HCM\", \"ten_tinh\": \"TP.HCM\", \"quoc_gia_uuid\": \"uuid_vn\"}`. | 1. HTTP 400. 2. Lỗi \"Province/City code already exists in this country\". |\n| 3   | GEO_002_TC03 | Thêm mới tỉnh thành với quốc gia không tồn tại | Kiểm tra thêm tỉnh thành với `quoc_gia_uuid` không tồn tại. | Như TC01. `invalid_uuid_qg` không tồn tại. | 1. POST `/api/E1/tinh-thanh/`. 2. Payload: `{\"ma_tinh\": \"DN\", \"ten_tinh\": \"Đà Nẵng\", \"quoc_gia_uuid\": \"invalid_uuid_qg\"}`. | 1. HTTP 400. 2. Lỗi \"Country not found\". |\n| 4   | GEO_002_TC04 | Xem danh sách tỉnh thành theo quốc gia | Lấy danh sách tỉnh thành của quốc gia \"VN\". | Như TC01. Có tỉnh \"HCM\" và \"HN\" thuộc \"VN\". | 1. GET `/api/E1/tinh-thanh/?quoc_gia_uuid=uuid_vn`. | 1. HTTP 200. 2. Danh sách chứa \"HCM\" và \"HN\". |\n\n## 6. Phụ Lục\n\n### 6.1. Danh Sách Tài Liệu Tham Khảo\n- Mã nguồn Django Ledger: `django_ledger/services/tinh_thanh/tinh_thanh.py` (dự kiến)\n- Mã nguồn Django Ledger: `django_ledger/repositories/tinh_thanh/tinh_thanh.py` (dự kiến)\n- Mã nguồn Django Ledger: `django_ledger/models/tinh_thanh.py` (dự kiến)\n\n### 6.2. Danh Mục Thuật Ngữ\n(Đã định nghĩa ở mục 1.3)\n\n### 6.3. Lịch Sử Thay Đổi Tài Liệu\n\n| Phiên bản | Ngày | Người thực hiện | Mô tả thay đổi |\n|-----------|------|-----------------|---------------|\n| 1.0 | 13/05/2025 | Cline | Tạo mới tài liệu. |\n"])</script><script>self.__next_f.push([1,"9:[\"slug\",\"erp/GEO_002_Quan_Ly_Tinh_Thanh\",\"c\"]\nf:[]\n"])</script><script>self.__next_f.push([1,"0:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/erp-docs/_next/static/css/4b73dfd0f7bdc629.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"$L3\",null,{\"buildId\":\"X5KF-BjlTdL2YCafX7ACW\",\"assetPrefix\":\"/erp-docs\",\"initialCanonicalUrl\":\"/erp/GEO_002_Quan_Ly_Tinh_Thanh/\",\"initialTree\":[\"\",{\"children\":[[\"slug\",\"erp/GEO_002_Quan_Ly_Tinh_Thanh\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"erp\\\",\\\"GEO_002_Quan_Ly_Tinh_Thanh\\\"]}\",{}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[[\"slug\",\"erp/GEO_002_Quan_Ly_Tinh_Thanh\",\"c\"],{\"children\":[\"__PAGE__\",{},[[\"$L4\",[\"$\",\"$L5\",null,{\"children\":[\"$\",\"article\",null,{\"className\":\"prose prose-slate dark:prose-invert max-w-none\",\"children\":[[\"$\",\"header\",null,{\"className\":\"mb-8\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"mb-2\",\"children\":\"$undefined\"}],\"$undefined\",\"$undefined\"]}],[\"$\",\"$L6\",null,{\"content\":\"$7\"}]]}]}]],null],null]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$9\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}],null]},[[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[\"$\",\"body\",null,{\"className\":\"__className_985585\",\"children\":[\"$\",\"$Lb\",null,{\"attribute\":\"class\",\"defaultTheme\":\"system\",\"enableSystem\":true,\"disableTransitionOnChange\":true,\"children\":[\"$\",\"$Lc\",null,{\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"styles\":null}]}]}]}]}],null],null],\"couldBeIntercepted\":false,\"initialHead\":[false,\"$Ld\"],\"globalErrorComponent\":\"$e\",\"missingSlots\":\"$Wf\"}]]\n"])</script><script>self.__next_f.push([1,"d:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"undefined | ERP Documentation\"}],[\"$\",\"meta\",\"3\",{\"name\":\"keywords\",\"content\":\"documentation,ERP,technical,mermaid,markdown\"}],[\"$\",\"meta\",\"4\",{\"name\":\"next-size-adjust\"}]]\n4:null\n"])</script></body></html>