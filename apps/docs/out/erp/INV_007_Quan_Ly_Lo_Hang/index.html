<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/erp-docs/_next/static/media/e4af272ccee01ff0-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/erp-docs/_next/static/css/4b73dfd0f7bdc629.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/erp-docs/_next/static/chunks/webpack-39532e8569213db6.js"/><script src="/erp-docs/_next/static/chunks/7384d974-8b753aa07a0575a2.js" async=""></script><script src="/erp-docs/_next/static/chunks/381-1b6d0728bba7b8e7.js" async=""></script><script src="/erp-docs/_next/static/chunks/main-app-5d87a2fd0f4f2f33.js" async=""></script><script src="/erp-docs/_next/static/chunks/d550ec10-485e3f71f5def856.js" async=""></script><script src="/erp-docs/_next/static/chunks/993-1b6a71072be86da4.js" async=""></script><script src="/erp-docs/_next/static/chunks/410-1ece2fcedd156d2f.js" async=""></script><script src="/erp-docs/_next/static/chunks/app/%5B...slug%5D/page-7978846c0e32abf5.js" async=""></script><script src="/erp-docs/_next/static/chunks/app/layout-b6ef60bec0ff2cf2.js" async=""></script><title>undefined | ERP Documentation</title><meta name="keywords" content="documentation,ERP,technical,mermaid,markdown"/><meta name="next-size-adjust"/><script src="/erp-docs/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="__className_985585"><div class="min-h-screen flex items-center justify-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div><script src="/erp-docs/_next/static/chunks/webpack-39532e8569213db6.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/erp-docs/_next/static/media/e4af272ccee01ff0-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/erp-docs/_next/static/css/4b73dfd0f7bdc629.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"3:I[5214,[],\"\"]\n5:I[3040,[\"135\",\"static/chunks/d550ec10-485e3f71f5def856.js\",\"993\",\"static/chunks/993-1b6a71072be86da4.js\",\"410\",\"static/chunks/410-1ece2fcedd156d2f.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-7978846c0e32abf5.js\"],\"DocLayout\"]\n6:I[1276,[\"135\",\"static/chunks/d550ec10-485e3f71f5def856.js\",\"993\",\"static/chunks/993-1b6a71072be86da4.js\",\"410\",\"static/chunks/410-1ece2fcedd156d2f.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-7978846c0e32abf5.js\"],\"MDXContent\"]\n8:I[6472,[],\"\"]\na:I[9190,[],\"\"]\nb:I[4550,[\"185\",\"static/chunks/app/layout-b6ef60bec0ff2cf2.js\"],\"ThemeProvider\"]\nc:I[8910,[\"185\",\"static/chunks/app/layout-b6ef60bec0ff2cf2.js\"],\"AuthProvider\"]\ne:I[3013,[],\"\"]\n7:T53f4,"])</script><script>self.__next_f.push([1,"# INV_007_Quản Lý Lô Hàng\n\n*Phiên bản: 1.0*\n*Người tạo: Gemini AI Assistant*\n*Ngày tạo: 2024-07-31*\n*Cập nhật lần cuối: 2024-07-31*\n*Người cập nhật: Gemini AI Assistant*\n\n## 1. Tổng Quan Nghiệp Vụ\n\n### 1.1. Mô Tả Nghiệp Vụ\nNghiệp vụ Quản Lý Lô Hàng (trong mã nguồn là `LoModel`) cho phép người dùng định nghĩa và quản lý các lô hàng của vật tư/sản phẩm trong hệ thống. Mỗi lô hàng bao gồm các thông tin như mã lô, tên lô, ngày nhập, ngày sản xuất, hạn sử dụng, và các thông tin liên quan khác. Mục đích là theo dõi chi tiết các lô hàng để quản lý hiệu quả hàng tồn kho, đặc biệt là hàng hóa có thời hạn sử dụng, cần theo dõi nguồn gốc xuất xứ, hoặc theo lô sản xuất.\n\n### 1.2. Phạm Vi Áp Dụng\n- Áp dụng cho từng Đơn vị (Entity) trong hệ thống.\n- Các bộ phận liên quan đến quản lý kho hàng, vật tư, sản xuất, và kiểm soát chất lượng.\n\n### 1.3. Định Nghĩa Thuật Ngữ\n| Thuật ngữ | Định nghĩa |\n|-----------|------------|\n| Lô Hàng | Một nhóm vật tư/sản phẩm cùng loại, có chung đặc tính về thời gian sản xuất, hạn sử dụng, v.v. Trong mã nguồn là `LoModel`. |\n| Đơn vị (Entity) | Tổ chức hoặc công ty mà lô hàng được định nghĩa và áp dụng. |\n| `ma_lo` | Mã định danh duy nhất cho một lô hàng trong một đơn vị. |\n| `ten_lo` | Tên chính của lô hàng. |\n| `ten_lo2` | Tên thay thế/phụ của lô hàng. |\n| `ma_vt` | Mã vật tư liên kết đến lô hàng (liên kết đến `VatTuModel`). |\n| `ma_vt2` | Mã vật tư thay thế (dạng chuỗi). |\n| `ngay_nhap` | Ngày nhập lô hàng vào kho. |\n| `ngay_sx` | Ngày sản xuất của lô hàng. |\n| `ngay_hhsd` | Ngày hết hạn sử dụng của lô hàng. |\n| `ngay_hhbh` | Ngày hết hạn bảo hành của lô hàng. |\n| `ghi_chu` | Ghi chú bổ sung cho lô hàng. |\n| `status` | Trạng thái của lô hàng. |\n\n### 1.4. Tài Liệu Liên Quan\n| STT | Mã tài liệu | Tên tài liệu | Mô tả |\n|-----|-------------|--------------|-------|\n| 1   | `django_ledger/models/lo.py` | Model Định Nghĩa Lô Hàng | Định nghĩa cấu trúc dữ liệu cho `LoModel`. |\n| 2   | `django_ledger/api/views/lo.py` | API Endpoints Lô Hàng | Các điểm cuối API để tương tác với nghiệp vụ Quản Lý Lô Hàng. |\n| 3   | `django_ledger/api/serializers/lo.py` | Serializers Lô Hàng | Định dạng dữ liệu JSON cho API, thực hiện validation. |\n| 4   | `django_ledger/services/lo/lo.py` | Service Logic Lô Hàng | Logic nghiệp vụ cho việc tạo, cập nhật, xóa, truy vấn Lô Hàng. |\n| 5   | `django_ledger/repositories/lo/lo.py` | Repository Lô Hàng | Lớp truy cập dữ liệu cho Lô Hàng. |\n| 6   | `django_ledger/api/urls.py` | URL Configuration | Đăng ký endpoint `/api/{entity_slug}/lots/` cho Lô Hàng. |\n\n## 2. Quy Trình Nghiệp Vụ\n\n### 2.1. Tổng Quan Quy Trình\nNgười dùng có thẩm quyền (ví dụ: quản trị viên, quản lý kho) tương tác với hệ thống thông qua giao diện người dùng hoặc API để thực hiện các thao tác CRUD (Create, Read, Update, Delete) đối với các Lô Hàng. Hệ thống sẽ xử lý các yêu cầu này thông qua `LoModelViewSet`, sử dụng `LoModelService` để thực thi logic nghiệp vụ và `LoRepository` để tương tác với cơ sở dữ liệu. Dữ liệu đầu vào sẽ được kiểm tra (validate) bởi `LoModelSerializer` và `LoModelService`.\n\n### 2.2. Sơ Đồ Quy Trình (Business Flow)\n\n```mermaid\nflowchart TD\n    A[Người dùng yêu cầu thao tác Lô Hàng] --\u003e B{API Gateway nhận yêu cầu};\n    B --\u003e C[Xác thực \u0026 Ủy quyền (IsAuthenticated)];\n    C --\u003e D[LoModelViewSet];\n    D --\u003e E[LoModelService];\n    E --\u003e F[LoRepository];\n    F --\u003e G[(Cơ sở dữ liệu - Bảng lo)];\n    G --\u003e F;\n    F --\u003e E;\n    E --\u003e D;\n    subgraph \"Validation\"\n        direction LR\n        H[Request Data] --\u003e I[LoModelSerializer];\n        I --\u003e J[LoModelService.validate_lo_data];\n    end\n    D --\u003e H;\n    J -- Dữ liệu hợp lệ --\u003e E;\n    J -- Dữ liệu không hợp lệ --\u003e K[Báo lỗi cho ViewSet];\n    K --\u003e B;\n    D --\u003e L[Trả kết quả cho người dùng];\n    B --\u003e L;\n```\n\n### 2.3. Chi Tiết Các Bước Quy Trình\n\n#### 2.3.1. Tạo Mới Lô Hàng\n- **Mô tả**: Người dùng cung cấp thông tin để tạo một Lô Hàng mới cho một Đơn vị và một Vật tư cụ thể.\n- **Đầu vào**: Dữ liệu Lô Hàng (`ma_lo`, `ten_lo`, `ma_vt`, các ngày và các thông tin khác). `entity_slug` được lấy từ URL.\n- **Đầu ra**: Lô Hàng mới được tạo thành công hoặc thông báo lỗi.\n- **Người thực hiện**: Quản trị viên, quản lý kho.\n- **Điều kiện tiên quyết**: Đăng nhập hệ thống, có quyền truy cập vào Đơn vị. `ma_lo` phải là duy nhất trong Đơn vị đó.\n- **Xử lý ngoại lệ**: Dữ liệu không hợp lệ (thiếu trường, sai định dạng, `ma_lo` bị trùng), Đơn vị không tồn tại, Vật tư không tồn tại.\n\n#### 2.3.2. Xem/Tìm Kiếm Lô Hàng\n- **Mô tả**: Người dùng xem danh sách các Lô Hàng của một Đơn vị hoặc chi tiết một Lô Hàng cụ thể.\n- **Đầu vào**: `entity_slug` (từ URL). Tùy chọn: `uuid` của Lô Hàng (để xem chi tiết), `ma_vt` (để lọc theo vật tư).\n- **Đầu ra**: Danh sách các Lô Hàng hoặc thông tin chi tiết của một Lô Hàng.\n- **Người thực hiện**: Mọi người dùng có quyền xem.\n- **Điều kiện tiên quyết**: Đăng nhập hệ thống.\n- **Xử lý ngoại lệ**: Lô Hàng không tồn tại, Đơn vị không tồn tại.\n\n#### 2.3.3. Cập Nhật Lô Hàng\n- **Mô tả**: Người dùng thay đổi thông tin của một Lô Hàng đã tồn tại.\n- **Đầu vào**: `entity_slug`, `uuid` của Lô Hàng, và dữ liệu cần cập nhật.\n- **Đầu ra**: Lô Hàng được cập nhật thành công hoặc thông báo lỗi.\n- **Người thực hiện**: Quản trị viên, quản lý kho.\n- **Điều kiện tiên quyết**: Đăng nhập, Lô Hàng phải tồn tại và thuộc Đơn vị chỉ định.\n- **Xử lý ngoại lệ**: Dữ liệu không hợp lệ, Lô Hàng không tồn tại.\n\n#### 2.3.4. Xóa Lô Hàng\n- **Mô tả**: Người dùng xóa một Lô Hàng khỏi hệ thống.\n- **Đầu vào**: `entity_slug`, `uuid` của Lô Hàng.\n- **Đầu ra**: Thông báo xóa thành công hoặc thông báo lỗi.\n- **Người thực hiện**: Quản trị viên, quản lý kho.\n- **Điều kiện tiên quyết**: Đăng nhập, Lô Hàng phải tồn tại và thuộc Đơn vị chỉ định.\n- **Xử lý ngoại lệ**: Lô Hàng không tồn tại, Lô Hàng đang được sử dụng.\n\n#### 2.3.5. Xem Lô Hàng Đã Hết Hạn\n- **Mô tả**: Người dùng xem danh sách các Lô Hàng đã hết hạn sử dụng.\n- **Đầu vào**: `entity_slug` (từ URL).\n- **Đầu ra**: Danh sách các Lô Hàng đã hết hạn.\n- **Người thực hiện**: Quản trị viên, quản lý kho.\n- **Điều kiện tiên quyết**: Đăng nhập, có quyền truy cập vào Đơn vị.\n- **Xử lý ngoại lệ**: Đơn vị không tồn tại.\n\n#### 2.3.6. Xem Lô Hàng Sắp Hết Hạn\n- **Mô tả**: Người dùng xem danh sách các Lô Hàng sắp hết hạn trong một khoảng thời gian.\n- **Đầu vào**: `entity_slug` (từ URL), `start_date` (tùy chọn), `end_date` (bắt buộc).\n- **Đầu ra**: Danh sách các Lô Hàng sắp hết hạn.\n- **Người thực hiện**: Quản trị viên, quản lý kho.\n- **Điều kiện tiên quyết**: Đăng nhập, có quyền truy cập vào Đơn vị.\n- **Xử lý ngoại lệ**: Đơn vị không tồn tại, thiếu tham số `end_date`.\n\n### 2.4. Sơ Đồ Tuần Tự (Sequence Diagram) - Tạo mới Lô Hàng\n\n```mermaid\nsequenceDiagram\n    participant User\n    participant APIView as LoModelViewSet\n    participant Service as LoModelService\n    participant Serializer as LoModelSerializer\n    participant Repository as LoRepository\n    participant Model as LoModel\n    participant DB as Database\n\n    User-\u003e\u003eAPIView: POST /api/{entity_slug}/lots/ (data)\n    APIView-\u003e\u003eSerializer: validate(data)\n    Serializer--\u003e\u003eAPIView: validated_data\n    APIView-\u003e\u003eService: get_service()\n    Service--\u003e\u003eAPIView: service_instance\n    APIView-\u003e\u003eService: validate_lo_data(data)\n    Service--\u003e\u003eAPIView: validated_data\n    APIView-\u003e\u003eService: create_lo(entity_slug, validated_data)\n    Service-\u003e\u003eRepository: get_entity_model(entity_slug)\n    Repository--\u003e\u003eService: entity_model\n    Service-\u003e\u003eRepository: create_lo(validated_data)\n    Repository-\u003e\u003eModel: objects.create(**validated_data)\n    Model-\u003e\u003eDB: INSERT INTO lo\n    DB--\u003e\u003eModel: created_instance\n    Model--\u003e\u003eRepository: created_instance\n    Repository--\u003e\u003eService: created_instance\n    Service--\u003e\u003eAPIView: created_instance\n    APIView-\u003e\u003eSerializer: serialize(created_instance)\n    Serializer--\u003e\u003eAPIView: serialized_data\n    APIView--\u003e\u003eUser: HTTP 201 (serialized_data)\n```\n\n### 2.5. Luồng Nghiệp Vụ Thay Thế\n- **Lọc theo vật tư**: Người dùng có thể lọc danh sách lô hàng theo mã vật tư cụ thể (thông qua tham số `ma_vt`).\n- **Lọc theo trạng thái**: Người dùng có thể lọc lô hàng theo trạng thái hoạt động (thông qua tham số `active_only`).\n- **Quản lý hàng hết hạn**: Hệ thống cung cấp các API endpoint đặc biệt để kiểm tra các lô hàng đã hết hạn hoặc sắp hết hạn.\n- **Nhập kho theo lô**: Khi nhập kho, người dùng có thể chỉ định thông tin lô hàng để theo dõi chi tiết.\n\n## 3. Yêu Cầu Chức Năng\n\n### 3.1. Danh Sách Chức Năng\n\n| STT | Mã chức năng | Tên chức năng | Mô tả | Độ ưu tiên |\n|-----|--------------|---------------|-------|------------|\n| 1   | INV007-LIST | Xem danh sách Lô Hàng | Lấy danh sách Lô Hàng theo Đơn vị, hỗ trợ phân trang và lọc. | Cao |\n| 2   | INV007-CREATE | Tạo mới Lô Hàng | Tạo một Lô Hàng mới cho một Đơn vị và một Vật tư cụ thể. | Cao |\n| 3   | INV007-RETRIEVE | Xem chi tiết Lô Hàng | Lấy thông tin chi tiết của một Lô Hàng bằng UUID. | Cao |\n| 4   | INV007-UPDATE | Cập nhật Lô Hàng | Cập nhật thông tin của một Lô Hàng đã có. | Cao |\n| 5   | INV007-DELETE | Xóa Lô Hàng | Xóa một Lô Hàng. | Cao |\n| 6   | INV007-EXPIRED | Xem Lô Hàng đã hết hạn | Lấy danh sách Lô Hàng đã hết hạn sử dụng. | Trung bình |\n| 7   | INV007-EXPIRING | Xem Lô Hàng sắp hết hạn | Lấy danh sách Lô Hàng sắp hết hạn trong một khoảng thời gian. | Trung bình |\n\n### 3.2. Chi Tiết Chức Năng\n\n#### 3.2.1. INV007-CREATE: Tạo mới Lô Hàng\n- **Mô tả**: Cho phép tạo một Lô Hàng mới.\n- **Đầu vào**: `entity_slug` (trong URL). Dữ liệu JSON body: `ma_lo` (string, bắt buộc), `ten_lo` (string, bắt buộc), `ma_vt` (UUID, bắt buộc), `ngay_nhap` (date, bắt buộc), `ngay_sx` (date, bắt buộc), `ngay_hhsd` (date, bắt buộc), `ngay_hhbh` (date, bắt buộc), và các trường khác.\n- **Đầu ra**: Dữ liệu JSON của Lô Hàng vừa tạo.\n- **Điều kiện tiên quyết**: `ma_lo` phải là duy nhất cho `entity_model`.\n- **Luồng xử lý chính**:\n  1. Gửi POST request với dữ liệu hợp lệ.\n  2. Hệ thống validate dữ liệu.\n  3. Hệ thống kiểm tra tính duy nhất của `ma_lo`.\n  4. Hệ thống tạo Lô Hàng mới.\n  5. Hệ thống trả về dữ liệu Lô Hàng đã tạo.\n- **Luồng xử lý thay thế/ngoại lệ**:\n  - Dữ liệu không hợp lệ: Trả về HTTP 400 với thông báo lỗi.\n  - `ma_lo` bị trùng: Trả về HTTP 400 với thông báo lỗi.\n- **Giao diện liên quan**: Form tạo mới Lô Hàng.\n\n## 4. Thiết Kế Kỹ Thuật\n\n### 4.1. Kiến Trúc Hệ Thống\nNghiệp vụ này tuân theo kiến trúc 3 lớp với sự hỗ trợ của Repository pattern:\n- **View (API Layer)**: `LoModelViewSet` xử lý HTTP request/response, xác thực, phân trang, và gọi các services.\n- **Service Layer**: `LoModelService` chứa logic nghiệp vụ chính, điều phối hoạt động giữa View và Repository, thực hiện validation nghiệp vụ.\n- **Repository Layer**: `LoRepository` chịu trách nhiệm tương tác trực tiếp với cơ sở dữ liệu thông qua Django ORM (`LoModel`).\n- **Model Layer**: `LoModel` định nghĩa cấu trúc dữ liệu, bao gồm các trường, ràng buộc và custom manager/queryset.\n\n```mermaid\ngraph TD\n    Client --\u003e Nginx --\u003e Gunicorn\n    Gunicorn --\u003e DjangoApp[Django Application]\n\n    subgraph DjangoApp\n        APILayer[API Layer: LoModelViewSet]\n        ServiceLayer[Service Layer: LoModelService]\n        RepositoryLayer[Repository Layer: LoRepository]\n        ModelLayer[Model Layer: LoModel]\n        Database[(PostgreSQL Database - lo table)]\n\n        APILayer --\u003e|calls| ServiceLayer\n        ServiceLayer --\u003e|uses| RepositoryLayer\n        RepositoryLayer --\u003e|accesses| ModelLayer\n        ModelLayer --\u003e|maps to| Database\n    end\n```\n\n### 4.2. API Endpoints\n\n#### 4.2.1. Lô Hàng (`LoModel`)\n- **Mô tả**: Quản lý các lô hàng.\n- **Base URL**: `/api/{entity_slug}/lots/`\n- **Endpoints**:\n  - `GET /`: Lấy danh sách Lô Hàng (hỗ trợ phân trang `ERPPagination`).\n    - Query params: `page`, `page_size`, `ma_vt` (lọc theo vật tư), `active_only` (lọc lô hàng đang hoạt động).\n  - `POST /`: Tạo một Lô Hàng mới.\n  - `GET /{uuid}/`: Lấy chi tiết một Lô Hàng.\n  - `PUT /{uuid}/`: Cập nhật toàn bộ một Lô Hàng.\n  - `PATCH /{uuid}/`: Cập nhật một phần một Lô Hàng.\n  - `DELETE /{uuid}/`: Xóa một Lô Hàng.\n  - `GET /expired/`: Lấy danh sách Lô Hàng đã hết hạn.\n  - `GET /expiring/`: Lấy danh sách Lô Hàng sắp hết hạn.\n    - Query params: `start_date` (tùy chọn), `end_date` (bắt buộc).\n\n### 4.3. Service Logic (`LoModelService`)\n- **Mô tả**: Cung cấp logic nghiệp vụ cho `LoModel`.\n- **Chức năng chính**:\n  1. `validate_lo_data(data)`: Kiểm tra các trường bắt buộc và định dạng dữ liệu.\n  2. `create_lo(entity_slug, data)`: Tạo một Lô Hàng mới.\n  3. `update_lo(entity_slug, uuid, data)`: Cập nhật một Lô Hàng hiện có.\n  4. `delete_lo(entity_slug, uuid)`: Xóa một Lô Hàng.\n  5. `get_expired_lots_queryset(entity_slug)`: Lấy danh sách Lô Hàng đã hết hạn.\n  6. `get_expiring_lots_queryset(entity_slug, start_date, end_date)`: Lấy danh sách Lô Hàng sắp hết hạn.\n- **Các dependencies**: `LoRepository`, `EntityModel`, `VatTuModel`.\n\n### 4.4. Mô Hình Dữ Liệu\n\n#### 4.4.1. Entity Relationship Diagram (ERD)\n\n```mermaid\nerDiagram\n    EntityModel ||--o{ LoModel : \"has\"\n    VatTuModel ||--o{ LoModel : \"has lots\"\n\n    EntityModel {\n        UUID uuid PK\n        string slug\n        string name\n        # ... other fields\n    }\n\n    VatTuModel {\n        UUID uuid PK\n        string ma_vt\n        string ten_vt\n        # ... other fields\n    }\n\n    LoModel {\n        UUID uuid PK\n        UUID entity_model_id FK\n        UUID ma_vt_id FK \"Product ID\"\n        string ma_lo \"Lot code\"\n        string ten_lo \"Lot name\"\n        string ten_lo2 \"Alternative name\"\n        string ma_vt2 \"Alternative product code\"\n        date ngay_nhap \"Received date\"\n        date ngay_sx \"Manufacturing date\"\n        date ngay_hhsd \"Expiration date\"\n        date ngay_hhbh \"Warranty expiration date\"\n        text ghi_chu \"Notes\"\n        string status \"Status\"\n        datetime created\n        datetime updated\n    }\n```\n\n#### 4.4.2. Chi Tiết Bảng Dữ Liệu\n\n##### Bảng: `lo` (mapped from `LoModel`)\n- **Mô tả**: Lưu trữ thông tin các lô hàng.\n- **Các cột chính**:\n  - `uuid` (PK, UUIDField): Định danh duy nhất.\n  - `entity_model_id` (FK, UUIDField): Liên kết đến bảng `entity`.\n  - `ma_vt_id` (FK, UUIDField): Liên kết đến bảng `vat_tu`.\n  - `ma_lo` (CharField): Mã lô hàng.\n  - `ten_lo` (CharField): Tên lô hàng.\n  - `ten_lo2` (CharField, nullable): Tên thay thế của lô hàng.\n  - `ma_vt2` (CharField, nullable): Mã vật tư thay thế.\n  - `ngay_nhap` (DateField): Ngày nhập lô hàng.\n  - `ngay_sx` (DateField): Ngày sản xuất.\n  - `ngay_hhsd` (DateField): Ngày hết hạn sử dụng.\n  - `ngay_hhbh` (DateField): Ngày hết hạn bảo hành.\n  - `ghi_chu` (TextField, nullable): Ghi chú bổ sung.\n  - `status` (CharField): Trạng thái lô hàng.\n  - `created` (DateTimeField): Thời điểm tạo.\n  - `updated` (DateTimeField): Thời điểm cập nhật cuối.\n- **Indexes**: (`entity_model`, `ma_lo`), (`ma_lo`), (`status`), (`ma_vt`), (`ngay_nhap`), (`ngay_hhsd`).\n- **Unique Together**: (`entity_model`, `ma_lo`).\n\n## 5. Kế Hoạch Kiểm Thử\n\n### 5.1. Phạm Vi Kiểm Thử\n- Kiểm thử các chức năng CRUD cho Lô Hàng qua API endpoints.\n- Kiểm thử validation dữ liệu đầu vào (trường bắt buộc, tính duy nhất của `ma_lo`).\n- Kiểm thử logic phân quyền (người dùng chỉ thao tác được Lô Hàng của Entity mình có quyền).\n- Kiểm thử các API endpoint đặc biệt (kiểm tra lô hàng hết hạn, sắp hết hạn).\n- Kiểm thử lọc theo vật tư và trạng thái.\n\n### 5.2. Kịch Bản Kiểm Thử\n| STT | Mã kịch bản | Tên kịch bản | Mô tả | Điều kiện tiên quyết | Các bước | Kết quả mong đợi |\n|-----|------------|--------------|-------|---------------------|----------|-----------------|\n| 1   | TC_INV007_001 | Tạo Lô Hàng thành công | Kiểm tra tạo mới Lô Hàng với dữ liệu hợp lệ. | User đăng nhập, có quyền. `entity_slug` hợp lệ. | 1. Gửi POST request tới `/api/{entity_slug}/lots/` với data hợp lệ. | 1. Response status 201. 2. Response body chứa thông tin Lô Hàng đã tạo. 3. Dữ liệu được lưu đúng trong DB. |\n| 2   | TC_INV007_002 | Tạo Lô Hàng thất bại - `ma_lo` trùng | Kiểm tra không cho tạo Lô Hàng nếu `ma_lo` đã tồn tại cho entity. | User đăng nhập. `ma_lo` đã tồn tại cho entity. | 1. Gửi POST request với `ma_lo` đã có. | 1. Response status 400. 2. Thông báo lỗi về `ma_lo` bị trùng. |\n| 3   | TC_INV007_003 | Tạo Lô Hàng thất bại - thiếu trường bắt buộc | Kiểm tra lỗi khi thiếu trường bắt buộc. | User đăng nhập. | 1. Gửi POST request thiếu một trong các trường bắt buộc. | 1. Response status 400. 2. Thông báo lỗi trường bắt buộc. |\n| 4   | TC_INV007_004 | Lấy danh sách Lô Hàng | Kiểm tra lấy danh sách Lô Hàng, có phân trang và lọc. | Có sẵn vài Lô Hàng cho các vật tư khác nhau. | 1. Gửi GET request tới `/api/{entity_slug}/lots/?ma_vt={vat_tu_uuid}`. | 1. Response status 200. 2. Response body chứa danh sách Lô Hàng của vật tư đã chọn. |\n| 5   | TC_INV007_005 | Xem chi tiết Lô Hàng | Kiểm tra xem thông tin chi tiết của một Lô Hàng. | Lô Hàng tồn tại. | 1. Gửi GET request tới `/api/{entity_slug}/lots/{uuid}/`. | 1. Response status 200. 2. Response body chứa thông tin chi tiết của Lô Hàng. |\n| 6   | TC_INV007_006 | Cập nhật Lô Hàng | Kiểm tra cập nhật thông tin Lô Hàng. | Lô Hàng tồn tại. | 1. Gửi PUT request tới `/api/{entity_slug}/lots/{uuid}/` với data mới. | 1. Response status 200. 2. Dữ liệu Lô Hàng được cập nhật trong DB. |\n| 7   | TC_INV007_007 | Xóa Lô Hàng | Kiểm tra xóa Lô Hàng. | Lô Hàng tồn tại. | 1. Gửi DELETE request tới `/api/{entity_slug}/lots/{uuid}/`. | 1. Response status 204. 2. Lô Hàng bị xóa khỏi DB. |\n| 8   | TC_INV007_008 | Xem Lô Hàng đã hết hạn | Kiểm tra lấy danh sách Lô Hàng đã hết hạn. | Có sẵn Lô Hàng đã hết hạn. | 1. Gửi GET request tới `/api/{entity_slug}/lots/expired/`. | 1. Response status 200. 2. Response body chứa danh sách Lô Hàng đã hết hạn. |\n| 9   | TC_INV007_009 | Xem Lô Hàng sắp hết hạn | Kiểm tra lấy danh sách Lô Hàng sắp hết hạn. | Có sẵn Lô Hàng sắp hết hạn. | 1. Gửi GET request tới `/api/{entity_slug}/lots/expiring/?end_date=2024-12-31`. | 1. Response status 200. 2. Response body chứa danh sách Lô Hàng sắp hết hạn trước ngày chỉ định. |\n\n## 6. Phụ Lục\n\n### 6.1. Danh Sách Tài Liệu Tham Khảo\n- Mã nguồn dự án ERP-BE (các file đã liệt kê ở mục 1.4).\n- Tài liệu Django REST framework.\n- Tài liệu drf-spectacular (cho schema generation).\n\n### 6.2. Danh Mục Thuật Ngữ\n(Xem mục 1.3)\n\n### 6.3. Lịch Sử Thay Đổi Tài Liệu\n| Phiên bản | Ngày       | Người thực hiện      | Mô tả thay đổi                         |\n|-----------|------------|----------------------|----------------------------------------|\n| 1.0       | 2024-07-31 | Gemini AI Assistant  | Tạo tài liệu ban đầu dựa trên source code. |"])</script><script>self.__next_f.push([1,"9:[\"slug\",\"erp/INV_007_Quan_Ly_Lo_Hang\",\"c\"]\nf:[]\n"])</script><script>self.__next_f.push([1,"0:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/erp-docs/_next/static/css/4b73dfd0f7bdc629.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"$L3\",null,{\"buildId\":\"X5KF-BjlTdL2YCafX7ACW\",\"assetPrefix\":\"/erp-docs\",\"initialCanonicalUrl\":\"/erp/INV_007_Quan_Ly_Lo_Hang/\",\"initialTree\":[\"\",{\"children\":[[\"slug\",\"erp/INV_007_Quan_Ly_Lo_Hang\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"erp\\\",\\\"INV_007_Quan_Ly_Lo_Hang\\\"]}\",{}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[[\"slug\",\"erp/INV_007_Quan_Ly_Lo_Hang\",\"c\"],{\"children\":[\"__PAGE__\",{},[[\"$L4\",[\"$\",\"$L5\",null,{\"children\":[\"$\",\"article\",null,{\"className\":\"prose prose-slate dark:prose-invert max-w-none\",\"children\":[[\"$\",\"header\",null,{\"className\":\"mb-8\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"mb-2\",\"children\":\"$undefined\"}],\"$undefined\",\"$undefined\"]}],[\"$\",\"$L6\",null,{\"content\":\"$7\"}]]}]}]],null],null]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$9\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}],null]},[[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[\"$\",\"body\",null,{\"className\":\"__className_985585\",\"children\":[\"$\",\"$Lb\",null,{\"attribute\":\"class\",\"defaultTheme\":\"system\",\"enableSystem\":true,\"disableTransitionOnChange\":true,\"children\":[\"$\",\"$Lc\",null,{\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"styles\":null}]}]}]}]}],null],null],\"couldBeIntercepted\":false,\"initialHead\":[false,\"$Ld\"],\"globalErrorComponent\":\"$e\",\"missingSlots\":\"$Wf\"}]]\n"])</script><script>self.__next_f.push([1,"d:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"undefined | ERP Documentation\"}],[\"$\",\"meta\",\"3\",{\"name\":\"keywords\",\"content\":\"documentation,ERP,technical,mermaid,markdown\"}],[\"$\",\"meta\",\"4\",{\"name\":\"next-size-adjust\"}]]\n4:null\n"])</script></body></html>